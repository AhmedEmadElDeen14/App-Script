<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø±ÙØ§Ù‚</title>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        /* ************************************ */
        /* Ø£Ù†Ù…Ø§Ø· Ø¹Ø§Ù…Ø© Ù„Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
        /* ************************************ */
        body {
            font-family: 'Cairo', Arial, sans-serif;
            background-color: #e0e7ee;
            margin: 0;
            padding: 0;
            direction: rtl;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
            overflow-y: auto;
            /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£Ø·ÙˆÙ„ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø²Ø± Ø§Ù„Ø«Ø§Ø¨Øª Ù„Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .fixed-home-button {
            position: fixed;
            /* ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø²Ø± Ø«Ø§Ø¨ØªÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© */
            top: 20px;
            /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© */
            left: 20px;
            /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† ÙŠØ³Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© (Ù„Ø£Ù†Ù‡ dir="rtl") */
            z-index: 10000;
            /* ÙŠØ¶Ù…Ù† Ø¸Ù‡ÙˆØ±Ù‡ ÙÙˆÙ‚ Ù…Ø¹Ø¸Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®Ø±Ù‰ */
            background-color: #3498db;
            /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø¬Ø°Ø§Ø¨ */
            color: white;
            border: none;
            border-radius: 50%;
            /* Ø²Ø± Ø¯Ø§Ø¦Ø±ÙŠ */
            width: 50px;
            /* Ø­Ø¬Ù… Ø§Ù„Ø²Ø± */
            height: 50px;
            display: flex;
            /* Ù„ØªÙˆØ³ÙŠØ· Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            /* Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            /* Ø¸Ù„ Ø®ÙÙŠÙ */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .fixed-home-button:hover {
            background-color: #2980b9;
            /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
            transform: scale(1.1);
            /* ØªØ£Ø«ÙŠØ± ØªÙƒØ¨ÙŠØ± Ø¨Ø³ÙŠØ· */
        }

        .fixed-home-button i {
            color: white;
            /* ØªØ£ÙƒÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
        }

        /* ÙƒÙ„Ø§Ø³ Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙØ­Ø§Øª */
        .page-section {
            display: none;
            width: 90%;
            max-width: 1000px;
            background: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            box-sizing: border-box;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease-in-out;
        }

        .page-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }


        .page-section {
            display: none;
            width: 90%;
            /* ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù‚Ø³Ù… ÙŠØ£Ø®Ø° Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„ */
            max-width: 1000px;
            /* Ø£Ù‚ØµÙ‰ Ø¹Ø±Ø¶ Ù„Ù„ÙƒÙˆÙ†ØªÙŠÙ†Ø±Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
            background: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            /* Ù‡Ø§Ù…Ø´ Ø¹Ù„ÙˆÙŠ ÙˆØ³ÙÙ„ÙŠ Ù„ØªÙˆØ³ÙŠØ· Ø§Ù„ÙƒÙˆÙ†ØªÙŠÙ†Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ body */
            box-sizing: border-box;
            /* Ù„Ø¶Ù…Ø§Ù† Ø£Ù† Ø§Ù„Ù€ padding Ù„Ø§ ÙŠØ²ÙŠØ¯ Ø§Ù„Ø¹Ø±Ø¶ */
        }

        .page-section.active {
            display: block;
            /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ø´Ø·Ø© */
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¹Ø§Ù…Ø© */
        h1,
        h2,
        h3 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-weight: 700;
            line-height: 1.4;
            position: relative;
            padding-bottom: 10px;
        }

        h1::after,
        h2::after,
        h3::after {
            content: "";
            position: absolute;
            bottom: 0;
            right: 50%;
            transform: translateX(50%);
            width: 60px;
            height: 3px;
            background-color: #3498db;
            border-radius: 2px;
        }

        h1 {
            font-size: 2.5em;
        }

        h2 {
            font-size: 2.0em;
            width: fit-content;
            margin: 30px auto;
        }

        /* ØªÙˆØ³ÙŠØ· H2s */
        h2::after {
            width: 60px;
            height: 3px;
        }


        /* ************************************ */
        /* Ø³ØªØ§ÙŠÙ„ Ø¹Ø§Ù… Ù„Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        /* ************************************ */
        .button {
            /* ÙƒÙ„Ø§Ø³ Milligram Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
            font-family: 'Cairo', Arial, sans-serif;
            /* padding: 10px 20px; */
            border-radius: 8px;
            font-size: 1em;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .button-primary {
            background-color: #007BFF;
            color: white;
        }

        .button-primary:hover {
            background-color: #0056b3;
        }

        .button.back-button {
            background-color: #6c757d;
            color: white;
        }

        .button.back-button:hover {
            background-color: #5a6268;
        }

        .button.delete {
            background-color: #e74c3c;
            color: white;
        }

        .button.delete:hover {
            background-color: #c0392b;
        }

        input[type="text"],
        input[type="number"],
        input[type="tel"],
        select {
            height: 40px;
            border-radius: 5px;
            border: 1px solid #ddd;
            padding: 0 10px;
            width: 100%;
            box-sizing: border-box;
            /* Ù„Ù„ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù€ padding Ù„Ø§ ÙŠØ²ÙŠØ¯ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ÙŠ */
            font-family: 'Cairo', Arial, sans-serif;
            /* Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ */
        }

        /* Ø³ØªØ§ÙŠÙ„ Ø¹Ø§Ù… Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .button i {
            margin-right: 8px;
            /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§Ù„Ù†Øµ ÙÙŠ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„ÙŠ Ø§ØªØ¬Ø§Ù‡Ù‡Ø§ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø± */
            vertical-align: middle;
            /* Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø±Ø£Ø³ÙŠØ§Ù‹ Ù…Ø¹ Ø§Ù„Ù†Øµ */
        }

        /* Ù„Ùˆ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© */
        .button i:last-child {
            margin-right: 0;
            margin-left: 8px;
            /* Ù…Ø³Ø§ÙØ© Ø¨Ø¹Ø¯ Ø§Ù„Ù†Øµ */
        }

        /* Ø³ØªØ§ÙŠÙ„ Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ (spinners) */
        .fa-spinner {
            animation: fa-spin 1s infinite linear;
            /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¯ÙˆØ±Ø§Ù† */
        }

        /* Ø¹Ù†Ø¯ ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }


        /* ************************************ */
        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (main-page) */
        /* ************************************ */
        /* Ø£Ù†Ù…Ø§Ø· Ø¹Ø§Ù…Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #main-page.page-section {
            /* max-width: 900px; Ø²ÙŠØ§Ø¯Ø© Ø£Ù‚ØµÙ‰ Ø¹Ø±Ø¶ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
            text-align: center;
            padding: 40px;
            /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ */
        }

        #main-page h1 {
            font-size: 2.8em;
            margin-bottom: 40px;
        }

        /* Ø­Ø¬Ù… Ø£ÙƒØ¨Ø± Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
        #main-page h1::after {
            width: 100px;
            height: 4px;
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .main-button-grid {
            /* ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ù…Ù† button-grid Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ */
            display: grid;
            grid-template-columns: 1fr;
            /* Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            gap: 20px;
            /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
            margin-top: 30px;
        }

        @media (min-width: 600px) {

            /* Ø¹Ù…ÙˆØ¯ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© ÙˆØ§Ù„ÙƒØ¨ÙŠØ±Ø© */
            .main-button-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (min-width: 900px) {

            /* Ø«Ù„Ø§Ø«Ø© Ø£Ø¹Ù…Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
            .main-button-grid {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .main-button {
            /* padding: 20px 15px; */
            /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªÙˆÙÙŠØ± Ù…Ø³Ø§Ø­Ø© */
            border: none;
            border-radius: 12px;
            font-size: 1.05em;
            /* ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ */
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);

            /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
            min-width: 150px;
            /* ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø£Ø¯Ù†Ù‰ Ù„Ø¶Ù…Ø§Ù† Ù…Ø³Ø§Ø­Ø© ÙƒØ§ÙÙŠØ© */
            max-width: 250px;
            /* ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ù… ØªÙ…Ø¯Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ù„Øº ÙÙŠÙ‡ */
            text-align: center;
            /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Øµ */
            flex-wrap: wrap;
            /* Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø§Ù„Ø§Ù„ØªÙØ§Ù Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø± */
            box-sizing: border-box;
            /* Ù„Ø¶Ù…Ø§Ù† Ø£Ù† Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ Ù„Ø§ ÙŠØ²ÙŠØ¯ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ÙŠ Ø¹Ù† max-width */
            word-wrap: break-word;
            /* ÙƒØ³Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹ */
            overflow: hidden;
            /* Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ Ù‚Ø¯ ÙŠØ®Ø±Ø¬ (ÙƒÙ†Ù…Ø· Ø¯ÙØ§Ø¹ÙŠ) */
        }

        .main-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .main-button i {
            font-size: 1.5em;
            /* ØªØµØºÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            /* margin-bottom: 8px; ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            color: rgba(255, 255, 255, 0.8);
            /* Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… Ø®Ø±ÙˆØ¬ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
            max-width: 100%;
            /* Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² Ø¹Ø±Ø¶ Ø§Ù„Ø²Ø± */
            height: auto;
            /* Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„Ø§Ø±ØªÙØ§Ø¹ */
        }

        /* Ø£Ù„ÙˆØ§Ù† Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
        .main-button.dashboard {
            background-color: #27ae60;
        }

        /* Ø£Ø®Ø¶Ø± */
        .main-button.dashboard:hover {
            background-color: #229a53;
        }

        .main-button.register {
            background-color: #e67e22;
        }

        /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
        .main-button.register:hover {
            background-color: #d35400;
        }

        .main-button.edit {
            background-color: #9b59b6;
        }

        /* Ø¨Ù†ÙØ³Ø¬ÙŠ */
        .main-button.edit:hover {
            background-color: #8e44ad;
        }

        .main-button.teacher {
            background-color: #1abc9c;
        }

        /* ÙÙŠØ±ÙˆØ²ÙŠ */
        .main-button.teacher:hover {
            background-color: #16a085;
        }

        .main-button.all-students {
            background-color: #34495e;
        }

        /* Ø±Ù…Ø§Ø¯ÙŠ Ø¯Ø§ÙƒÙ† */
        .main-button.all-students:hover {
            background-color: #2c3e50;
        }

        .main-button.archive {
            background-color: #5d6d7e;
        }

        /* Ø±Ù…Ø§Ø¯ÙŠ Ø£Ø²Ø±Ù‚ */
        .main-button.archive:hover {
            background-color: #495a69;
        }

        .main-button.manage-slots {
            background-color: #2980b9;
        }

        /* Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ */
        .main-button.manage-slots:hover {
            background-color: #23699b;
        }

        .main-button.renew-subscription {
            background-color: #f39c12;
        }

        /* Ø£ØµÙØ± Ø¯Ø§ÙƒÙ† */
        .main-button.renew-subscription:hover {
            background-color: #e08e0b;
        }

        .main-button.renewal-alert {
            background-color: #c0392b;
        }

        /* Ø£Ø­Ù…Ø± Ø·ÙˆØ¨ÙŠ */
        .main-button.renewal-alert:hover {
            background-color: #a93226;
        }

        /* ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£Ù„ÙˆØ§Ù† Ø£Ø®Ø±Ù‰ Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙŠ Ø³ØªÙØ¶Ø§Ù Ù„Ø§Ø­Ù‚Ø§Ù‹ */


        /* ************************************ */
        /* Toast Notifications */
        /* ************************************ */
        #toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            display: flex;
            flex-direction: column-reverse;
            /* Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
            gap: 10px;
            align-items: center;
            /* Ù„ØªÙˆØ³ÙŠØ· Ø§Ù„ØªÙˆØ³Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† ÙˆØ§Ø­Ø¯ */
        }

        .toast {
            background-color: #333;
            color: white;
            /* padding: 15px 25px; */
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-out;
            transform: translateY(20px);
            min-width: 250px;
            max-width: 400px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: 'Cairo', Arial, sans-serif;
            font-size: 1.1em;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background-color: #27ae60;
        }

        .toast.error {
            background-color: #e74c3c;
        }

        .toast.info {
            background-color: #3498db;
        }

        .toast i {
            margin-right: 0;
            margin-left: 10px;
        }

        /* Ø¹ÙƒØ³ Ø§Ù„Ù…Ø§Ø±Ø¬Ù† Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙŠ Ø§Ù„ØªÙˆØ³Øª */
        .hidden {
            display: none !important;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù€ Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background-color: #fff;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            position: relative;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }


        .modal-close-button {
            position: absolute;
            top: 15px;
            left: 15px;
            background: transparent;
            border: none;
            font-size: 1.2em;
            color: #888;
            cursor: pointer;
        }


        .modal-close-button:hover {
            color: #333;
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .modal-actions .button {
            min-width: 120px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-actions .save-button {
            background-color: #28a745;
            /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ù„Ù„Ø­ÙØ¸ */
            color: white;
        }

        .modal-actions .save-button:hover {
            background-color: #218838;
        }

        .modal-actions .cancel-button {
            background-color: #dc3545;
            /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ù„Ù„Ø¥Ù„ØºØ§Ø¡ */
            color: white;
        }

        .modal-actions .cancel-button:hover {
            background-color: #c82333;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (chips) */
        .time-slots-modal-sections {
            display: grid;
            grid-template-columns: 1fr;
            /* Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            gap: 20px;
            margin-top: 20px;
        }

        @media (min-width: 768px) {

            /* Ø¹Ù…ÙˆØ¯ÙŠÙ† Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
            .time-slots-modal-sections {
                grid-template-columns: 1fr 1fr;
            }
        }

        .slots-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .time-slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }


        .time-slot {
            background-color: #ecf0f1;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s ease;
            font-size: 0.9em;
        }

        .time-slot:hover {
            background-color: #3498db;
            color: white;
        }

        .time-slot.selected {
            background-color: #2ecc71;
            color: rgb(0, 0, 0);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .button.save-button {
            background-color: #27ae60;
            color: white;
        }

        .button.cancel-button {
            background-color: #e74c3c;
            color: white;
        }

        .time-slot-chip {
            /* padding: 10px 15px; */
            border: 1px solid #ccc;
            border-radius: 20px;
            background-color: #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s, transform 0.1s;
            font-size: 0.9em;
            white-space: nowrap;
            /* Ù…Ù†Ø¹ Ø§Ù†Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Øµ */
            font-weight: 600;
            color: #555;
        }

        .time-slot-chip:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
        .time-slot-chip.selected {
            /* Ù…ÙˆØ¹Ø¯ Ù…ØªØ§Ø­ (ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¯ÙŠØ± Ù„ÙŠÙƒÙˆÙ† Ù…ØªØ§Ø­Ø§) */
            background-color: #2ecc71;
            /* Ø£Ø®Ø¶Ø± Ø²Ø§Ù‡ÙŠ */
            color: white;
            border-color: #2ecc71;
        }

        .time-slot-chip.disabled {
            /* Ù…ÙˆØ¹Ø¯ Ù…Ø­Ø¬ÙˆØ² (Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡) */
            background-color: #e74c3c;
            /* Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ† */
            color: rgb(0, 0, 0);
            border-color: #e74c3c;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .time-slot-chip:not(.selected):not(.disabled) {
            /* Ù…ÙˆØ¹Ø¯ ØºÙŠØ± Ù…ØªØ§Ø­ (ÙØ§Ø±Øº ÙÙŠ Ø§Ù„Ø´ÙŠØªØŒ Ù„Ù… ÙŠØ®ØªØ§Ø±Ù‡ Ø§Ù„Ù…Ø¯ÙŠØ±) */
            background-color: #bdc3c7;
            /* Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ */
            color: #444;
            border-color: #bdc3c7;
        }

        .no-slots-message {
            text-align: center;
            color: #777;
            padding: 20px;
            font-style: italic;
        }


        .nav-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }

        .nav-button {
            white-space: normal !important;
            word-break: break-word;
            text-align: center;
            line-height: 1.6;
            padding-left: 16px;
            padding-right: 16px;
            min-width: 180px;
            max-width: 100%;
        }


        .nav-button:hover {
            background-color: #34495e;
            transform: translateY(-2px);
        }

        .nav-button.active {
            background-color: #3498db;
        }


        .dashboard-stats-grid.improved {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            border-radius: 12px;
            padding: 20px;
            color: white;
            text-align: center;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
        }

        .stat-card h3 {
            font-size: 1em;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 1.6em;
            font-weight: bold;
            margin: 0;
        }

        /* Ø£Ù„ÙˆØ§Ù† Ù…Ø®ØµØµØ© Ù„ÙƒÙ„ Ù†ÙˆØ¹ */
        .stat-card.total {
            background: #2c3e50;
        }

        .stat-card.success {
            background: #27ae60;
        }

        .stat-card.info {
            background: #2980b9;
        }

        .stat-card.warning {
            background: #f39c12;
        }

        .stat-card.danger {
            background: #e74c3c;
        }

        .stat-card.dark {
            background-color: #34495e;
        }

        .stat-card.neutral {
            background-color: #7f8c8d;
        }

        .chart-container.centered {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }


        .styled-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .styled-list li {
            background-color: #f9f9f9;
            margin-bottom: 10px;
            /* padding: 12px 16px; */
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            font-size: 1em;
            color: #2c3e50;
            transition: background-color 0.3s ease;
        }

        .styled-list li:hover {
            background-color: #eef6fb;
        }

        .styled-list-box {
            background-color: #fff5f5;
            padding: 20px;
            border: 1px solid #ffd6d6;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(255, 0, 0, 0.05);
        }

        .styled-form-box {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
            max-width: 700px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label,
        .form-row label {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .column-25 {
            flex: 1;
            max-width: 25%;
        }

        .column-75 {
            flex: 3;
            max-width: 75%;
        }

        .full-width {
            width: 100%;
        }



        .form-group input,
        .form-group select,
        .form-row select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 1em;
            box-sizing: border-box;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .column-50 {
            flex: 1;
        }

        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .button.primary {
            background-color: #3498db;
            color: white;
            border: none;
            /* padding: 12px 20px; */
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .button.primary:hover {
            background-color: #2980b9;
        }


        /* ÙÙ„ØªØ±Ø© Ø¨Ø´ÙƒÙ„ Ø´Ø¨ÙƒÙŠ */
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .filter-item label {
            font-weight: bold;
            display: block;
            margin-bottom: 6px;
        }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¯ÙˆÙ† Scroll */
        .table-responsive {
            overflow-x: unset;
            padding: 0;
            box-shadow: none;
            background: transparent;
        }

        #renewalNeededStudentsTable {
            width: 100%;
            table-layout: fixed;
            word-wrap: break-word;
            border-collapse: collapse;
        }

        #renewalNeededStudentsTable th,
        #renewalNeededStudentsTable td {
            /* padding: 10px 12px; */
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        #renewalNeededStudentsTable th {
            background-color: #f1f1f1;
            cursor: pointer;
            font-weight: bold;
            color: #2c3e50;
        }

        #renewalNeededStudentsTable tbody tr:hover {
            background-color: #f9f9f9;
        }




        #allStudentsTable {
            width: 100%;
            table-layout: fixed;
            word-wrap: break-word;
            border-collapse: collapse;
        }


        #allStudentsTable th,
        #allStudentsTable td {
            /* padding: 10px 12px; */
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        #allStudentsTable th {
            background-color: #f1f1f1;
            cursor: pointer;
            font-weight: bold;
            color: #2c3e50;
        }

        #allStudentsTable tbody tr:hover {
            background-color: #f9f9f9;
        }

        .no-data-message {
            text-align: center;
            color: #888;
            font-style: italic;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø¦Ø±ÙŠØ© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙÙ‚Ø· */
        .table-action-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background-color: #3498db;
            color: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 0 4px;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .table-action-button:hover {
            background-color: #2980b9;
        }

        .table-action-button.delete {
            background-color: #e74c3c;
        }

        .table-action-button.delete:hover {
            background-color: #c0392b;
        }

        #archivedStudentsTable {
            width: 100%;
            table-layout: fixed;
            word-wrap: break-word;
            border-collapse: collapse;
        }

        #archivedStudentsTable th,
        #archivedStudentsTable td {
            /* padding: 10px 12px; */
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        #archivedStudentsTable th {
            background-color: #f1f1f1;
            cursor: pointer;
            font-weight: bold;
            color: #2c3e50;
        }

        #archivedStudentsTable tbody tr:hover {
            background-color: #f9f9f9;
        }

        .teacher-slots-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .teacher-slots-table th,
        .teacher-slots-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        .teacher-slots-table th {
            background-color: #f1f1f1;
            color: #2c3e50;
        }

        .no-slots-message {
            text-align: center;
            color: #888;
            font-style: italic;
            margin: 15px 0;
        }

        .teacher-name-display {
            font-size: 1.2em;
            color: #34495e;
            text-align: center;
        }

        .status-message {
            margin-top: 15px;
            font-weight: bold;
            text-align: center;
            color: #27ae60;
        }


        .form-row.double-column {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
        }

        .styled-form-box {
            background-color: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
            flex: 1;
            min-width: 300px;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1em;
        }

        .student-info-list p {
            margin: 8px 0;
            font-size: 0.95em;
            color: #2c3e50;
        }


        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1em;
            box-sizing: border-box;
        }

        textarea {
            resize: vertical;
        }

        .table-responsive {
            overflow-x: auto;
            margin-top: 15px;
        }

        #paymentRecordsTable {
            width: 100%;
            border-collapse: collapse;
        }

        #paymentRecordsTable th,
        #paymentRecordsTable td {
            /* padding: 10px 12px; */
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        #paymentRecordsTable th {
            background-color: #f1f1f1;
            color: #2c3e50;
            font-weight: bold;
        }
    </style>
</head>

<body>


    <div class="fixed-home-button" onclick="showPage('main-page')">
        <i class="fas fa-home"></i>
    </div>
    <div id="main-page" class="page-section active">
        <h1>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø±ÙØ§Ù‚</h1>
        <div class="main-button-grid">
            <button class="main-button nav-button dashboard" onclick="showPage('dashboard-page', loadDashboardStats)"><i
                    class="fas fa-chart-line"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
            <button class="main-button nav-button register" onclick="showPage('form-page', loadFormDependencies)"><i
                    class="fas fa-user-plus"></i> ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
            <button class="main-button nav-button trial-register"
                onclick="showPage('trial-form-page', loadTrialFormDependencies)"><i class="fas fa-user-friends"></i>
                ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨
                ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
            <button class="main-button nav-button edit"
                onclick="showPage('edit-student-page', loadEditStudentDependencies)"><i class="fas fa-user-edit"></i>
                ØªØ¹Ø¯ÙŠÙ„
                Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ø§Ù„Ø¨</button>
            <button class="main-button nav-button all-students"
                onclick="showPage('all-students-page', loadAllStudentsDependencies)"><i class="fas fa-users"></i> ÙƒÙ„
                Ø§Ù„Ø·Ù„Ø§Ø¨</button>
            <button class="main-button nav-button archive"
                onclick="showPage('archive-page', loadArchivedStudentsDependencies)"><i class="fas fa-archive"></i>
                Ø£Ø±Ø´ÙŠÙ
                Ø§Ù„Ø·Ù„Ø§Ø¨</button>
            <button class="main-button nav-button manage-slots"
                onclick="showPage('manage-slots-page', loadManageSlotsDependencies)"><i class="fas fa-clock"></i> Ø¥Ø¯Ø§Ø±Ø©
                Ù…ÙˆØ§Ø¹ÙŠØ¯
                Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</button>
            <button class="main-button nav-button convert-trial"
                onclick="showPage('convert-trial-page', loadConvertTrialDependencies)"><i class="fas fa-sync-alt"></i>
                ØªØ­ÙˆÙŠÙ„
                Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ</button>

            <button class="main-button nav-button renewal-alert"
                onclick="showPage('renewal-needed-students-page', loadRenewalNeededStudentsDependencies)"><i
                    class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯</button>
            <button class="main-button nav-button payment-record"
                onclick="showPage('payment-records-page', loadPaymentRecordsDependencies)"><i
                    class="fas fa-money-bill-wave"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</button>


        </div>
    </div>

    <div id="dashboard-page" class="page-section">
        <h1><i class="fas fa-chart-line"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: Ù…Ù„Ø®Øµ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</h1>

        <div id="dashboard-content">

            <!-- ğŸŸ¦ 1. Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø§Ø¨ -->
            <div class="stats-section">
                <h2><i class="fas fa-users"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                <div class="dashboard-stats-grid improved">
                    <div class="stat-card total">
                        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                        <p id="totalStudentsCount">0</p>
                    </div>
                    <div class="stat-card success">
                        <h3>Ø·Ù„Ø§Ø¨ Ù…Ø´ØªØ±ÙƒÙŠÙ†</h3>
                        <p id="registeredStudentsCount">0</p>
                    </div>
                    <div class="stat-card info">
                        <h3>Ø­Ù„Ù‚Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h3>
                        <p id="trialStudentsCount">0</p>
                    </div>
                    <div class="stat-card warning">
                        <h3>Ø·Ù„Ø§Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h3>
                        <p id="pendingStudentsCount">0</p>
                    </div>
                    <div class="stat-card danger">
                        <h3>ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…</h3>
                        <p id="renewalNextWeekCount">0</p>
                    </div>
                </div>
            </div>


            <!-- ğŸŸ¨ 2. Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ -->
            <div class="stats-section">
                <h2><i class="fas fa-sync-alt"></i> Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯</h2>
                <div class="dashboard-stats-grid improved">
                    <div class="stat-card danger">
                        <h3>ÙŠØ­ØªØ§Ø¬ Ù„Ù„ØªØ¬Ø¯ÙŠØ¯</h3>
                        <p id="needsRenewalCount">0</p>
                    </div>
                    <div class="stat-card dark">
                        <h3>Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
                        <p id="expiredCount">0</p>
                    </div>
                    <div class="stat-card warning">
                        <h3>ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯</h3>
                        <p id="overLimitCount">0</p>
                    </div>
                    <div class="stat-card success">
                        <h3>ØªÙ… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ (Ù†Ø´Ø·)</h3>
                        <p id="renewedCount">0</p>
                    </div>
                    <div class="stat-card info">
                        <h3>Ø­Ù„Ù‚Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù†Ø´Ø·Ø©</h3>
                        <p id="activeTrialCount">0</p>
                    </div>
                    <div class="stat-card neutral">
                        <h3>Ù„Ù… ÙŠØ´ØªØ±ÙƒÙˆØ§</h3>
                        <p id="notSubscribedCount">0</p>
                    </div>
                </div>
            </div>


            <!-- ğŸŸ© 3. ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø© -->
            <div class="stats-section">
                <h2><i class="fas fa-chart-pie"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø©</h2>
                <div class="chart-container centered">
                    <div id="packagePieChart" style="width: 100%; height: 400px;"></div>
                </div>
            </div>


            <!-- ğŸŸ§ 4. Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø© -->
            <div class="stats-section">
                <h2><i class="fas fa-layer-group"></i> Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø©</h2>
                <ul id="studentsByPackageList" class="stats-list styled-list"></ul>
            </div>

            <!-- ğŸŸ¥ 5. Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„ÙƒÙ„ Ù…Ø¹Ù„Ù… -->
            <div class="stats-section">
                <h2><i class="fas fa-user-tie"></i> Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„ÙƒÙ„ Ù…Ø¹Ù„Ù…</h2>

                <div class="chart-container centered">
                    <div id="teachersBarChart" style="width: 100%; height: 400px;"></div>
                </div>

                <ul id="studentsByTeacherList" class="stats-list styled-list"></ul>
            </div>


            <!-- ğŸŸ« 6. Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© -->
            <div class="stats-section">
                <h2><i class="fas fa-info-circle"></i> Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h2>
                <div class="chart-container centered">
                    <div id="renewalStatusPieChart" style="width: 100%; height: 400px;"></div>
                </div>
            </div>


            <!-- ğŸŸª 7. Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ø­Ø¯ÙŠØ«Ø§Ù‹ -->
            <div class="stats-section">
                <h2><i class="fas fa-user-plus"></i> Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ø­Ø¯ÙŠØ«Ø§Ù‹</h2>
                <ul class="stats-list styled-list">
                    <li>Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…: <span id="last7DaysCount">0</span></li>
                    <li>Ø¢Ø®Ø± 30 ÙŠÙˆÙ…Ù‹Ø§: <span id="last30DaysCount">0</span></li>
                </ul>
            </div>


            <!-- ğŸŸ¨ 8. Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹ -->
            <div class="stats-section">
                <h2><i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹</h2>

                <div class="renewal-students-details styled-list-box">
                    <h3 id="renewalDetailsTitle" style="margin-bottom: 15px;"></h3>
                    <ul id="renewalNextWeekList" class="stats-list styled-list">
                        <li>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</li>
                    </ul>
                </div>
            </div>


            <!-- ğŸŸ¦ 9. Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ -->
            <div class="button-container">
                <button class="button refresh-button" onclick="loadDashboardStats()">
                    <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button class="button back-button" onclick="showPage('main-page')">
                    <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>

        </div>
    </div>


    <div id="form-page" class="page-section">
        <h2><i class="fas fa-user-plus"></i> Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>

        <form id="dataForm" class="styled-form-box">
            <div class="form-group">
                <label for="regName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
                <input type="text" id="regName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" required>
            </div>

            <div class="form-group">
                <label for="regAge">Ø§Ù„Ø³Ù†:</label>
                <input type="text" id="regAge" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†" required>
            </div>

            <div class="form-group">
                <label for="regPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                <input type="tel" id="regPhone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
            </div>

            <div class="form-group">
                <label for="regSubscriptionPackage">Ø¨Ø§Ù‚Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</label>
                <select id="regSubscriptionPackage" required>
                    <option value="" disabled selected>Ø§Ø®ØªØ± Ø¨Ø§Ù‚Ø©</option>
                </select>
            </div>

            <div class="form-group">
                <label for="regTeacher">Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
                <select id="regTeacher" onchange="updateRegDays(); updateDynamicRegSlots();" required>
                    <option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ù‹Ø§</option>
                </select>
            </div>

            <div id="dynamicRegSlotsContainer">
            </div>

            <div class="form-row">
                <div class="column-50">
                    <label for="regPaymentStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:</label>
                    <select id="regPaymentStatus" required>
                        <option value="" disabled selected>Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</option>
                    </select>
                </div>
                <div class="column-50">
                    <label for="regSubscriptionType">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</label>
                    <select id="regSubscriptionType" required>
                        <option value="" disabled selected>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</option>
                    </select>
                </div>
            </div>



            <div class="form-group buttons">
                <button type="button" class="button primary" onclick="submitData()">
                    <i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button type="button" class="button back-button" onclick="showPage('main-page')">
                    <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>
        </form>
    </div>


    <div id="trial-form-page" class="page-section">
        <h2><i class="fas fa-user-friends"></i> Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ</h2>

        <form id="trialDataForm" class="styled-form-box">
            <div class="form-group">
                <label for="trialRegName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
                <input type="text" id="trialRegName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" required>
            </div>

            <div class="form-group">
                <label for="trialRegAge">Ø§Ù„Ø³Ù†:</label>
                <input type="text" id="trialRegAge" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†" required>
            </div>

            <div class="form-group">
                <label for="trialRegPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                <input type="tel" id="trialRegPhone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
            </div>

            <div class="form-group">
                <label for="trialRegTeacher">Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
                <select id="trialRegTeacher" onchange="updateTrialRegDays()" required>
                    <option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ù‹Ø§</option>
                </select>
            </div>

            <div class="form-row">
                <div class="column-50">
                    <label for="trialRegDay1">Ø§Ù„ÙŠÙˆÙ…:</label>
                    <select id="trialRegDay1" onchange="updateTrialRegTimes('trialRegDay1', 'trialRegTime1')" required>
                        <option value="" disabled selected>Ø§Ø®ØªØ± ÙŠÙˆÙ…Ù‹Ø§</option>
                    </select>
                </div>
                <div class="column-50">
                    <label for="trialRegTime1">Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯:</label>
                    <select id="trialRegTime1" required>
                        <option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§</option>
                    </select>
                </div>
            </div>

            <div class="form-group buttons">
                <button type="button" class="button primary" onclick="submitTrialData()">
                    <i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ
                </button>
                <button type="button" class="button back-button" onclick="showPage('main-page')">
                    <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>
        </form>
    </div>


    <div id="edit-student-page" class="page-section">
        <h2><i class="fas fa-user-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h2>

        <!-- ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ -->
        <div class="form-row">
            <div class="column-75">
                <label for="searchStudentId">Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                <input type="text" id="searchStudentId" placeholder="Ø£Ø¯Ø®Ù„ Student ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
            </div>
            <div class="column-25">
                <button class="button primary full-width" onclick="fetchStudentData()" id="searchButton">
                    <i class="fas fa-search"></i> Ø¨Ø­Ø«
                </button>
            </div>
        </div>

        <!-- ğŸ“ Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div id="studentForm" class="hidden styled-form-box">
            <div class="form-group">
                <label for="editStudentId">Student ID:</label>
                <input type="text" id="editStudentId" disabled>
            </div>

            <div class="form-group">
                <label for="editName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
                <input type="text" id="editName">
            </div>

            <div class="form-group">
                <label for="editAge">Ø§Ù„Ø³Ù†:</label>
                <input type="text" id="editAge">
            </div>

            <div class="form-group">
                <label for="editPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±):</label>
                <input type="tel" id="editPhone">
            </div>

            <div class="form-group">
                <label for="editSubscriptionPackage">Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø§Ù‚Ø©:</label>
                <select id="editSubscriptionPackage"></select>
            </div>

            <div class="form-group">
                <label for="editTeacher">Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
                <select id="editTeacher" onchange="updateEditDays(); updateDynamicEditSlots();" required>
                    <option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ù‹Ø§</option>
                </select>
            </div>

            <div id="dynamicEditSlotsContainer">
            </div>

            <div class="form-group">
                <label for="editPaymentStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ (Ø§Ù„ØªØ¬Ø¯ÙŠØ¯):</label>
                <select id="editPaymentStatus"></select>
            </div>



            <div class="form-group">
                <label for="editSubscriptionType">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</label>
                <select id="editSubscriptionType"></select>
            </div>

            <div class="form-group buttons">
                <button class="button primary" onclick="updateStudentData()">
                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                </button>
                <button class="button delete" onclick="deleteStudent()">
                    <i class="fas fa-trash-alt"></i> Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨
                </button>
                <button class="button back-button" onclick="showPage('main-page')">
                    <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>
        </div>
    </div>


    <div id="all-students-page" class="page-section">
        <h2><i class="fas fa-users"></i> ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>

        <!-- ğŸ—‚ï¸ Ø£Ø²Ø±Ø§Ø± ØªØµØ¯ÙŠØ± -->
        <div class="button-container" style="justify-content: flex-end; margin-bottom: 15px;">
            <button class="button" onclick="exportToExcel()"><i class="fas fa-file-excel"></i></button>
            <button class="button" onclick="exportToPDF()"><i class="fas fa-file-pdf"></i></button>
        </div>

        <!-- ğŸ” Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„Ø¨Ø­Ø« -->
        <div class="filters-grid">
            <div class="filter-item">
                <label for="allStudentsSearch">Ø¨Ø­Ø« (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù‡Ø§ØªÙØŒ ID):</label>
                <input type="text" id="allStudentsSearch" placeholder="Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§..." onkeyup="filterAndSortStudents()">
            </div>
            <div class="filter-item">
                <label for="filterTeacher">Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
                <select id="filterTeacher" onchange="filterAndSortStudents()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="filterPackage">Ø§Ù„Ø¨Ø§Ù‚Ø©:</label>
                <select id="filterPackage" onchange="filterAndSortStudents()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="filterPaymentStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:</label>
                <select id="filterPaymentStatus" onchange="filterAndSortStudents()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="filterRenewalStatus">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯:</label>
                <select id="filterRenewalStatus" onchange="filterAndSortStudents()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                </select>
            </div>
        </div>

        <!-- ğŸ”„ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« -->
        <div class="button-container" style="justify-content: flex-start; margin-bottom: 20px;">
            <button class="button refresh-button" onclick="loadAllStudentsData()">
                <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
        </div>

        <!-- ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ -->
        <div class="table-responsive">
            <table id="allStudentsTable">
                <thead>
                    <tr>
                        <th onclick="filterAndSortStudents('name')">Ø§Ù„Ø§Ø³Ù… <i class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortStudents('studentID')">Student ID <i class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortStudents('phone')">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <i class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortStudents('teacherName')">Ø§Ù„Ù…Ø¹Ù„Ù… <i class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortStudents('packageName')">Ø§Ù„Ø¨Ø§Ù‚Ø© <i class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortStudents('attendedSessions')">Ø§Ù„Ø­ØµØµ Ø§Ù„Ø­Ø§Ø¶Ø±Ø© <i
                                class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortStudents('remainingSessions')">Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© <i
                                class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortStudents('renewalStatus')">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ <i class="fas fa-sort"></i>
                        </th>
                        <th onclick="filterAndSortStudents('registrationDate')">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„ <i
                                class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortStudents('subscriptionType')">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ <i class="fas fa-sort"></i>
                        </th>
                        <th onclick="filterAndSortStudents('allBookedScheduleSlots')">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ <i
                                class="fas fa-sort"></i></th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="12" class="no-data-message">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ğŸ”™ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© -->
        <div class="button-container">
            <button class="button back-button" onclick="showPage('main-page')">
                <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
        </div>
    </div>



    <div id="archive-page" class="page-section">
        <h2><i class="fas fa-archive"></i> Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>

        <!-- ğŸ§­ Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„Ø¨Ø­Ø« -->
        <div class="filters-grid">
            <div class="filter-item">
                <label for="archiveSearch">Ø¨Ø­Ø« (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù‡Ø§ØªÙØŒ ID):</label>
                <input type="text" id="archiveSearch" placeholder="Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§..."
                    onkeyup="filterAndSortArchivedStudents()">
            </div>
            <div class="filter-item">
                <label for="filterArchiveTeacher">Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
                <select id="filterArchiveTeacher" onchange="filterAndSortArchivedStudents()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="filterArchivePackage">Ø§Ù„Ø¨Ø§Ù‚Ø©:</label>
                <select id="filterArchivePackage" onchange="filterAndSortArchivedStudents()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="filterArchiveStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
                <select id="filterArchiveStatus" onchange="filterAndSortArchivedStudents()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                </select>
            </div>
        </div>

        <!-- ğŸ”„ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« -->
        <div class="button-container" style="justify-content: flex-start; margin-bottom: 20px;">
            <button class="button refresh-button" onclick="loadArchivedStudentsData()">
                <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
        </div>

        <!-- ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø±Ø´ÙŠÙ -->
        <div class="table-responsive">
            <table id="archivedStudentsTable">
                <thead>
                    <tr>
                        <th onclick="filterAndSortArchivedStudents('name')">Ø§Ù„Ø§Ø³Ù… <i class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortArchivedStudents('studentID')">Student ID <i class="fas fa-sort"></i>
                        </th>
                        <th onclick="filterAndSortArchivedStudents('phone')">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <i class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortArchivedStudents('teacherName')">Ø§Ù„Ù…Ø¹Ù„Ù… <i class="fas fa-sort"></i>
                        </th>
                        <th onclick="filterAndSortArchivedStudents('packageName')">Ø§Ù„Ø¨Ø§Ù‚Ø© <i class="fas fa-sort"></i>
                        </th>
                        <th onclick="filterAndSortArchivedStudents('subscriptionType')">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ <i
                                class="fas fa-sort"></i>
                        </th>
                        <th onclick="filterAndSortArchivedStudents('archivedDate')">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø±Ø´ÙØ© <i
                                class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortArchivedStudents('archiveReason')">Ø³Ø¨Ø¨ Ø§Ù„Ø£Ø±Ø´ÙØ© <i
                                class="fas fa-sort"></i></th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="8" class="no-data-message">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø±Ø´ÙÙŠÙ†...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ğŸ”™ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© -->
        <div class="button-container">
            <button class="button back-button" onclick="showPage('main-page')">
                <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
        </div>
    </div>


    <div id="manage-slots-page" class="page-section">
        <h2><i class="fas fa-clock"></i> Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</h2>

        <!-- ğŸ”½ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¹Ù„Ù… -->
        <div class="form-group">
            <label for="selectManageTeacher">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
            <select id="selectManageTeacher" onchange="loadTeacherSlotsForManagement()"
                style="max-width: 300px; width: 100%; padding: 10px; border-radius: 8px;">
            </select>
        </div>

        <!-- ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… ÙˆÙ…ÙˆØ§Ø¹ÙŠØ¯Ù‡ -->
        <div id="manageSlotsTeacherInfo" class="hidden styled-form-box">

            <div class="teacher-name-display" id="manageSlotsTeacherName"
                style="margin-bottom: 10px; font-weight: bold;">
            </div>

            <p id="noManageSlotsMessage" class="no-slots-message hidden">
                Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø¶Ø§ÙØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ù„Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.
            </p>

            <div class="table-responsive">
                <table class="teacher-slots-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ÙŠÙˆÙ…</th>
                            <th>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø© / Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="teacherSlotsTableBody">
                        <!-- ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </tbody>
                </table>
            </div>

            <p id="manageSlotsStatusMessage" class="status-message hidden"></p>
        </div>

        <!-- ğŸ”™ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ -->
        <div class="button-container">
            <button class="button back-button" onclick="showPage('main-page')">
                <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
        </div>
    </div>


    <div id="timeSlotSelectionModal" class="modal-overlay hidden">
        <div class="modal-content">
            <!-- âŒ Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ -->
            <button class="modal-close-button" onclick="closeTimeSlotModal()">
                <i class="fas fa-times"></i>
            </button>

            <!-- ğŸ—“ï¸ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙŠÙˆÙ… -->
            <h3 id="modalDayTitle">ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙŠÙˆÙ…</h3>

            <!-- ğŸ•˜ Ø§Ù„ÙØªØ±Ø§Øª -->
            <div class="time-slots-modal-sections">

                <div class="slots-section">
                    <h4>Ù…ÙˆØ§Ø¹ÙŠØ¯ ØµØ¨Ø§Ø­ÙŠØ© (09:00 Øµ - 03:00 Ù…)</h4>
                    <div class="time-slots-grid" id="morningSlotsGrid">
                        <!-- Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>

                <div class="slots-section">
                    <h4>Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø³Ø§Ø¦ÙŠØ© (03:00 Ù… - 11:30 Ù…)</h4>
                    <div class="time-slots-grid" id="eveningSlotsGrid">
                        <!-- Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ© ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </div>

            <!-- âœ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
            <div class="modal-actions">
                <button class="button save-button" onclick="saveSelectedSlots()">
                    <i class="fas fa-check-circle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
                </button>
                <button class="button cancel-button" onclick="closeTimeSlotModal()">
                    <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>


    <div id="convert-trial-page" class="page-section">
        <h2><i class="fas fa-sync-alt"></i> ØªØ­ÙˆÙŠÙ„ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¥Ù„Ù‰ Ù…Ø´ØªØ±Ùƒ</h2>

        <!-- ğŸ” Ø§Ù„Ø¨Ø­Ø« -->
        <div class="form-row">
            <div class="column-75">
                <label for="searchTrialStudentId">Ø§Ø¨Ø­Ø« Ø¨Ù€ Trial ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                <input type="text" id="searchTrialStudentId" placeholder="Ø£Ø¯Ø®Ù„ Trial ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
            </div>
            <div class="column-25">
                <button class="button primary full-width" onclick="fetchTrialStudentForConversion()"
                    id="searchConvertTrialButton">
                    <i class="fas fa-search"></i> Ø¨Ø­Ø«
                </button>
            </div>
        </div>

        <!-- ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ -->
        <div id="convertTrialStudentForm" class="hidden styled-form-box">
            <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ: <span id="trialStudentNameDisplay"></span></h3>
            <p>Trial ID: <strong id="displayTrialStudentId"></strong></p>
            <p>Ø§Ù„Ù…Ø¹Ù„Ù…: <span id="displayTrialTeacherName"></span></p>
            <p>Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯: <span id="displayTrialDayTime"></span></p>

            <div class="form-group">
                <label for="convertPackage">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©:</label>
                <select id="convertPackage" required>
                    <option value="" disabled selected>Ø§Ø®ØªØ± Ø¨Ø§Ù‚Ø©</option>
                </select>
            </div>

            <div class="form-group">
                <label for="convertPaymentStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:</label>
                <select id="convertPaymentStatus" required>
                    <option value="" disabled selected>Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</option>
                </select>
            </div>




            <div class="form-group">
                <label for="convertSubscriptionType">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</label>
                <select id="convertSubscriptionType" required>
                    <option value="" disabled selected>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</option>
                </select>
            </div>

            <!-- âœ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
            <div class="form-group buttons">
                <button type="button" class="button primary" id="convertStudentButton" onclick="initiateConversion()">
                    <i class="fas fa-exchange-alt"></i> ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨
                </button>
                <button type="button" class="button back-button" onclick="showPage('main-page')">
                    <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>
        </div>

        <!-- âœ… Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ -->
        <p id="convertTrialStatusMessage" class="status-message hidden"></p>
    </div>



    <div id="renewal-needed-students-page" class="page-section">
        <h1><i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯</h1>

        <!-- ğŸ” Ø§Ù„ÙÙ„Ø§ØªØ± -->
        <div class="filters-grid">
            <div class="filter-item">
                <label for="renewalNeededSearch">Ø¨Ø­Ø« (Ø§Ù„Ø§Ø³Ù…ØŒ IDØŒ Ø§Ù„Ù‡Ø§ØªÙ):</label>
                <input type="text" id="renewalNeededSearch" placeholder="Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§..."
                    onkeyup="filterAndSortRenewalNeededStudents()">
            </div>
            <div class="filter-item">
                <label for="filterRenewalNeededStatus">Ø³Ø¨Ø¨ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯:</label>
                <select id="filterRenewalNeededStatus" onchange="filterAndSortRenewalNeededStudents()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨</option>
                    <option value="Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø­ØµØµ">Ø¨Ø³Ø¨Ø¨ Ø§Ø³ØªÙ†ÙØ§Ø¯ Ø§Ù„Ø­ØµØµ</option>
                    <option value="Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø¯Ø©">Ø¨Ø³Ø¨Ø¨ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø©</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="filterRenewalNeededTeacher">Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
                <select id="filterRenewalNeededTeacher" onchange="filterAndSortRenewalNeededStudents()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</option>
                </select>
            </div>
        </div>

        <!-- ğŸ”„ ØªØ­Ø¯ÙŠØ« -->
        <div class="button-container" style="justify-content: flex-start; margin-bottom: 20px;">
            <button class="button refresh-button" onclick="loadRenewalNeededStudentsData()">
                <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            </button>
        </div>

        <!-- ğŸ“‹ Ø¬Ø¯ÙˆÙ„ -->
        <div class="table-responsive">
            <table id="renewalNeededStudentsTable">
                <thead>
                    <tr>
                        <th onclick="filterAndSortRenewalNeededStudents('name')">Ø§Ù„Ø§Ø³Ù… <i class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortRenewalNeededStudents('studentID')">Student ID <i
                                class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortRenewalNeededStudents('phone')">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <i class="fas fa-sort"></i>
                        </th>
                        <th onclick="filterAndSortRenewalNeededStudents('teacherName')">Ø§Ù„Ù…Ø¹Ù„Ù… <i
                                class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortRenewalNeededStudents('packageName')">Ø§Ù„Ø¨Ø§Ù‚Ø© <i
                                class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortRenewalNeededStudents('renewalStatus')">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ <i
                                class="fas fa-sort"></i>
                        </th>
                        <th onclick="filterAndSortRenewalNeededStudents('reasonForRenewal')">Ø³Ø¨Ø¨ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ <i
                                class="fas fa-sort"></i>
                        </th>
                        <th onclick="filterAndSortRenewalNeededStudents('remainingSessions')">Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© <i
                                class="fas fa-sort"></i></th>
                        <th onclick="filterAndSortRenewalNeededStudents('lastRenewalDate')">Ø¢Ø®Ø± ØªØ¬Ø¯ÙŠØ¯ <i
                                class="fas fa-sort"></i>
                        </th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="10" class="no-data-message">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© -->
        <div class="button-container">
            <button class="button back-button" onclick="showPage('main-page')">
                <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
        </div>
    </div>


    <div id="payment-records-page" class="page-section">
        <h1><i class="fas fa-money-bill-wave"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h1>

        <div class="form-row double-column">
            <!-- ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
            <div class="styled-form-box">
                <h3><i class="fas fa-plus-circle"></i> ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>

                <div class="form-group">
                    <label for="paymentStudentId">Student ID:</label>
                    <input type="text" id="paymentStudentId" placeholder="Ø£Ø¯Ø®Ù„ Student ID" required>
                </div>

                <div class="form-group">
                    <label for="paymentDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹Ø©:</label>
                    <input type="date" id="paymentDate" required>
                </div>

                <div class="form-group">
                    <label for="paymentAmount">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</label>
                    <input type="number" id="paymentAmount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" required>
                </div>

                <div class="form-group">
                    <label for="paymentMethod">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
                    <select id="paymentMethod" required>
                        <option value="" disabled selected>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</option>
                        <option value="Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ">Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ</option>
                        <option value="ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
                        <option value="ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                        <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="paymentNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                    <textarea id="paymentNotes" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <button class="button primary" onclick="submitPaymentRecord()">
                        <i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©
                    </button>
                    <p id="paymentStatusMessage" class="status-message hidden"></p>
                </div>
            </div>

            <!-- ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª -->
            <div class="styled-form-box">
                <h3><i class="fas fa-file-invoice-dollar"></i> Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ù„Ù„Ø·Ø§Ù„Ø¨</h3>

                <div class="form-group">
                    <label for="paymentRecordStudentId">Student ID:</label>
                    <input type="text" id="paymentRecordStudentId" placeholder="Ø£Ø¯Ø®Ù„ Student ID"
                        onkeyup="loadPaymentRecords()">
                </div>

                <div class="table-responsive">
                    <table id="paymentRecordsTable">
                        <thead>
                            <tr>
                                <th>Payment ID</th>
                                <th>Subscription ID</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹Ø©</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                                <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                                <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" class="no-data-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ğŸ”™ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ -->
        <div class="button-container">
            <button class="button back-button" onclick="showPage('main-page')">
                <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
        </div>
    </div>


    <div id="renewal-subscription-page" class="page-section">
        <h1><i class="fas fa-sync-alt"></i> ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø·Ø§Ù„Ø¨</h1>

        <!-- ğŸ” Ø§Ù„Ø¨Ø­Ø« -->
        <div class="form-row">
            <div class="column-75">
                <label for="searchStudentIdRenewal">Ø§Ø¨Ø­Ø« Ø¨Ù€ Student ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                <input type="text" id="searchStudentIdRenewal" placeholder="Ø£Ø¯Ø®Ù„ Student ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
            </div>
            <div class="column-25">
                <button class="button primary full-width" onclick="fetchStudentForRenewal()" id="searchRenewalButton">
                    <i class="fas fa-search"></i> Ø¨Ø­Ø«
                </button>
            </div>
        </div>

        <!-- ğŸ§¾ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ -->
        <div id="renewalStudentForm" class="hidden styled-form-box">
            <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨: <span id="renewalStudentNameDisplay"></span></h3>

            <div class="student-info-list">
                <p><strong>Student ID:</strong> <span id="displayRenewalStudentId"></span></p>
                <p><strong>Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> <span id="displayRenewalTeacherName"></span></p>
                <p><strong>Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong> <span id="displayRenewalCurrentPackage"></span></p>
                <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong> <span id="displayRenewalCurrentStatus"></span></p>
                <p><strong>Ø§Ù„Ø­ØµØµ Ø§Ù„Ø­Ø§Ø¶Ø±Ø©:</strong> <span id="displayRenewalAttendedSessions"></span></p>
                <p><strong>ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ¬Ø¯ÙŠØ¯:</strong> <span id="displayRenewalLastRenewalDate"></span></p>
                <p><strong>ØªØ§Ø±ÙŠØ® Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</strong> <span id="displayRenewalEndDate"></span></p>
            </div>

            <hr>

            <!-- ğŸ” Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ -->
            <h4>ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</h4>

            <div class="form-group">
                <label for="renewalNewPackage">Ø¨Ø§Ù‚Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                <select id="renewalNewPackage" required>
                    <option value="" disabled selected>Ø§Ø®ØªØ± Ø¨Ø§Ù‚Ø©</option>
                </select>
            </div>

            <div class="form-group">
                <label for="renewalPaymentStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù„ØªØ¬Ø¯ÙŠØ¯:</label>
                <select id="renewalPaymentStatus" required>
                    <option value="" disabled selected>Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</option>
                </select>
            </div>

            <div class="form-group">
                <label for="renewalNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <textarea id="renewalNotes" rows="2"></textarea>
            </div>

            <!-- âœ… Ø£Ø²Ø±Ø§Ø± -->
            <div class="form-group buttons">
                <button type="button" class="button primary" onclick="submitRenewalData()">
                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯
                </button>
                <button type="button" class="button back-button" onclick="showPage('main-page')">
                    <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>
        </div>

        <!-- ğŸ”” Ø§Ù„Ø­Ø§Ù„Ø© -->
        <p id="renewalStatusMessage" class="status-message hidden"></p>
    </div>


    <div id="toast-container"></div>

    <script>
        // ************************************ //
        //          Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ© Ù…Ø´ØªØ±ÙƒØ© (ØªØ¹Ø±Ù Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·) //
        // ************************************ //
        let teacherData = {}; // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ù…ÙˆØ§Ø¹ÙŠØ¯Ù‡Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©ØŒ ØªØ¬Ù„Ø¨Ù‡Ø§ Ø¯Ø§Ù„Ø© getTeacherData)
        let studentData = {}; // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø­Ù…Ù„Ø© ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (edit-student-page)
        let allStudentsRawData = []; // ØªØ®Ø²ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„ÙÙ„ØªØ±ØªÙ‡Ø§ ÙˆÙØ±Ø²Ù‡Ø§ (all-students-page)
        let archivedStudentsRawData = []; // ØªØ®Ø²ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø±Ø´ÙÙŠÙ† (archive-page)
        let selectedConvertPackageWeeklySessions = 0;

        let currentTeacherName = ''; // Ù„ØµÙØ­Ø© Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
        let currentDay = ''; // Ù„ØµÙØ­Ø© Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† (ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©)

        let currentManageSlotsTeacherName = ''; // Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
        let currentManageSlotsTeacherId = '';
        let currentTeacherAllAvailableSlots = []; // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø©/Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø© Ù„Ù„Ù…Ø¹Ù„Ù… Ù…Ù† Ø´ÙŠØª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
        let modalSelectedDay = ''; // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø°ÙŠ ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ§Ø¹ÙŠØ¯Ù‡ ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯)
        let modalSelectedSlots = []; // Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯)

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ÙØ±Ø² (Ù…Ø´ØªØ±ÙƒØ© Ù„Ù€ all-students-page Ùˆ archive-page)
        let sortColumn = null;
        let sortDirection = 'asc';
        let archiveSortColumn = null;
        let archiveSortDirection = 'asc';

        let selectedPackageWeeklySessions = 0;

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© (ØªØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯)
        const possibleTimeSlots24Hour = [
            "09:00 - 09:30", "09:30 - 10:00", "10:00 - 10:30", "10:30 - 11:00",
            "11:00 - 11:30", "11:30 - 12:00", "12:00 - 12:30", "12:30 - 13:00",
            "13:00 - 13:30", "13:30 - 14:00", "14:00 - 14:30", "14:30 - 15:00",
            "15:00 - 15:30", "15:30 - 16:00", "16:00 - 16:30", "16:30 - 17:00",
            "17:00 - 17:30", "17:30 - 18:00", "18:00 - 18:30", "18:30 - 19:00",
            "19:00 - 19:30", "19:30 - 20:00", "20:00 - 20:30", "20:30 - 21:00",
            "21:00 - 21:30", "21:30 - 22:00", "22:00 - 22:30", "22:30 - 23:00",
            "23:00 - 23:30", "23:30 - 00:00" // ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø§Ø¹ØªÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ØªÙŠÙ†
        ];

        function closeTimeSlotModal() {
            document.getElementById('timeSlotSelectionModal').classList.add('hidden');
            // Clear modal state if necessary
            modalSelectedSlots = [];
            modalSelectedDay = '';
        }




        function createSlotFields(containerId, index, isRequired, teacherSelectId = 'regTeacher', retryCount = 0) {
            const container = document.getElementById(containerId);
            const teacherSelect = document.getElementById(teacherSelectId);
            const teacherName = teacherSelect ? teacherSelect.value : '';

            if (!teacherData || typeof teacherData !== 'object' || !teacherData[teacherName]) {
                if (retryCount < 10) {
                    setTimeout(() => createSlotFields(containerId, index, isRequired, teacherSelectId, retryCount + 1), 100);
                    console.warn(`â³ Retrying to create slot fields for '${teacherName}'... Attempt ${retryCount + 1}`);
                }
                return;
            }

            const fieldset = document.createElement('fieldset');
            fieldset.className = 'form-row dynamic-slot-row';
            fieldset.setAttribute('data-slot-index', index);

            fieldset.innerHTML = `
        <legend>Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯ ${index + 1}:</legend>
        <div class="column-50">
            <label for="slotDay${index}">Ø§Ù„ÙŠÙˆÙ…:</label>
            <select id="slotDay${index}" onchange="updateDynamicTimes('slotDay${index}', 'slotTime${index}', '${teacherSelect.id}')" ${isRequired ? 'required' : ''}>
                <option value="" disabled selected>Ø§Ø®ØªØ± ÙŠÙˆÙ…Ù‹Ø§</option>
            </select>
        </div>
        <div class="column-50">
            <label for="slotTime${index}">Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯:</label>
            <select id="slotTime${index}" ${isRequired ? 'required' : ''}>
                <option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§</option>
            </select>
        </div>
        ${index > 0 ? `<button type="button" class="button button-delete-slot" onclick="removeSlotField(${index})">
            <i class="fas fa-times-circle"></i> Ø­Ø°Ù
        </button>` : ''}
    `;

            container.appendChild(fieldset);

            const daySelect = fieldset.querySelector(`#slotDay${index}`);
            const daysForTeacher = Object.keys(teacherData[teacherName]).sort();

            daysForTeacher.forEach(day => {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = day;
                daySelect.appendChild(option);
            });
        }



        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø²Ø§Ù„Ø© Ø­Ù‚Ù„ Ù…ÙŠØ¹Ø§Ø¯ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ (Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù)
        function removeSlotField(index) {
            const fieldsetToRemove = document.querySelector(`fieldset[data-slot-index="${index}"]`);
            if (fieldsetToRemove) {
                fieldsetToRemove.remove();
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© (ØªÙØ³ØªØ®Ø¯Ù… Ù„ÙƒÙ„ Ù…Ù† reg- Ùˆ edit- pages)
        function updateDynamicTimes(dayId, timeId, teacherId = 'regTeacher', retryCount = 0) {
            const teacherSelect = document.getElementById(teacherId);
            const teacherName = teacherSelect ? teacherSelect.value : '';
            const daySelect = document.getElementById(dayId);
            const timeSelect = document.getElementById(timeId);
            const day = daySelect ? daySelect.value : '';

            if (!teacherName || !day || !teacherData || !teacherData[teacherName] || !teacherData[teacherName][day]) {
                if (retryCount < 10) {
                    console.warn(`â³ Retrying updateDynamicTimes for "${teacherName}" on "${day}"... Attempt ${retryCount + 1}`);
                    setTimeout(() => updateDynamicTimes(dayId, timeId, teacherId, retryCount + 1), 100);
                }
                return;
            }

            const availableTimes = teacherData[teacherName][day].sort((a, b) => getTimeInMinutes(a) - getTimeInMinutes(b));
            timeSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§</option>';

            availableTimes.forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = formatTime12Hour(time);
                timeSelect.appendChild(option);
            });
        }



        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©        //
        // ************************************ //

        /**
     * Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± ØµÙØ­Ø© Ù…Ø¹ÙŠÙ†Ø© ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ù‚ÙŠØ©.
     * @param {string} pageId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ div Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¸Ù‡Ø§Ø±Ù‡Ø§.
     * @param {function} [callback] - Ø¯Ø§Ù„Ø© ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ Ø¨Ø¹Ø¯ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© (Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø«Ù„Ø§Ù‹).
     */
        function showPage(pageId, callback) { // <--- ØªØ£ÙƒØ¯ Ø£Ù†Ù‡Ø§ Ù…Ø¹Ø±ÙØ© Ù‡ÙƒØ°Ø§
            const pages = document.querySelectorAll('.page-section');
            pages.forEach(page => page.classList.remove('active')); // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª

            const activePage = document.getElementById(pageId);
            if (activePage) {
                activePage.classList.add('active'); // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                window.scrollTo(0, 0); // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©

                if (typeof callback === 'function') {
                    callback(); // ØªÙ†ÙÙŠØ° Ø¯Ø§Ù„Ø© Ø§Ù„Ù€ callback (Ù…Ø«Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª) Ø¨Ø¹Ø¯ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø©
                }
            } else {
                console.error(`Page with ID '${pageId}' not found.`);
                showToast(`Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© '${pageId}'.`, 'error');
            }
        }

        /**
         * Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø¤Ù‚ØªØ© (Toasts).
         * @param {string} message - Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.
         * @param {string} type - Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ('success', 'error', 'info').
         * @param {number} duration - Ù…Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©.
         */
        function showToast(message, type = 'info', duration = 3000) {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                console.error('Toast container not found!');
                alert(message); // Fallback to alert
                return;
            }

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            let iconHtml = '';
            if (type === 'success') {
                iconHtml = '<i class="fas fa-check-circle"></i>';
            } else if (type === 'error') {
                iconHtml = '<i class="fas fa-exclamation-circle"></i>';
            } else { // info
                iconHtml = '<i class="fas fa-info-circle"></i>';
            }

            toast.innerHTML = `${message} ${iconHtml}`;
            toastContainer.appendChild(toast);

            // Show the toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10); // Small delay for CSS transition

            // Hide and remove the toast
            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => {
                    toast.remove();
                });
            }, duration);
        }


        /**
         * Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ (9Øµ -> 09:00ØŒ p 3 -> 15:00) Ù„Ù„ÙØ±Ø² ÙˆØ§Ù„ØªØ¹Ø§Ù…Ù„.
         * ØªÙØªØ±Ø¶ Ø£Ù† "9Øµ" Ø£Ùˆ "p 3" ØªÙ…Ø«Ù„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯.
         * @param {string} timeString - Ø³Ù„Ø³Ù„Ø© Ø§Ù„ÙˆÙ‚Øª (Ù…Ø«Ù„ "9Øµ", "1:30 Ù…", "p 3", "09:00 - 09:30").
         * @returns {string} Ø§Ù„ÙˆÙ‚Øª Ø¨ØªÙ†Ø³ÙŠÙ‚ 24 Ø³Ø§Ø¹Ø© (HH:mm).
         */
        function convertTo24HourFormat(timeString) {
            if (typeof timeString !== 'string' || timeString.trim() === '') return '00:00';
            timeString = timeString.trim();

            // 1. Ù„Ùˆ Ø§Ù„ÙˆÙ‚Øª Ø¬Ø§ÙŠ Ø¨ØªÙ†Ø³ÙŠÙ‚ "HH:MM - HH:MM" (Ù…Ù† Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„Ø´ÙŠØª)
            const parts = timeString.split(' - ');
            if (parts.length > 1 && parts[0].includes(':')) {
                timeString = parts[0]; // Ù†Ø£Ø®Ø° Ø¬Ø²Ø¡ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙÙ‚Ø· (HH:MM)
            }

            // 2. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ "p X" (Ù…Ø³Ø§Ø¦ÙŠ)
            if (timeString.toLowerCase().startsWith('p ')) {
                const hourPart = parseInt(timeString.substring(2)); // Ø§Ù„Ø±Ù‚Ù… Ø¨Ø¹Ø¯ p
                if (!isNaN(hourPart) && hourPart >= 1 && hourPart <= 12) {
                    const hour24 = (hourPart === 12) ? 12 : hourPart + 12; // 12Ù… ØªØ¨Ù‚Ù‰ 12ØŒ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù†Ø²ÙŠØ¯ 12
                    return `${hour24.toString().padStart(2, '0')}:00`;
                }
            }
            // 3. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ "Øµ" (ØµØ¨Ø§Ø­ÙŠ)
            else if (timeString.toLowerCase().endsWith('Øµ')) {
                const hourPart = parseInt(timeString.replace('Øµ', ''));
                if (!isNaN(hourPart) && hourPart >= 1 && hourPart <= 12) {
                    const hour24 = (hourPart === 12) ? 0 : hourPart; // 12Øµ (Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„) ØªØ¨Ù‚Ù‰ 00ØŒ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙƒÙ…Ø§ Ù‡ÙŠ
                    return `${hour24.toString().padStart(2, '0')}:00`;
                }
            }
            // 4. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ "Ù…" (Ù…Ø³Ø§Ø¦ÙŠ)
            else if (timeString.toLowerCase().endsWith('Ù…')) {
                const hourPart = parseInt(timeString.replace('Ù…', ''));
                if (!isNaN(hourPart) && hourPart >= 1 && hourPart <= 12) {
                    const hour24 = (hourPart === 12) ? 12 : hourPart + 12; // 12Ù… (Ø§Ù„Ø¸Ù‡Ø±) ØªØ¨Ù‚Ù‰ 12ØŒ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù†Ø²ÙŠØ¯ 12
                    return `${hour24.toString().padStart(2, '0')}:00`;
                }
            }
            // 5. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ 00:00 (Ù…Ø«Ù„ 09:00) Ø£Ùˆ 8:30 (Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)
            else if (timeString.includes(':')) {
                const [hours, minutes] = timeString.split(':').map(Number);
                if (!isNaN(hours) && !isNaN(minutes)) {
                    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                }
            }
            // 6. Ù„Ùˆ Ø§Ù„ÙˆÙ‚Øª Ø±Ù‚Ù… ÙÙ‚Ø· (Ù…Ø«Ù„ 9 Ø£Ùˆ 10)
            else {
                const hourPart = parseInt(timeString);
                if (!isNaN(hourPart) && hourPart >= 0 && hourPart <= 23) {
                    return `${hourPart.toString().padStart(2, '0')}:00`;
                }
            }
            console.warn("Warning: Could not convert time string to 24-hour format: " + timeString);
            return '00:00'; // Fallback
        }

        /**
         * Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø³Ù„Ø³Ù„Ø© Ø§Ù„ÙˆÙ‚Øª (Ø£Ùˆ Ø±Ø£Ø³ Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯) Ø¥Ù„Ù‰ Ø¯Ù‚Ø§Ø¦Ù‚ Ù„ØºØ±Ø¶ Ø§Ù„ÙØ±Ø².
         * ØªØ³ØªØ®Ø¯Ù… convertTo24HourFormat Ù„Ø¶Ù…Ø§Ù† ØªØ­ÙˆÙŠÙ„ Ø£ÙŠ ØªÙ†Ø³ÙŠÙ‚.
         * @param {string} timeString - Ø³Ù„Ø³Ù„Ø© Ø§Ù„ÙˆÙ‚Øª.
         * @returns {number} Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ù† Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„.
         */
        function getTimeInMinutes(timeString) {
            if (typeof timeString !== 'string' || timeString.trim() === '') return 0;

            const time24hrPart = convertTo24HourFormat(timeString);

            const [hours, minutes] = time24hrPart.split(':').map(Number);
            if (isNaN(hours) || isNaN(minutes)) return 0;
            return hours * 60 + minutes;
        }

        /**
     * Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ ØªÙ†Ø³ÙŠÙ‚ 24 Ø³Ø§Ø¹Ø© (HH:mm) Ø£Ùˆ (HH:mm - HH:mm) Ø¥Ù„Ù‰ 12 Ø³Ø§Ø¹Ø© (H:mm Øµ/Ù…).
     * @param {string} timeString - Ø§Ù„ÙˆÙ‚Øª Ø¨ØªÙ†Ø³ÙŠÙ‚ 24 Ø³Ø§Ø¹Ø© (Ù…Ø«Ù„Ø§Ù‹ "13:30" Ø£Ùˆ "09:00 - 09:30").
     * @returns {string} Ø§Ù„ÙˆÙ‚Øª Ø¨ØªÙ†Ø³ÙŠÙ‚ 12 Ø³Ø§Ø¹Ø© (Ù…Ø«Ù„Ø§Ù‹ "1:30 Ù…").
     */
        window.formatTime12Hour = function (timeString) { // ØªØ£ÙƒØ¯ Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø¹Ø±ÙØ© Ø¹Ù„Ù‰ window
            if (typeof timeString !== 'string' || timeString.trim() === '') return 'ÙˆÙ‚Øª ØºÙŠØ± ØµØ§Ù„Ø­';

            // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª Ù‡Ùˆ "HH:MM - HH:MM"ØŒ Ù†Ø£Ø®Ø° Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙˆÙ„ ÙÙ‚Ø·
            let time24hrPart = timeString.split(' - ')[0].trim();

            if (!time24hrPart.includes(':')) return 'ÙˆÙ‚Øª ØºÙŠØ± ØµØ§Ù„Ø­';

            const [hours, minutes] = time24hrPart.split(':').map(Number);
            if (isNaN(hours) || isNaN(minutes)) return 'ÙˆÙ‚Øª ØºÙŠØ± ØµØ§Ù„Ø­';

            const ampm = hours >= 12 ? 'Ù…' : 'Øµ';
            const formattedHours = hours % 12 || 12; // 00:00 (Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„) ØªÙƒÙˆÙ† 12 ØµØŒ 12:00 (Ø§Ù„Ø¸Ù‡Ø±) ØªÙƒÙˆÙ† 12 Ù…

            return `${formattedHours}:${minutes < 10 ? '0' : ''}${minutes} ${ampm}`;
        };
        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ form-page      //
        // ************************************ //
        function loadFormDependencies() {
            document.getElementById('dataForm').reset(); // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            loadTeachersOptions('regTeacher'); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            loadPaymentStatusOptions('regPaymentStatus'); // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹
            loadSubscriptionPackagesOptions('regSubscriptionPackage'); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
            loadSubscriptionTypesOptions('regSubscriptionType');
            updateRegDays(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø£ÙŠØ§Ù… ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
        }

        /**
         * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ† Ù„Ù€ form-page
         * @param {string} selectId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.
         */
        function loadTeachersOptions(selectId, afterLoadCallback = null) {
            google.script.run.withSuccessHandler(data => {
                if (data.error) {
                    showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†: ${data.error}`, 'error');
                    return;
                }

                teacherData = data;

                const teacherSelect = document.getElementById(selectId);
                teacherSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ù‹Ø§</option>';

                Object.keys(teacherData).forEach(teacher => {
                    const option = document.createElement('option');
                    option.value = teacher;
                    option.textContent = teacher;
                    teacherSelect.appendChild(option);
                });

                if (typeof afterLoadCallback === 'function') {
                    afterLoadCallback(); // ğŸ“Œ ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ø¨Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙ‚Ø·
                }
            }).getTeacherData();
        }


        /**
         * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù€ form-page
         * @param {string} selectId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹.
         */
        window.loadPaymentStatusOptions = function (selectId) {
            google.script.run.withSuccessHandler(statuses => {
                const paymentStatusSelect = document.getElementById(selectId);
                paymentStatusSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</option>'; // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                statuses.forEach(status => {
                    const option = document.createElement('option');
                    option.value = status;
                    option.textContent = status;
                    paymentStatusSelect.appendChild(option);
                });
            }).getPaymentStatusList(); // Ø¯Ø§Ù„Ø© ÙÙŠ Code.gs
        }

        /**
         * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ù€ form-page
         * @param {string} selectId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.
         */
        window.loadSubscriptionPackagesOptions = function (selectId) {
            google.script.run.withSuccessHandler(packages => {
                const subscriptionPackageSelect = document.getElementById(selectId);
                subscriptionPackageSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ø¨Ø§Ù‚Ø©</option>'; // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                packages.forEach(pkg => {
                    const option = document.createElement('option');
                    option.value = pkg;
                    option.textContent = pkg;
                    subscriptionPackageSelect.appendChild(option);
                });
            }).getSubscriptionPackageList(); // Ø¯Ø§Ù„Ø© ÙÙŠ Code.gs
        }


        /**
     * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…ØªØ§Ø­Ø©.
     * @param {string} selectId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.
     */
        window.loadSubscriptionTypesOptions = function (selectId) {
            const subscriptionTypeSelect = document.getElementById(selectId);
            subscriptionTypeSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</option>';
            const types = [
                "ÙØ±Ø¯ÙŠ ØµØºØ§Ø±",
                "ÙØ±Ø¯ÙŠ ÙƒØ¨Ø§Ø±",
                "Ø¬Ù…Ø§Ø¹ÙŠ",
                "Ù†ÙˆØ± Ø¨ÙŠØ§Ù†"
            ];
            types.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                subscriptionTypeSelect.appendChild(option);
            });
        };



        /**
         * ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØ§Ø± ÙÙŠ form-page.
         */
        function updateRegDays() {
            const teacher = document.getElementById('regTeacher').value;
            // Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ù„Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
            const daySelects = document.querySelectorAll('#dynamicRegSlotsContainer select[id^="slotDay"]');
            const timeSelects = document.querySelectorAll('#dynamicRegSlotsContainer select[id^="slotTime"]');

            daySelects.forEach(select => select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± ÙŠÙˆÙ…Ù‹Ø§</option>');
            timeSelects.forEach(select => select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§</option>');

            if (!teacher || !teacherData[teacher]) {
                return;
            }

            const daysForTeacher = Object.keys(teacherData[teacher]).sort();

            daySelects.forEach(daySelect => {
                daysForTeacher.forEach(day => {
                    const option = document.createElement('option');
                    option.value = day;
                    option.textContent = day;
                    daySelect.appendChild(option);
                });
            });
            // Ù„Ø§ Ù†Ø­ØªØ§Ø¬ Ù„Ù€ updateDynamicRegSlots Ù‡Ù†Ø§ Ù„Ø£Ù†Ù‡Ø§ Ø³ØªÙØ³ØªØ¯Ø¹Ù‰ Ù…Ù† onchange ÙÙŠ teacherSelect.
        }



        /**
         * ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© ÙÙŠ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯.
         */
        function updateDynamicRegSlots() {
            const packageSelect = document.getElementById('regSubscriptionPackage');
            const teacherSelect = document.getElementById('regTeacher');
            const container = document.getElementById('dynamicRegSlotsContainer');
            container.innerHTML = ''; // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

            if (!packageSelect.value || !teacherSelect.value) {
                selectedPackageWeeklySessions = 0; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                return;
            }

            // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù…Ù† Apps Script
            google.script.run
                .withSuccessHandler(packageDetails => {
                    if (packageDetails && packageDetails['Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©'] !== undefined) {
                        selectedPackageWeeklySessions = parseInt(packageDetails['Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©']) || 0;
                    } else {
                        selectedPackageWeeklySessions = 0; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ùˆ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø£Ùˆ Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ
                    }

                    if (selectedPackageWeeklySessions > 0) {
                        for (let i = 0; i < selectedPackageWeeklySessions; i++) {
                            // Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ø§Ù„Ø£ÙˆÙ„ ÙÙ‚Ø· Ù…Ø·Ù„ÙˆØ¨ØŒ Ø§Ù„Ø¨Ù‚ÙŠØ© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±)
                            createSlotFields('dynamicRegSlotsContainer', i, i === 0);
                        }
                    } else {
                        container.innerHTML = '<p class="no-data-message">Ø§Ø®ØªØ± Ø¨Ø§Ù‚Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ù…Ø­Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø­ØµØµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©.</p>';
                    }
                })
                .withFailureHandler(error => {
                    showToast(`Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø©: ${error.message}`, 'error');
                    console.error("Error fetching package details:", error);
                    selectedPackageWeeklySessions = 0; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                })
                .getPackageDetails(packageSelect.value);
        }


        /**
         * ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØ§Ø± ÙÙŠ form-page.
         * @param {string} dayId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ù„ÙŠÙˆÙ….
         * @param {string} timeId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ù„Ù…ÙŠØ¹Ø§Ø¯.
         */
        function updateRegTimes(dayId, timeId) {
            const teacher = document.getElementById('regTeacher').value;
            const day = document.getElementById(dayId).value;
            const timeSelect = document.getElementById(timeId);

            timeSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§</option>';
            if (timeId === 'regTime2') {
                timeSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>';
            }

            if (!teacher || !day || !teacherData[teacher][day]) {
                return;
            }

            // Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙˆÙØ±Ø²Ù‡Ø§
            const availableTimes = teacherData[teacher][day].sort((a, b) => getTimeInMinutes(a) - getTimeInMinutes(b));

            availableTimes.forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = formatTime12Hour(time); // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ø¨ØªÙ†Ø³ÙŠÙ‚ 12 Ø³Ø§Ø¹Ø©
                timeSelect.appendChild(option);
            });
        }

        function submitData() {
            const name = document.getElementById('regName').value.trim();
            const age = document.getElementById('regAge').value.trim();
            const phone = document.getElementById('regPhone').value.trim();
            const teacher = document.getElementById('regTeacher').value;
            const paymentStatus = document.getElementById('regPaymentStatus').value;
            const subscriptionPackage = document.getElementById('regSubscriptionPackage').value;
            const subscriptionType = document.getElementById('regSubscriptionType').value;

            // Ø¬Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
            const regSlots = [];
            const dynamicSlotFields = document.querySelectorAll('#dynamicRegSlotsContainer .dynamic-slot-row');
            dynamicSlotFields.forEach((fieldset, index) => {
                const daySelect = fieldset.querySelector(`#slotDay${index}`);
                const timeSelect = fieldset.querySelector(`#slotTime${index}`);
                const day = daySelect.value;
                const time = timeSelect.value;

                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ø§Ù„Ø£ÙˆÙ„ (index === 0) ÙˆÙ„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡ØŒ Ø£Ùˆ Ø£ÙŠ Ù…ÙŠØ¹Ø§Ø¯ Ø¢Ø®Ø± ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡ Ø¬Ø²Ø¦ÙŠØ§Ù‹
                if (index === 0 && (!day || !time)) {
                    showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.", 'error');
                    return; // Ù„Ø§ ØªÙƒÙ…Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                }
                if ((day && !time) || (!day && time)) {
                    showToast(`Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ù„Ù„Ø­ØµØ© ${index + 1}ØŒ Ø£Ùˆ Ø¥Ø²Ø§Ù„ØªÙ‡Ø§.`, 'error');
                    return; // Ù„Ø§ ØªÙƒÙ…Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                }
                if (day && time) { // Ø£Ø¶Ù Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒÙ„Ø§Ù‡Ù…Ø§ Ù…Ø­Ø¯Ø¯ÙŠÙ†
                    regSlots.push({ day: day, time: time });
                }
            });

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ø¨Ø§Ù‚Ø©
            if (regSlots.length !== selectedPackageWeeklySessions) {
                showToast(`Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ ${selectedPackageWeeklySessions} Ø­ØµØ© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ù„Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©. Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ­Ø¯ÙŠØ¯ ${regSlots.length} Ø­ØµØ©.`, 'error');
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            if (!name || !age || !phone || !teacher || !paymentStatus || !subscriptionPackage || !subscriptionType) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.", 'error');
                return;
            }

            const formData = {
                regName: name,
                regAge: age,
                regPhone: phone,
                regTeacher: teacher,
                regPaymentStatus: paymentStatus,
                regSubscriptionPackage: subscriptionPackage,
                regSubscriptionType: subscriptionType,
                regSlots: regSlots // <-- Ø¥Ø±Ø³Ø§Ù„ Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
            };

            const submitButton = document.querySelector('#form-page .button-primary');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            }

            google.script.run
                .withSuccessHandler(response => {
                    if (submitButton) {
                        submitButton.disabled = false;
                        submitButton.innerHTML = '<i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                    }

                    if (response.success) {
                        showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        document.getElementById('dataForm').reset();
                        loadFormDependencies(); // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                        showPage('main-page');
                    } else if (response.error) {
                        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + response.error, 'error');
                    }
                })
                .withFailureHandler(error => {
                    if (submitButton) {
                        submitButton.disabled = false;
                        submitButton.innerHTML = '<i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                    }
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ' + error.message, 'error');
                    console.error("Error submitting data:", error);
                })
                .saveData(formData);
        }


        /**
         * ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© ÙÙŠ ØµÙØ­Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨.
         * ÙˆØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø© Ù„Ù„Ø·Ø§Ù„Ø¨.
         */
        function updateDynamicEditSlots() {
            const packageSelect = document.getElementById('editSubscriptionPackage');
            const teacherSelect = document.getElementById('editTeacher');
            const container = document.getElementById('dynamicEditSlotsContainer');
            container.innerHTML = ''; // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

            if (!packageSelect.value || !teacherSelect.value) {
                selectedPackageWeeklySessions = 0; // âœ… ØªØ¹ÙŠÙŠÙ† selectedPackageWeeklySessions Ù‡Ù†Ø§
                return;
            }

            google.script.run
                .withSuccessHandler(packageDetails => {
                    // âœ… Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù€ sessionsCount ÙƒÙ…ØªØºÙŠØ± Ù…Ø­Ù„ÙŠ Ù‡Ù†Ø§ØŒ Ù†Ø³ØªØ®Ø¯Ù… selectedPackageWeeklySessions Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹
                    if (packageDetails && packageDetails['Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©'] !== undefined) {
                        selectedPackageWeeklySessions = parseInt(packageDetails['Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©']) || 0; // âœ… ØªØ¹ÙŠÙŠÙ† selectedPackageWeeklySessions Ù‡Ù†Ø§
                    } else {
                        selectedPackageWeeklySessions = 0; // âœ… ØªØ¹ÙŠÙŠÙ† selectedPackageWeeklySessions ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    }

                    if (selectedPackageWeeklySessions > 0) { // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… selectedPackageWeeklySessions
                        for (let i = 0; i < selectedPackageWeeklySessions; i++) {
                            createSlotFields('dynamicEditSlotsContainer', i, i === 0, 'editTeacher');
                        }
                    } else {
                        container.innerHTML = '<p class="no-data-message">Ø§Ø®ØªØ± Ø¨Ø§Ù‚Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ù…Ø­Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø­ØµØµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©.</p>';
                    }
                })
                .withFailureHandler(error => {
                    showToast(`Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø©: ${error.message}`, 'error');
                    console.error("Error fetching package details:", error);
                    selectedPackageWeeklySessions = 0; // âœ… ØªØ¹ÙŠÙŠÙ† selectedPackageWeeklySessions ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„
                })
                .getPackageDetails(packageSelect.value);
        }



        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ all-students-page //
        // ************************************ //
        function loadAllStudentsDependencies() {
            document.getElementById('allStudentsSearch').value = '';
            document.getElementById('filterTeacher').value = '';
            document.getElementById('filterPackage').value = '';
            document.getElementById('filterPaymentStatus').value = '';
            document.getElementById('filterRenewalStatus').value = '';

            loadTeachersOptions('filterTeacher'); // Ø¯Ø§Ù„Ø© Ù„Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙÙŠ Ø§Ù„ÙÙ„ØªØ±
            loadSubscriptionPackagesOptions('filterPackage'); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
            loadPaymentStatusOptions('filterPaymentStatus'); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹
            loadRenewalStatusOptions('filterRenewalStatus'); // Ø¯Ø§Ù„Ø© Ù„Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ (Ø¬Ø¯ÙŠØ¯Ø©/Ù…Ø¹Ø¯Ù„Ø©)

            loadAllStudentsData(); // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
        }

        /**
         * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ù„ÙÙ„ØªØ± ØµÙØ­Ø© "ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨".
         * @param {string} selectId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.
         */
        function loadTeachersOptions(selectId, afterLoadCallback = null) { // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ø±Ø§Ù…ØªØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯
            google.script.run.withSuccessHandler(data => {
                if (data.error) {
                    showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†: ${data.error}`, 'error');
                    return;
                }
                teacherData = data; // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù‡Ù†Ø§

                const teacherSelect = document.getElementById(selectId);
                teacherSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ù‹Ø§</option>'; // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                Object.keys(teacherData).forEach(teacher => {
                    const option = document.createElement('option');
                    option.value = teacher;
                    option.textContent = teacher;
                    teacherSelect.appendChild(option);
                });

                // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù€ Callback Ù‡Ù†Ø§
                if (typeof afterLoadCallback === 'function') {
                    afterLoadCallback();
                }

            }).getTeacherData(); // Ø¯Ø§Ù„Ø© ÙÙŠ Code.gs
        }

        /**
         * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ù„ÙÙ„ØªØ± ØµÙØ­Ø© "ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨".
         * @param {string} selectId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯.
         */
        function loadRenewalStatusOptions(selectId) {
            const renewalStatusSelect = document.getElementById(selectId);
            renewalStatusSelect.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>';
            const statuses = ["ØªØ¬Ø±ÙŠØ¨ÙŠ", "ØªÙ… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯", "ÙŠØ­ØªØ§Ø¬ Ù„Ù„ØªØ¬Ø¯ÙŠØ¯", "Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ", "ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯", "Ù„Ù… ÙŠØ´ØªØ±Ùƒ"]; // Ø£Ø¶Ù "ØªØ¬Ø±ÙŠØ¨ÙŠ" Ùˆ "Ù„Ù… ÙŠØ´ØªØ±Ùƒ"
            statuses.forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = status;
                renewalStatusSelect.appendChild(option);
            });
        }

        /**
        * Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø¬Ø¯ÙˆÙ„ ØµÙØ­Ø© "ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨".
        */
        function loadAllStudentsData() {
            const tableBody = document.querySelector('#allStudentsTable tbody');
            tableBody.innerHTML = '<tr><td colspan="12" class="no-data-message"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨...</td></tr>';

            const refreshButton = document.querySelector('#all-students-page .refresh-button');
            refreshButton.disabled = true;

            google.script.run
                .withSuccessHandler(response => { // ØªÙ… ØªØºÙŠÙŠØ± 'data' Ø¥Ù„Ù‰ 'response' Ù„Ù„ÙˆØ¶ÙˆØ­
                    // Ø³Ø¬Ù„Ø§Øª ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© - Ù…Ù‡Ù…Ø© Ø¬Ø¯Ø§Ù‹ Ù„ØªÙ‚ØµÙŠ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
                    console.log("Raw response received in loadAllStudentsData success handler:", response);
                    console.log("Type of raw response:", typeof response);
                    console.log("Is raw response null?", response === null);
                    console.log("Is raw response undefined?", response === undefined);
                    console.log("Does raw response have .error property?", response && response.error !== undefined);

                    refreshButton.disabled = false;

                    // Ø£ÙˆÙ„Ø§Ù‹ØŒ ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù†ÙØ³Ù‡Ø§ null Ø£Ùˆ undefined
                    if (response === null || response === undefined) {
                        tableBody.innerHTML = `<tr><td colspan="12" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙØ§Ø±ØºØ© Ø£Ùˆ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….</td></tr>`;
                        showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨: Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙØ§Ø±ØºØ© Ø£Ùˆ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©.`, 'error');
                        console.error("Error loading all students data: Received null/undefined response from backend.");
                        return;
                    }

                    // Ø§Ù„Ø¢Ù†ØŒ ØªØ­Ù‚Ù‚ Ø¨Ø£Ù…Ø§Ù† Ù…Ù† Ø®Ø§ØµÙŠØ© 'error' Ø¹Ù„Ù‰ ÙƒØ§Ø¦Ù† 'response'
                    if (response.error) {
                        tableBody.innerHTML = `<tr><td colspan="12" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${response.error}</td></tr>`;
                        showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨: ${response.error}`, 'error');
                        console.error("Error loading all students data (backend error):", response.error);
                        return;
                    }

                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ ÙˆÙ„Ù… ØªÙƒÙ† null/undefinedØŒ ÙÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ØµÙÙˆÙØ© Ø§Ù„Ø·Ù„Ø§Ø¨.
                    allStudentsRawData = response; // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù… (Ù…ØµÙÙˆÙØ© Ø§Ù„Ø·Ù„Ø§Ø¨)

                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…ØµÙÙˆÙØ© ÙØ§Ø±ØºØ©ØŒ Ø§Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª.
                    if (allStudentsRawData.length === 0) {
                        tableBody.innerHTML = `<tr><td colspan="12" class="no-data-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨ Ù„Ø¹Ø±Ø¶Ù‡Ø§.</td></tr>`;
                        showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨ Ù„Ø¹Ø±Ø¶Ù‡Ø§.', 'info');
                        return;
                    }

                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ù‚Ù… Ø¨Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„ÙØ±Ø².
                    filterAndSortStudents(); // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                    showToast(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allStudentsRawData.length} Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­.`, 'success'); // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¨Ø§Ù„Ø¹Ø¯Ø¯

                })
                .withFailureHandler(error => {
                    refreshButton.disabled = false;
                    tableBody.innerHTML = `<tr><td colspan="12" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</td></tr>`;
                    showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨: ${error.message}`, 'error');
                    console.error("Error loading all students data (frontend failure):", error);
                })
                .getAllStudentsData(); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
        }



        /**
         * ØªØµÙÙŠØ© ÙˆÙØ±Ø² ÙˆØ¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„.
         * @param {string} [column=null] - Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø§Ù„ÙØ±Ø² Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³Ù‡.
         */
        function filterAndSortStudents(column = null) {
            let filteredData = [...allStudentsRawData]; // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡Ø§

            // 1. ØªØµÙÙŠØ© (Filtering)
            const searchTerm = document.getElementById('allStudentsSearch').value.toLowerCase();
            const filterTeacher = document.getElementById('filterTeacher').value;
            const filterPackage = document.getElementById('filterPackage').value;
            const filterPaymentStatus = document.getElementById('filterPaymentStatus').value; // Ù…Ù† Ø´ÙŠØª Ø§Ù„Ø·Ù„Ø§Ø¨
            const filterRenewalStatus = document.getElementById('filterRenewalStatus').value; // Ù…Ù† Ø´ÙŠØª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª

            filteredData = filteredData.filter(student => {
                const matchesSearch = (student.name.toLowerCase().includes(searchTerm) ||
                    student.studentID.toLowerCase().includes(searchTerm) ||
                    (student.phone ? student.phone.toString().includes(searchTerm) : false) ||
                    (student.studentPhone ? student.studentPhone.toString().includes(searchTerm) : false)
                );
                const matchesTeacher = filterTeacher === '' || student.teacherName === filterTeacher; // Ø§Ø³ØªØ®Ø¯Ø§Ù… teacherName
                const matchesPackage = filterPackage === '' || student.packageName === filterPackage; // Ø§Ø³ØªØ®Ø¯Ø§Ù… packageName
                // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ (Ù…Ù† Ø´ÙŠØª Ø§Ù„Ø·Ù„Ø§Ø¨) Ø£Ùˆ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ (Ù…Ù† Ø´ÙŠØª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª)
                const matchesPaymentStatus = filterPaymentStatus === '' || student.basicStatus === filterPaymentStatus;
                const matchesRenewalStatus = filterRenewalStatus === '' || student.renewalStatus === filterRenewalStatus;


                return matchesSearch && matchesTeacher && matchesPackage && matchesPaymentStatus && matchesRenewalStatus;
            });

            // 2. ÙØ±Ø² (Sorting)
            if (column) {
                if (sortColumn === column) {
                    sortDirection = (sortDirection === 'asc') ? 'desc' : 'asc';
                } else {
                    sortColumn = column;
                    sortDirection = 'asc';
                }
            }

            if (sortColumn) {
                filteredData.sort((a, b) => {
                    let valA = a[sortColumn];
                    let valB = b[sortColumn];

                    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ null / undefined
                    if (valA === null || valA === undefined) valA = '';
                    if (valB === null || valB === undefined) valB = '';

                    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù„Ù„ÙØ±Ø² Ø§Ù„ØµØ­ÙŠØ­
                    if (sortColumn === 'age' || sortColumn === 'attendedSessions' || sortColumn === 'remainingSessions') {
                        valA = parseFloat(valA) || 0;
                        valB = parseFloat(valB) || 0;
                    } else if (sortColumn === 'registrationDate' || sortColumn === 'subscriptionStartDate' || sortColumn === 'subscriptionEndDate' || sortColumn === 'lastRenewalDate') { // ÙØ±Ø² Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
                        valA = valA ? new Date(valA) : new Date(0); // ØªØ§Ø±ÙŠØ® Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ùˆ ÙØ§Ø±Øº
                        valB = valB ? new Date(valB) : new Date(0);
                    } else if (sortColumn === 'phone' || sortColumn === 'studentPhone' || sortColumn === 'studentID') {
                        valA = String(valA);
                        valB = String(valB);
                    } else { // ÙØ±Ø² Ù†ØµÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠ
                        valA = String(valA).toLowerCase();
                        valB = String(valB).toLowerCase();
                    }

                    if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
                    if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            displayAllStudentsData(filteredData);
        }

        /**
     * Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ù…ÙØ±Ø²Ø© ÙÙŠ Ø¬Ø¯ÙˆÙ„ ØµÙØ­Ø© "ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨".
     * @param {Array<Object>} students - Ù…ØµÙÙˆÙØ© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¹Ø±Ø¶Ù‡Ø§.
     */
        function displayAllStudentsData(students) {
            const tableBody = document.querySelector('#allStudentsTable tbody');
            tableBody.innerHTML = '';

            // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¢Ù† 11 (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 12)ØŒ Ù„Ø£Ù†Ù‡ ØªÙ… Ø¯Ù…Ø¬ Ø¹Ù…ÙˆØ¯ÙŠÙ† Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙÙŠ ÙˆØ§Ø­Ø¯.
            // 1 (Ø§Ù„Ø§Ø³Ù…) + 1 (ID) + 1 (Ù‡Ø§ØªÙ) + 1 (Ù…Ø¹Ù„Ù…) + 1 (Ø¨Ø§Ù‚Ø©) + 1 (Ø­Ø§Ø¶Ø±Ø©) + 1 (Ù…ØªØ¨Ù‚ÙŠØ©) + 1 (ØªØ¬Ø¯ÙŠØ¯) + 1 (ØªØ§Ø±ÙŠØ® ØªØ³Ø¬ÙŠÙ„) + 1 (Ù†ÙˆØ¹ Ø§Ø´ØªØ±Ø§Ùƒ) + 1 (Ù…ÙˆØ§Ø¹ÙŠØ¯) + 1 (Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª) = 12
            // Ù„Ø°Ø§ØŒ Ø§Ù„Ù€ colspan Ù„Ø§ ÙŠØ²Ø§Ù„ 12 (Ø£Ùˆ 13 Ø¥Ø°Ø§ Ø£Ø¶ÙØª Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ)
            const currentColumnCount = document.querySelector('#allStudentsTable thead tr').children.length; // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
            if (students.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="${currentColumnCount}" class="no-data-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«/Ø§Ù„ØªØµÙÙŠØ©.</td></tr>`;
                return;
            }

            students.forEach(student => {
                const row = document.createElement('tr');

                // ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
                let allSlotsDisplay = '';
                if (student.allBookedScheduleSlots && student.allBookedScheduleSlots.length > 0) {
                    allSlotsDisplay = student.allBookedScheduleSlots.map(slot =>
                        `${slot.day} (${formatTime12Hour(slot.time)})`
                    ).join('<br>'); // Ù„Ø¹Ø±Ø¶ ÙƒÙ„ Ù…ÙŠØ¹Ø§Ø¯ ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„ÙŠØ©
                } else {
                    allSlotsDisplay = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯';
                }


                row.innerHTML = `
        <td>${student.name || ''}</td>
        <td>${student.studentID || ''}</td>
        <td>${student.phone || ''}</td>
        <td>${student.teacherName || ''}</td>
        <td>${student.packageName || ''}</td>
        <td>${student.attendedSessions || 0}</td>
        <td>${student.remainingSessions !== undefined ? student.remainingSessions : 'N/A'}</td>
        <td>${student.renewalStatus || ''}</td>
        <td>${student.registrationDate || ''}</td>
        <td>${student.subscriptionType || ''}</td> <td>${allSlotsDisplay}</td> <td>
            <button class="table-action-button" onclick="editStudentFromAllStudents('${student.studentID}')">
                <i class="fas fa-edit"></i>
            </button>
            <button class="table-action-button delete" onclick="deleteStudentFromAllStudents('${student.studentID}', '${student.name}', ${student.rowIndex})">
                <i class="fas fa-trash-alt"></i>
            </button>
        </td>
    `;
                tableBody.appendChild(row);
            });
        }


        /**
         * Ù„Ù„ØªØ­Ø±ÙŠØ± Ù…Ù† ØµÙØ­Ø© "ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨" (Ø³ØªÙˆØ¬Ù‡ Ù„ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„).
         * @param {string} studentID - Student ID Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ¹Ø¯ÙŠÙ„Ù‡.
         */
        function editStudentFromAllStudents(studentID) {
            // Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… Student ID ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨
            // Ø³Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© fetchStudentData ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            // Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ØªØ¨Ø­Ø« Ø¨Ù€ Student ID.
            // Ù…Ø¤Ù‚ØªØ§Ù‹ØŒ Ø³Ù†Ø±Ø³Ù„ Student ID ÙˆØ³Ù†Ø¹Ø¯Ù„ ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹.
            showPage('edit-student-page', () => {
                // ÙŠÙ…ÙƒÙ† Ù‡Ù†Ø§ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù€ ID
                // Ø£Ùˆ ÙŠÙ…ÙƒÙ† ØªÙ‡ÙŠØ¦Ø© Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù€ ID Ù‡Ø°Ø§
                // Ø«Ù… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø«.
                document.getElementById('searchStudentId').value = studentID; // ID Ø¬Ø¯ÙŠØ¯ Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
                fetchStudentData(studentID); // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù€ ID
            });
            showToast('Ø¬Ø§Ø±Ù Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„...', 'info');
        }

        /**
         * Ù„Ø­Ø°Ù Ø·Ø§Ù„Ø¨ Ù…Ù† ØµÙØ­Ø© "ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨".
         * @param {string} studentID - Student ID Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡.
         * @param {string} studentName - Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨.
         * @param {number} rowIndex - Ø±Ù‚Ù… Ø§Ù„ØµÙ ÙÙŠ Ø´ÙŠØª "Ø§Ù„Ø·Ù„Ø§Ø¨".
         */
        function deleteStudentFromAllStudents(studentID, studentName, rowIndex) {
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ ${studentName} (ID: ${studentID})ØŸ Ø³ÙŠØªÙ… Ù†Ù‚Ù„Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø´ÙŠÙ.`)) {
                google.script.run
                    .withSuccessHandler(response => {
                        if (response.success) {
                            showToast(response.success, 'success');
                            loadAllStudentsData(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
                        } else {
                            showToast(response.error, 'error');
                        }
                    })
                    .withFailureHandler(error => {
                        showToast(`Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨: ${error.message}`, 'error');
                        console.error("Error deleting student from all students page:", error);
                    })
                    .deleteStudentAndArchive({ studentID: studentID, rowIndex: rowIndex }); // Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ù„Ø­Ø°Ù
            }
        }



        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ edit-student-page //
        // ************************************ //
        /**
         * ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù†Ø¯ Ø¹Ø±Ø¶Ù‡Ø§.
         */
        function loadEditStudentDependencies() {
            document.getElementById('studentForm').classList.add('hidden');
            document.getElementById('searchStudentId').value = '';

            loadSubscriptionPackagesOptions('editSubscriptionPackage');
            loadPaymentStatusOptions('editPaymentStatus');
            loadSubscriptionTypesOptions('editSubscriptionType');



            // Ù†Ø¨Ø¯Ø£ Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†ØŒ ÙˆÙ†Ù…Ø±Ø± callback
            loadTeachersOptions('editTeacher', () => {
                if (studentData && studentData.studentID) {
                    // âœ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ fillStudentForm Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ teacherData
                    fillStudentForm(studentData);
                }
            });
            updateRegDays(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±
        }



        // ... (Ø¯Ø§Ø®Ù„ Ù‚Ø³Ù… <script>ØŒ Ø¶Ù…Ù† Ø¯ÙˆØ§Ù„ edit-student-page) ...

        /**
     * Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Student ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.
     * Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù‡ÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø¨Ø­Ø« ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.
     * @param {string} [prefilledSearchInput] - Ù‚ÙŠÙ…Ø© Ø¨Ø­Ø« Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© Ù…Ø³Ø¨Ù‚Ø© (Ù…Ø«Ù„Ø§Ù‹ Student ID Ù…Ù† ØµÙØ­Ø© Ø£Ø®Ø±Ù‰).
     */
        function fetchStudentData(prefilledSearchInput = null) {
            let searchInput;
            if (prefilledSearchInput) {
                searchInput = prefilledSearchInput;
                document.getElementById('searchStudentId').value = prefilledSearchInput;
            } else {
                searchInput = document.getElementById('searchStudentId').value.trim();
            }

            if (!searchInput) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Student ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„Ø¨Ø­Ø«.", 'info');
                return;
            }

            const searchButton = document.getElementById('searchButton');
            const originalSearchText = searchButton.innerHTML;
            searchButton.disabled = true;
            searchButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¨Ø­Ø«';

            document.getElementById('studentForm').classList.add('hidden');
            const existingOptionsContainer = document.getElementById('studentOptionsContainer');
            if (existingOptionsContainer) {
                existingOptionsContainer.remove();
            }

            const handler = google.script.run
                .withSuccessHandler(studentOrStudents => { // <--- Ù‡Ù†Ø§ ÙŠØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØºÙŠØ±
                    searchButton.disabled = false;
                    searchButton.innerHTML = originalSearchText;

                    if (!studentOrStudents || (Array.isArray(studentOrStudents) && studentOrStudents.length === 0)) {
                        showToast("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø·Ø§Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù/Ø§Ù„Ø±Ù‚Ù….", 'info');
                        return;
                    }

                    // **Ù‡Ù†Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ø³Ù…:**
                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¯Ø§Ù„Ø© ØªØ±Ø¬Ø¹ Ù…ØµÙÙˆÙØ© (Ø¹Ø¯Ø© Ø·Ù„Ø§Ø¨ Ø¨Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù…)ØŒ Ù†Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù….
                    // ÙˆØ¥Ø°Ø§ ÙƒØ§Ù†Øª ØªØ±Ø¬Ø¹ ÙƒØ§Ø¦Ù† Ø·Ø§Ù„Ø¨ ÙˆØ§Ø­Ø¯ØŒ Ù†Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¨Ø§Ø´Ø±Ø©.
                    if (Array.isArray(studentOrStudents)) {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† Ø·Ø§Ù„Ø¨ Ø¨Ù†ÙØ³ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙØŒ Ù†Ø¹Ø±Ø¶Ù‡Ù… Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±
                        if (studentOrStudents.length > 1) {
                            showToast("ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¯Ø© Ø·Ù„Ø§Ø¨ Ø¨Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.", 'info');
                            showStudentOptionsForEdit(studentOrStudents); // Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø³ØªØ¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
                        } else {
                            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·Ø§Ù„Ø¨Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ØŒ Ø£Ùˆ ØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹
                            fillStudentForm(studentOrStudents[0]); // Ù†Ù…Ø±Ø± Ø§Ù„ÙƒØ§Ø¦Ù† Ø§Ù„Ø£ÙˆÙ„ Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
                        }
                    } else {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† response Ù‡Ùˆ ÙƒØ§Ø¦Ù† Ø·Ø§Ù„Ø¨ ÙˆØ§Ø­Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø© (Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø­Ø« Ø¨Ù€ Student ID)
                        fillStudentForm(studentOrStudents);
                    }
                })
                .withFailureHandler(error => {
                    searchButton.disabled = false;
                    searchButton.innerHTML = originalSearchText;
                    showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«: " + error.message, 'error');
                    console.error("Error fetching student data for edit:", error);
                });

            // ØªØ­Ø¯ÙŠØ¯ Ø¯Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø­Ø«
            if (searchInput.startsWith('STD')) {
                handler.getStudentDataByID(searchInput);
            } else {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙØŒ ÙŠØ¬Ø¨ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ù‚Ù… (Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙØ± Ø§Ù„Ø£ÙˆÙ„)
                if (searchInput.startsWith("0")) {
                    searchInput = searchInput.slice(1);
                }
                handler.getStudentsByPhone(searchInput);
            }
        }




        /**
         * ØªÙØ¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¥Ø°Ø§ Ø¹Ø«Ø± Ø¹Ù„Ù‰ Ø¹Ø¯Ø© Ø·Ù„Ø§Ø¨ Ø¨Ù†ÙØ³ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„).
         * @param {Array<Object>} students - Ù…ØµÙÙˆÙØ© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ†.
         */
        function showStudentOptionsForEdit(students) {
            // Ø¥Ù†Ø´Ø§Ø¡ container Ø¬Ø¯ÙŠØ¯ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            const container = document.createElement('div');
            container.id = 'studentOptionsContainer';
            container.innerHTML = `
            <h3>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡:</h3>
            <ul id="studentOptionsList"></ul>
        `;
            document.body.appendChild(container); // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù€ container Ø¥Ù„Ù‰ Ø§Ù„Ù€ body

            const optionsList = document.getElementById('studentOptionsList');
            students.forEach((student) => {
                const listItem = document.createElement('li');
                const button = document.createElement('button');
                button.className = 'button button-primary';
                button.style.marginBottom = '10px';
                button.textContent = `${student.name} (ID: ${student.studentID || 'ØºÙŠØ± Ù…ØªØ§Ø­'}) - Ù‡Ø§ØªÙ: ${student.phone}`;
                button.onclick = () => {
                    document.body.removeChild(container); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù€ container Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
                    fillStudentForm(student);
                };
                listItem.appendChild(button);
                optionsList.appendChild(listItem);
            });
        }

        /**
        * Ù…Ù„Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªÙŠ ØªÙ… Ø¬Ù„Ø¨Ù‡Ø§.
        * @param {Object} student - ÙƒØ§Ø¦Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø­Ù…Ù„.
        */
        function fillStudentForm(student) {
            studentData = student;
            document.getElementById('studentForm').classList.remove('hidden');

            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ù…Ø¹Ù„Ù… ÙˆØ§Ù„Ø¨Ø§Ù‚Ø©)
            document.getElementById('editStudentId').value = student.studentID || '';
            document.getElementById('editName').value = student.name || '';
            document.getElementById('editAge').value = student.age || '';
            document.getElementById('editPhone').value = student.phone || '';

            // Ù„Ø§ ØªØ¹ÙŠÙ‘Ù† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¹Ù„Ù… Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ â€“ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡ÙŠØ®ØªØ§Ø±Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§
            // document.getElementById('editTeacher').value = student.teacherName || '';

            // ØªØ¹ÙŠÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ù‡Ø°Ù‡ Ù„Ø§ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯)
            document.getElementById('editPaymentStatus').value = student.renewalStatus || '';
            document.getElementById('editSubscriptionPackage').value = student.packageName || '';
            document.getElementById('editSubscriptionType').value = student.subscriptionType || '';

            // Ù…Ø³Ø­ Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            const container = document.getElementById('dynamicEditSlotsContainer');
            if (container) container.innerHTML = '';

            // Ø¹Ø±Ø¶ Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:
            const note = document.createElement('p');
            note.className = 'info-message';
            note.textContent = 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… ÙˆØ§Ù„Ø¨Ø§Ù‚Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯';
            container.appendChild(note);
        }



        /**
         * ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£ÙŠØ§Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØ§Ø± ÙÙŠ edit-page.
         */
        function updateEditDays() {
            const teacher = document.getElementById('editTeacher').value;
            console.log("Selected teacher for updating days:", teacher);
            const daySelects = document.querySelectorAll('#dynamicEditSlotsContainer select[id^="slotDay"]');
            const timeSelects = document.querySelectorAll('#dynamicEditSlotsContainer select[id^="slotTime"]');

            daySelects.forEach(select => select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± ÙŠÙˆÙ…Ù‹Ø§</option>');
            timeSelects.forEach(select => select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§</option>');

            console.log("All Teachers:", teacherData);
            if (!teacher || !teacherData[teacher]) {
                return;
            }

            const daysForTeacher = Object.keys(teacherData[teacher]).sort();

            daySelects.forEach(daySelect => {
                daysForTeacher.forEach(day => {
                    const option = document.createElement('option');
                    option.value = day;
                    option.textContent = day;
                    daySelect.appendChild(option);
                });
            });
        }



        /**
         * ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØ§Ø± ÙÙŠ edit-page.
         * @param {string} dayId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ù„ÙŠÙˆÙ….
         * @param {string} timeId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ù„Ù…ÙŠØ¹Ø§Ø¯.
         */
        function updateEditTimes(dayId, timeId) {
            const teacher = document.getElementById('editTeacher').value;
            const day = document.getElementById(dayId).value;
            const timeSelect = document.getElementById(timeId);

            timeSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§</option>';
            if (timeId === 'editTime2') {
                timeSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>';
            }

            if (!teacher || !day || !teacherData[teacher][day]) {
                return;
            }

            const availableTimes = teacherData[teacher][day].sort((a, b) => getTimeInMinutes(a) - getTimeInMinutes(b));

            availableTimes.forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = formatTime12Hour(time);
                timeSelect.appendChild(option);
            });
        }

        /**
         * Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù„Ù„Ø·Ø§Ù„Ø¨.
         */
        function updateStudentData() {
            const studentId = document.getElementById('editStudentId').value.trim();
            const name = document.getElementById('editName').value.trim();
            const age = document.getElementById('editAge').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const teacherName = document.getElementById('editTeacher').value.trim();
            const paymentStatus = document.getElementById('editPaymentStatus').value.trim();
            const subscriptionPackage = document.getElementById('editSubscriptionPackage').value.trim();
            const subscriptionType = document.getElementById('editSubscriptionType').value.trim();

            // Ø¬Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
            const editedSlots = [];
            const dynamicSlotFields = document.querySelectorAll('#dynamicEditSlotsContainer .dynamic-slot-row');
            dynamicSlotFields.forEach((fieldset, index) => {
                const daySelect = fieldset.querySelector(`#slotDay${index}`);
                const timeSelect = fieldset.querySelector(`#slotTime${index}`);
                const day = daySelect ? daySelect.value : '';
                const time = timeSelect ? timeSelect.value : '';

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ù…ØªÙ„Ø¦Ø©
                // Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø·Ù‚ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¨Ø¹Ø¶ Ø§Ù„Ø­ØµØµ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©
                if (index === 0 && (!day || !time)) { // Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ø·Ù„ÙˆØ¨Ø©
                    showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.", 'error');
                    return; // Ù„Ø§ ØªÙƒÙ…Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                }
                if ((day && !time) || (!day && time)) { // Ù„Ùˆ ÙÙŠÙ‡ ÙŠÙˆÙ… Ù„ÙƒÙ† Ù…ÙÙŠØ´ Ù…ÙŠØ¹Ø§Ø¯ Ø£Ùˆ Ø§Ù„Ø¹ÙƒØ³
                    showToast(`Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ù„Ù„Ø­ØµØ© ${index + 1}ØŒ Ø£Ùˆ Ø¥Ø²Ø§Ù„ØªÙ‡Ø§.`, 'error');
                    return; // Ù„Ø§ ØªÙƒÙ…Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                }
                if (day && time) {
                    editedSlots.push({ day: day, time: time });
                }
            });

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ø¨Ø§Ù‚Ø©
            if (editedSlots.length !== selectedPackageWeeklySessions) {
                showToast(`Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ ${selectedPackageWeeklySessions} Ø­ØµØ© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ù„Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©. Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ­Ø¯ÙŠØ¯ ${editedSlots.length} Ø­ØµØ©.`, 'error');
                return;
            }


            if (!studentId || !name || !age || !phone || !teacherName || !paymentStatus || !subscriptionPackage || !subscriptionType) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø¹Ø¯Ø§ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø«Ø§Ù†ÙŠØ©).", 'error');
                return;
            }

            const updatedData = {
                studentID: studentId,
                rowIndex: studentData.rowIndex,

                editName: name,
                editAge: age,
                editPhone: phone,
                editTeacher: teacherName,
                editedSlots: editedSlots, // <-- Ø¥Ø±Ø³Ø§Ù„ Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
                editPaymentStatus: paymentStatus,
                editSubscriptionPackage: subscriptionPackage,
                editSubscriptionType: subscriptionType,

                // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„ØºØ±Ø¶ ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙŠ Apps Script
                oldTeacherName: studentData.teacherName, // Ù‡Ø°Ø§ Ù„Ù… ÙŠØ¹Ø¯ Ø¶Ø±ÙˆØ±ÙŠØ§Ù‹ Ø­Ù‚Ø§Ù‹ØŒ Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ getBookedSlotsByStudentId
            };

            const saveButton = document.querySelector('#edit-student-page .button.primary');
            const originalSaveText = saveButton.innerHTML;
            saveButton.disabled = true;
            saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸...';

            google.script.run
                .withSuccessHandler(response => {
                    saveButton.disabled = false;
                    saveButton.innerHTML = originalSaveText;
                    if (response.success) {
                        showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        loadEditStudentDependencies(); // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                        showPage('main-page'); // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    } else if (response.error) {
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª: ' + response.error, 'error');
                    }
                })
                .withFailureHandler(error => {
                    saveButton.disabled = false;
                    saveButton.innerHTML = originalSaveText;
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ' + error.message, 'error');
                    console.error("Error updating student data:", error);
                })
                .updateStudentDataWithReassignment(updatedData);
        }


        /**
 * Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆÙ†Ù‚Ù„Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø´ÙŠÙ.
 */
        function deleteStudent() {
            const studentId = document.getElementById('editStudentId').value.trim();
            const studentName = document.getElementById('editName').value.trim();

            if (!studentId || !studentName) {
                showToast("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø·Ø§Ù„Ø¨ Ø¨Ø¯ÙˆÙ† Student ID Ø£Ùˆ Ø§Ø³Ù….", 'error');
                return;
            }

            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ ${studentName} (ID: ${studentId})ØŸ Ø³ÙŠØªÙ… Ù†Ù‚Ù„Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø´ÙŠÙ.`)) {
                const studentToDelete = {
                    studentID: studentId,
                    rowIndex: studentData.rowIndex,
                    name: studentName
                };

                const deleteButton = document.querySelector('#edit-student-page .action-buttons-container .delete');
                const originalDeleteText = deleteButton?.innerHTML || 'Ø­Ø°Ù';

                if (deleteButton) {
                    deleteButton.disabled = true;
                    deleteButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù Ø§Ù„Ø­Ø°Ù...';
                }

                google.script.run
                    .withSuccessHandler(response => {
                        if (deleteButton) {
                            deleteButton.disabled = false;
                            deleteButton.innerHTML = originalDeleteText;
                        }

                        if (response.success) {
                            showToast(response.success, 'success');
                            loadEditStudentDependencies();
                            showPage('main-page');
                        } else {
                            showToast(response.error, 'error');
                        }
                    })
                    .withFailureHandler(error => {
                        if (deleteButton) {
                            deleteButton.disabled = false;
                            deleteButton.innerHTML = originalDeleteText;
                        }
                        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨: ' + error.message, 'error');
                        console.error("Error deleting student:", error);
                    })
                    .deleteStudentAndArchive(studentToDelete);
            }
        }




        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ dashboard-page //
        // ************************************ //
        // ÙŠØ¬Ø¨ ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Google Charts Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(function () { }); // Ù„Ø§ Ù†ÙØ¹Ù„ Ø´ÙŠØ¦Ù‹Ø§ Ù‡Ù†Ø§ØŒ loadDashboardStats Ø³ØªÙÙ†ÙØ° Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ØµÙØ­Ø©

        function loadDashboardStats() {
            const loadingText = "Ø¬Ø§Ø±Ù...";
            document.getElementById('totalStudentsCount').textContent = loadingText;
            document.getElementById('registeredStudentsCount').textContent = loadingText;
            document.getElementById('trialStudentsCount').textContent = loadingText;
            document.getElementById('pendingStudentsCount').textContent = loadingText; // Ø¬Ø¯ÙŠØ¯
            document.getElementById('renewalNextWeekCount').textContent = loadingText;
            document.getElementById('needsRenewalCount').textContent = loadingText;
            document.getElementById('expiredCount').textContent = loadingText;
            document.getElementById('overLimitCount').textContent = loadingText;
            document.getElementById('renewedCount').textContent = loadingText;
            document.getElementById('activeTrialCount').textContent = loadingText; // Ø¬Ø¯ÙŠØ¯
            document.getElementById('notSubscribedCount').textContent = loadingText; // Ø¬Ø¯ÙŠØ¯
            document.getElementById('studentsByPackageList').innerHTML = '<li>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</li>';
            document.getElementById('studentsByTeacherList').innerHTML = '<li>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</li>';
            document.getElementById('last7DaysCount').textContent = loadingText;
            document.getElementById('last30DaysCount').textContent = loadingText;

            // Ù…Ø³Ø­ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            document.getElementById('packagePieChart').innerHTML = '<p style="text-align: center; color: #555; padding-top: 150px;">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ...</p>';
            document.getElementById('teachersBarChart').innerHTML = '<p style="text-align: center; color: #555; padding-top: 150px;">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ...</p>';
            document.getElementById('renewalStatusPieChart').innerHTML = '<p style="text-align: center; color: #555; padding-top: 150px;">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ...</p>';

            document.getElementById('renewalNextWeekList').innerHTML = '<li>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</li>';


            const refreshButton = document.querySelector('#dashboard-page .refresh-button');
            if (refreshButton) refreshButton.disabled = true;

            google.script.run
                .withSuccessHandler(stats => {
                    if (refreshButton) refreshButton.disabled = false;
                    if (stats.error) {
                        document.getElementById('dashboard-content').innerHTML = `<p style="color: red; text-align: center;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${stats.error}</p>`;
                        showToast(`Ø®Ø·Ø£: ${stats.error}`, 'error');
                        return;
                    }

                    document.getElementById('totalStudentsCount').textContent = stats.totalStudents;
                    document.getElementById('registeredStudentsCount').textContent = stats.registeredStudents;
                    document.getElementById('trialStudentsCount').textContent = stats.trialStudents;
                    document.getElementById('pendingStudentsCount').textContent = stats.pendingStudents; // Ø¬Ø¯ÙŠØ¯
                    document.getElementById('renewalNextWeekCount').textContent = stats.renewalNextWeek;

                    document.getElementById('needsRenewalCount').textContent = stats.renewalStatus.needsRenewal;
                    document.getElementById('expiredCount').textContent = stats.renewalStatus.expired;
                    document.getElementById('overLimitCount').textContent = stats.renewalStatus.overLimit;
                    document.getElementById('renewedCount').textContent = stats.renewalStatus.renewed;
                    document.getElementById('activeTrialCount').textContent = stats.renewalStatus.trial; // Ø¬Ø¯ÙŠØ¯
                    document.getElementById('notSubscribedCount').textContent = stats.renewalStatus.notSubscribed; // Ø¬Ø¯ÙŠØ¯

                    const studentsByPackageList = document.getElementById('studentsByPackageList');
                    studentsByPackageList.innerHTML = '';
                    if (Object.keys(stats.studentsByPackage).length === 0) {
                        studentsByPackageList.innerHTML = '<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¨Ø§Ù‚Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</li>';
                    } else {
                        for (const pkg in stats.studentsByPackage) {
                            const listItem = document.createElement('li');
                            listItem.innerHTML = `${pkg}: <span>${stats.studentsByPackage[pkg]}</span>`;
                            studentsByPackageList.appendChild(listItem);
                        }
                    }

                    const studentsByTeacherList = document.getElementById('studentsByTeacherList');
                    studentsByTeacherList.innerHTML = '';
                    if (Object.keys(stats.studentsByTeacher).length === 0) {
                        studentsByTeacherList.innerHTML = '<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.</li>';
                    } else {
                        const sortedTeachers = Object.keys(stats.studentsByTeacher).sort((a, b) => {
                            return stats.studentsByTeacher[b] - stats.studentsByTeacher[a];
                        });
                        sortedTeachers.forEach(teacher => {
                            const listItem = document.createElement('li');
                            listItem.innerHTML = `${teacher}: <span>${stats.studentsByTeacher[teacher]}</span>`;
                            studentsByTeacherList.appendChild(listItem);
                        });
                    }

                    document.getElementById('last7DaysCount').textContent = stats.recentlyRegistered.last7Days;
                    document.getElementById('last30DaysCount').textContent = stats.recentlyRegistered.last30Days;

                    // Ø±Ø³Ù… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
                    drawPackagePieChart(stats.studentsByPackage);
                    drawTeachersBarChart(stats.studentsByTeacher);
                    drawRenewalStatusPieChart(stats.renewalStatus);

                    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹
                    const renewalNextWeekList = document.getElementById('renewalNextWeekList');
                    renewalNextWeekList.innerHTML = '';
                    if (stats.renewalNextWeekStudents && stats.renewalNextWeekStudents.length > 0) {
                        document.getElementById('renewalDetailsTitle').textContent = `Ø§Ù„Ø·Ù„Ø§Ø¨ (${stats.renewalNextWeekStudents.length}):`;
                        stats.renewalNextWeekStudents.forEach(student => {
                            const listItem = document.createElement('li');
                            listItem.innerHTML = `<strong>${student.name}</strong> - Ù‡Ø§ØªÙ: ${student.phone}`;
                            renewalNextWeekList.appendChild(listItem);
                        });
                    } else {
                        document.getElementById('renewalDetailsTitle').textContent = `Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹.`;
                        renewalNextWeekList.innerHTML = '<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</li>';
                    }

                })
                .withFailureHandler(error => {
                    if (refreshButton) refreshButton.disabled = false;
                    const contentDiv = document.getElementById('dashboard-content');
                    if (contentDiv) contentDiv.innerHTML = `<p style="color: red; text-align: center;">Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${error.message}</p>`;
                    console.error("Error fetching dashboard stats:", error);
                    showToast(`Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${error.message}`, 'error');
                })
                .getDashboardStats(); // Ø¯Ø§Ù„Ø© ÙÙŠ Code.gs
        }

        /**
         * Ø¯Ø§Ù„Ø© Ù„Ø±Ø³Ù… Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª.
         * @param {Object} packageData - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø§Øª.
         */
        function drawPackagePieChart(packageData) {
            const dataArray = [['Ø§Ù„Ø¨Ø§Ù‚Ø©', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨']];
            for (const pkg in packageData) {
                dataArray.push([pkg, packageData[pkg]]);
            }

            if (dataArray.length === 1) {
                const packageChartDiv = document.getElementById('packagePieChart');
                if (packageChartDiv) packageChartDiv.innerHTML = '<p style="text-align: center; color: #555; padding-top: 150px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø¨Ø§Ù‚Ø§Øª.</p>';
                return;
            }

            const data = google.visualization.arrayToDataTable(dataArray);
            const options = {
                title: 'ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ', is3D: true, fontName: 'Cairo',
                titleTextStyle: { fontSize: 18, color: '#34495e' },
                legend: { textStyle: { fontName: 'Cairo', fontSize: 12 } },
                pieSliceTextStyle: { fontName: 'Cairo', fontSize: 14 },
                backgroundColor: { fill: '#f7f9fc' },
                colors: ['#3498db', '#2ecc71', '#f1c40f', '#e74c3c', '#9b59b6', '#1abc9c', '#f39c12'],
            };

            const chart = new google.visualization.PieChart(document.getElementById('packagePieChart'));
            chart.draw(data, options);
        }

        /**
         * Ø¯Ø§Ù„Ø© Ù„Ø±Ø³Ù… Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø´Ø±ÙŠØ·ÙŠ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.
         * @param {Object} teacherData - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆØ¹Ø¯Ø¯ Ø·Ù„Ø§Ø¨Ù‡Ù….
         */
        function drawTeachersBarChart(teacherData) {
            const dataArray = [['Ø§Ù„Ù…Ø¹Ù„Ù…', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨']];
            const sortedTeachers = Object.keys(teacherData).sort((a, b) => teacherData[b] - teacherData[a]);
            sortedTeachers.forEach(teacher => {
                dataArray.push([teacher, teacherData[teacher]]);
            });

            if (dataArray.length === 1) {
                document.getElementById('teachersBarChart').innerHTML = '<p style="text-align: center; color: #555; padding-top: 150px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.</p>';
                return;
            }

            const data = google.visualization.arrayToDataTable(dataArray);
            const options = {
                title: 'ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†',
                chartArea: { width: '60%', height: '70%' },
                hAxis: { title: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨', minValue: 0, textStyle: { fontName: 'Cairo' } },
                vAxis: { title: 'Ø§Ù„Ù…Ø¹Ù„Ù…', textStyle: { fontName: 'Cairo' } },
                legend: { position: 'none' },
                backgroundColor: { fill: '#f7f9fc' },
                fontName: 'Cairo',
                titleTextStyle: { fontSize: 18, color: '#34495e' },
                colors: ['#8e44ad']
            };

            const chart = new google.visualization.BarChart(document.getElementById('teachersBarChart'));
            chart.draw(data, options);
        }

        /**
         * Ø¯Ø§Ù„Ø© Ù„Ø±Ø³Ù… Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ Ù„Ø­Ø§Ù„Ø© ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª.
         * @param {Object} renewalStatusData - Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯.
         */
        function drawRenewalStatusPieChart(renewalStatusData) {
            const dataArray = [
                ['Ø§Ù„Ø­Ø§Ù„Ø©', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨'],
                ['ØªÙ… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ (Ù†Ø´Ø·)', renewalStatusData.renewed || 0],
                ['ÙŠØ­ØªØ§Ø¬ Ù„Ù„ØªØ¬Ø¯ÙŠØ¯', renewalStatusData.needsRenewal || 0],
                ['Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ', renewalStatusData.expired || 0],
                ['ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯', renewalStatusData.overLimit || 0],
                ['Ø­Ù„Ù‚Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù†Ø´Ø·Ø©', renewalStatusData.trial || 0], // Ø¬Ø¯ÙŠØ¯
                ['Ù„Ù… ÙŠØ´ØªØ±ÙƒÙˆØ§', renewalStatusData.notSubscribed || 0] // Ø¬Ø¯ÙŠØ¯
            ];

            const total = dataArray.slice(1).reduce((sum, row) => sum + row[1], 0);
            if (total === 0) {
                document.getElementById('renewalStatusPieChart').innerHTML = '<p style="text-align: center; color: #555; padding-top: 150px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯.</p>';
                return;
            }

            const data = google.visualization.arrayToDataTable(dataArray);
            const options = {
                title: 'Ø­Ø§Ù„Ø© ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª',
                is3D: true,
                fontName: 'Cairo',
                titleTextStyle: { fontSize: 18, color: '#34495e' },
                legend: { textStyle: { fontName: 'Cairo', fontSize: 12 } },
                pieSliceTextStyle: { fontName: 'Cairo', fontSize: 14 },
                backgroundColor: { fill: '#f7f9fc' },
                colors: ['#2ecc71', '#f1c40f', '#e74c3c', '#9b59b6', '#3498db', '#bdc3c7'] // Ø£Ù„ÙˆØ§Ù† Ù…ØªÙ†Ø§Ø³Ù‚Ø©ØŒ Ø£Ø¶Ù Ù„ÙˆÙ†ÙŠÙ† Ø¬Ø¯Ø¯
            };

            const chart = new google.visualization.PieChart(document.getElementById('renewalStatusPieChart'));
            chart.draw(data, options);
        }



        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ teacher-schedule-page //
        // ************************************ //
        let currentTeacherIdForAttendance = ''; // Teacher ID Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ø°ÙŠ ØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ù‡
        let currentTeacherNameForAttendance = ''; // Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ø°ÙŠ ØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ù‡
        let currentDayForAttendance = ''; // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)

        function loadTeacherScheduleDependencies() {
            document.getElementById('teacherPhone').value = '';
            document.getElementById('teacherInfo').classList.add('hidden');
            document.getElementById('attendanceSection').classList.add('hidden');
            document.getElementById('teacherStatusMessage').classList.add('hidden');
            document.querySelector("#attendanceTable tbody").innerHTML = '';

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
            const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            const d = new Date();
            currentDayForAttendance = days[d.getDay()];
            document.getElementById('currentDayNameDisplay').textContent = currentDayForAttendance;
        }


        /**
         * ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­Ø¶Ø±ÙˆØ§ Ù„Ù„Ù…Ø¹Ù„Ù… ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ.
         */
        function loadAttendanceStudentsForDisplay() {
            if (!currentTeacherIdForAttendance || !currentDayForAttendance) {
                showToast('Ø§Ù„Ù…Ø¹Ù„Ù… Ø£Ùˆ Ø§Ù„ÙŠÙˆÙ… ØºÙŠØ± Ù…Ø­Ø¯Ø¯.', 'error');
                return;
            }

            document.getElementById('teacherStatusMessage').textContent = 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø§Ø¨ Ø§Ù„Ø­Ø¶ÙˆØ±...';
            document.getElementById('teacherStatusMessage').classList.remove('hidden');

            google.script.run
                .withSuccessHandler(students => {
                    document.getElementById('teacherStatusMessage').classList.add('hidden');
                    const tableBody = document.querySelector("#attendanceTable tbody");
                    tableBody.innerHTML = '';

                    if (students.error) { // Ù„Ùˆ ÙÙŠÙ‡ Ø®Ø·Ø£ Ù…Ù† Apps Script
                        showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨: ${students.error}`, 'error');
                        tableBody.innerHTML = `<tr><td colspan="4" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${students.error}</td></tr>`;
                        document.getElementById('attendanceSection').classList.add('hidden');
                        return;
                    }

                    if (!students || students.length === 0) {
                        document.getElementById('teacherStatusMessage').textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….';
                        document.getElementById('teacherStatusMessage').classList.remove('hidden');
                        document.getElementById('attendanceSection').classList.add('hidden');
                        return;
                    }

                    document.getElementById('attendanceSection').classList.remove('hidden');
                    students.forEach(student => {
                        const row = document.createElement('tr');
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ø³Ù†ØºÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ø²Ø±
                        const buttonClass = student.isMarked ? 'already-marked' : 'attendance-button';
                        const buttonText = student.isMarked ? '<i class="fas fa-check-double"></i> ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„' : '<i class="fas fa-check"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±';
                        const buttonDisabled = student.isMarked ? 'disabled' : '';

                        row.innerHTML = `
              <td>${student.name || ''}</td>
              <td>${student.studentID || ''}</td>
              <td>${formatTime12Hour(student.timeSlot || '')}</td> <td><button class="button ${buttonClass}" data-student-id="${student.studentID}" data-time-slot="${student.timeSlot}" ${buttonDisabled} onclick="markAttendance(this)">${buttonText}</button></td>
            `;
                        tableBody.appendChild(row);
                    });
                })
                .withFailureHandler(error => {
                    document.getElementById('teacherStatusMessage').textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±: ' + error.message;
                    document.getElementById('teacherStatusMessage').classList.remove('hidden');
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±: ' + error.message, 'error');
                    console.error("Error loading attendance students:", error);
                    document.getElementById('attendanceSection').classList.add('hidden');
                })
                .getAttendanceStudentsForTeacherAndDay(currentTeacherIdForAttendance, currentDayForAttendance); // Ø¯Ø§Ù„Ø© ÙÙŠ Code.gs
        }

        /**
         * ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø·Ø§Ù„Ø¨ Ù…Ø¹ÙŠÙ†.
         * @param {HTMLButtonElement} buttonElement - Ø²Ø± "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±" Ø§Ù„Ø°ÙŠ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡.
         */
        function markAttendance(buttonElement) {
            const studentID = buttonElement.getAttribute('data-student-id');
            const timeSlot = buttonElement.getAttribute('data-time-slot'); // Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ø¨Ø±Ø£Ø³ Ø§Ù„Ø¹Ù…ÙˆØ¯ (HH:mm - HH:mm)

            buttonElement.disabled = true;
            buttonElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            buttonElement.classList.add('already-marked');

            google.script.run
                .withSuccessHandler(response => {
                    if (response.error) {
                        showToast(response.error, 'error');
                        // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ Ø£Ø¹Ø¯ Ø§Ù„Ø²Ø± Ù„ÙˆØ¶Ø¹Ù‡ Ø§Ù„Ø£ØµÙ„ÙŠ
                        buttonElement.disabled = false;
                        buttonElement.innerHTML = '<i class="fas fa-check"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±';
                        buttonElement.classList.remove('already-marked');
                    } else {
                        showToast(`${response.success}`, 'success'); // Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨
                        buttonElement.innerHTML = '<i class="fas fa-check-double"></i> ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„';
                        // Ù„Ø§ Ù†Ù„ØºÙŠ disabled Ù„Ø²Ø± "ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„" Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
                        // ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø®Ø±Ù‰
                        loadAttendanceStudentsForDisplay();
                    }
                })
                .withFailureHandler(error => {
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±: ' + error.message, 'error');
                    buttonElement.disabled = false;
                    buttonElement.innerHTML = '<i class="fas fa-check"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±';
                    buttonElement.classList.remove('already-marked');
                    console.error("Error marking attendance:", error);
                })
                .markAttendance(currentTeacherIdForAttendance, studentID, currentDayForAttendance, timeSlot); // Ø¯Ø§Ù„Ø© ÙÙŠ Code.gs
        }


        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ manage-slots-page //
        // ************************************ //



        function loadManageSlotsDependencies() {
            document.getElementById('selectManageTeacher').innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ù‹Ø§</option>';
            document.getElementById('manageSlotsTeacherInfo').classList.add('hidden');
            document.getElementById('manageSlotsStatusMessage').classList.add('hidden');
            document.getElementById('teacherSlotsTableBody').innerHTML = '';

            // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
            google.script.run
                .withSuccessHandler(teachers => {
                    const selectElement = document.getElementById('selectManageTeacher');
                    if (teachers.error) {
                        showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†: ${teachers.error}`, 'error');
                        return;
                    }
                    teachers.forEach(teacherName => { // getAllTeachersList ØªØ±Ø¬Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ù…Ø¨Ø§Ø´Ø±Ø©
                        const option = document.createElement('option');
                        option.value = teacherName; // Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ÙˆØ¨Ø´Ù† Ù‡ØªÙƒÙˆÙ† Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…
                        option.textContent = teacherName;
                        selectElement.appendChild(option);
                    });
                })
                .withFailureHandler(error => {
                    showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†: ' + error.message, 'error');
                    console.error("Error loading teachers for manage slots:", error);
                })
                .getAllTeachersList(); // Ø¯Ø§Ù„Ø© ÙÙŠ Code.gs ØªØ±Ø¬Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙÙ‚Ø·
        }

        function loadTeacherSlotsForManagement() {
            const selectElement = document.getElementById('selectManageTeacher');
            const teacherName = selectElement.value; // Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©

            if (!teacherName) {
                document.getElementById('manageSlotsTeacherInfo').classList.add('hidden');
                document.getElementById('manageSlotsStatusMessage').classList.add('hidden');
                document.getElementById('teacherSlotsTableBody').innerHTML = '';
                return;
            }

            const statusMessageDiv = document.getElementById('manageSlotsStatusMessage');
            statusMessageDiv.textContent = 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¹Ù„Ù…...';
            statusMessageDiv.classList.remove('hidden');

            document.getElementById('manageSlotsTeacherInfo').classList.add('hidden');
            document.getElementById('teacherSlotsTableBody').innerHTML = '';
            document.getElementById('noManageSlotsMessage').classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©

            google.script.run
                .withSuccessHandler(response => {
                    statusMessageDiv.classList.add('hidden');

                    if (response.error) {
                        showToast(response.error, 'error');
                        statusMessageDiv.textContent = response.error;
                        statusMessageDiv.classList.remove('hidden');
                        return;
                    }

                    if (response.teacherName) {
                        currentManageSlotsTeacherName = response.teacherName;
                        currentManageSlotsTeacherId = response.teacherId;
                        currentTeacherAllAvailableSlots = response.slots; // ØªØ®Ø²ÙŠÙ† ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙÙŠ Ù…ØªØºÙŠØ± Ø¹Ø§Ù„Ù…ÙŠ

                        document.getElementById('manageSlotsTeacherName').textContent = `Ø§Ù„Ù…Ø¹Ù„Ù…: ${currentManageSlotsTeacherName}`;
                        document.getElementById('manageSlotsTeacherInfo').classList.remove('hidden');

                        // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø¬Ù„Ø¨Ù‡Ø§
                        const slotsByDay = {
                            'Ø§Ù„Ø£Ø­Ø¯': [], 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': [], 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': [], 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': [],
                            'Ø§Ù„Ø®Ù…ÙŠØ³': [], 'Ø§Ù„Ø¬Ù…Ø¹Ø©': [], 'Ø§Ù„Ø³Ø¨Øª': []
                        };
                        response.slots.forEach(slot => {
                            if (slotsByDay[slot.dayOfWeek]) {
                                slotsByDay[slot.dayOfWeek].push(slot);
                            }
                        });

                        const tableBody = document.getElementById('teacherSlotsTableBody');
                        tableBody.innerHTML = '';

                        let hasAnyActualSlots = false; // Ù„ØªØªØ¨Ø¹ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙŠ Ù…ÙˆØ§Ø¹ÙŠØ¯ (Ø­ØªÙ‰ Ù„Ùˆ ØºÙŠØ± Ù…ØªØ§Ø­Ø©)
                        const daysOrder = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];

                        daysOrder.forEach(day => {
                            const row = document.createElement('tr');
                            const dayCell = document.createElement('td');
                            dayCell.textContent = day;
                            row.appendChild(dayCell);

                            const slotsCell = document.createElement('td');
                            // ÙØ±Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ù…Ø±ØªØ¨
                            const sortedDaySlots = slotsByDay[day].sort((a, b) => getTimeInMinutes(a.timeSlotHeader) - getTimeInMinutes(b.timeSlotHeader));

                            const availableSlots = sortedDaySlots.filter(s => !s.isBooked && s.actualSlotValue === s.timeSlotHeader); // Ù…ØªØ§Ø­ Ù„Ùˆ ÙÙŠÙ‡ Ø±Ø£Ø³ Ø§Ù„Ø¹Ù…ÙˆØ¯
                            const bookedSlots = sortedDaySlots.filter(s => s.isBooked); // Ù…Ø­Ø¬ÙˆØ²Ø© Ù„Ùˆ ÙÙŠÙ‡Ø§ Ù‚ÙŠÙ…Ø©
                            const notAvailableSlots = sortedDaySlots.filter(s => !s.isBooked && s.actualSlotValue === ''); // ØºÙŠØ± Ù…ØªØ§Ø­ Ù„Ùˆ ÙØ§Ø±ØºØ©

                            let slotsText = '';
                            if (availableSlots.length > 0) {
                                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ØªØ§Ø­Ø©ØŒ Ø§Ø¹Ø±Ø¶Ù‡Ø§ ÙÙ‚Ø·
                                slotsText = `Ù…ØªØ§Ø­Ø©: ${availableSlots.map(s => formatTime12Hour(s.timeSlotHeader)).join(', ')}`;
                            }

                            // Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙŠÙˆÙ… ÙÙŠÙ‡ Ø£ÙŠ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ (Ù…ØªØ§Ø­Ø©ØŒ Ù…Ø­Ø¬ÙˆØ²Ø©ØŒ ØºÙŠØ± Ù…ØªØ§Ø­Ø©)
                            // Ù‡Ø°Ø§ Ù„Ø§ ÙŠØ²Ø§Ù„ Ù…Ù‡Ù…Ù‹Ø§ Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø±Ø³Ø§Ù„Ø© "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø¶Ø§ÙØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ù„Ù… Ø­Ø§Ù„ÙŠØ§Ù‹."
                            if (sortedDaySlots.length > 0) {
                                hasAnyActualSlots = true;
                            }

                            // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
                            if (!slotsText) {
                                if (sortedDaySlots.length === 0) { // Ù„Ùˆ Ø§Ù„ÙŠÙˆÙ… Ù…ÙÙŠØ´ ÙÙŠÙ‡ Ø£ÙŠ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø¶Ø§ÙØ© Ø£ØµÙ„Ø§Ù‹ (ÙÙŠ Ø§Ù„Ø´ÙŠØª)
                                    slotsText = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø¶Ø§ÙØ© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….';
                                } else { // Ù„Ùˆ Ø§Ù„ÙŠÙˆÙ… ÙÙŠÙ‡ Ù…ÙˆØ§Ø¹ÙŠØ¯ (Ù…Ø­Ø¬ÙˆØ²Ø© Ø£Ùˆ ØºÙŠØ± Ù…ØªØ§Ø­Ø©) Ù„ÙƒÙ† Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´ÙŠØ¡ Ù…ØªØ§Ø­
                                    slotsText = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.';
                                }
                            }

                            slotsCell.textContent = slotsText;
                            row.appendChild(slotsCell);

                            const actionCell = document.createElement('td');
                            const editButton = document.createElement('button');
                            editButton.className = 'button edit-slots-button';
                            editButton.innerHTML = `<i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„`;
                            editButton.onclick = () => openTimeSlotModal(day);
                            actionCell.appendChild(editButton);
                            row.appendChild(actionCell);

                            tableBody.appendChild(row);
                        });

                        if (!hasAnyActualSlots) { // Ù„Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ (Ù…ØªØ§Ø­Ø©ØŒ Ù…Ø­Ø¬ÙˆØ²Ø©ØŒ ØºÙŠØ± Ù…ØªØ§Ø­Ø©)
                            document.getElementById('noManageSlotsMessage').classList.remove('hidden');
                        } else {
                            document.getElementById('noManageSlotsMessage').classList.add('hidden');
                        }

                        if (response.message) {
                            statusMessageDiv.textContent = response.message;
                            statusMessageDiv.classList.remove('hidden');
                        } else {
                            statusMessageDiv.classList.add('hidden');
                        }

                    } else {
                        showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ù„Ù… Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù….', 'info');
                        statusMessageDiv.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ù„Ù… Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù….';
                        statusMessageDiv.classList.remove('hidden');
                    }
                })
                .withFailureHandler(error => {
                    statusMessageDiv.classList.add('hidden');
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¹Ù„Ù…: ' + error.message, 'error');
                    statusMessageDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¹Ù„Ù…: ' + error.message;
                    statusMessageDiv.classList.remove('hidden');
                    console.error("Error fetching teacher slots for management:", error);
                })
                .getTeacherAvailableSlots(teacherName); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
        function openTimeSlotModal(day) {
            modalSelectedDay = day;
            document.getElementById('modalDayTitle').textContent = `ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙŠÙˆÙ… ${day}`;
            const morningGrid = document.getElementById('morningSlotsGrid');
            const eveningGrid = document.getElementById('eveningSlotsGrid');
            morningGrid.innerHTML = '';
            eveningGrid.innerHTML = '';

            // Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ø§Ù„Ù…Ø®Ø²Ù†
            const existingSlotsForSelectedDay = currentTeacherAllAvailableSlots.filter(s => s.dayOfWeek === day);

            // Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªÙŠ Ø³ØªØ¹Ø±Ø¶ Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± (ÙƒÙ„ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©)
            const sortedDisplayHeaders = [...possibleTimeSlots24Hour];
            sortedDisplayHeaders.sort((a, b) => getTimeInMinutes(a) - getTimeInMinutes(b));

            // ØªÙ‡ÙŠØ¦Ø© modalSelectedSlots Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªÙŠ Ù‡ÙŠ Ø¨Ø§Ù„ÙØ¹Ù„ "Ù…ØªØ§Ø­Ø©" (Ø£ÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø§Ù„Ø¹Ù…ÙˆØ¯)
            // Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ØŒ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù‡ÙŠ ØªÙ„Ùƒ Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª "Ù…ØªØ§Ø­Ø©" ÙÙŠ Ø§Ù„Ø´ÙŠØª
            modalSelectedSlots = existingSlotsForSelectedDay.filter(s => !s.isBooked && s.actualSlotValue === s.timeSlotHeader).map(slot => ({ ...slot, timeSlotHeader: slot.timeSlotHeader }));


            if (sortedDisplayHeaders.length === 0) {
                morningGrid.innerHTML = '<p class="no-slots-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….</p>';
                eveningGrid.innerHTML = '';
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø­ØªÙ‰ Ù„Ùˆ ÙØ§Ø±Øº Ù„Ø¥ØªØ§Ø­Ø© Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ø¹ÙŠØ¯
                document.getElementById('timeSlotSelectionModal').classList.remove('hidden');
                return;
            }

            let hasMorningSlots = false;
            let hasEveningSlots = false;

            sortedDisplayHeaders.forEach(timeSlotHeader => { // Ù‡Ù†Ø§ Ù†Ù…Ø± Ø¹Ù„Ù‰ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
                // Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… (Ø¹Ø´Ø§Ù† Ù†Ø¹Ø±Ù Ù„Ùˆ Ù…Ø­Ø¬ÙˆØ² Ø£Ùˆ Ù…ØªØ§Ø­)
                const originalSlotData = existingSlotsForSelectedDay.find(s => s.timeSlotHeader === timeSlotHeader);

                // Ù‡Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ ØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ Ù„ÙŠÙƒÙˆÙ† Ù…ØªØ§Ø­Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (ÙƒØ§Ù† Ø¨Ø§Ù„ÙØ¹Ù„ Ù…ØªØ§Ø­Ø§Ù‹ Ø£Ùˆ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡ Ø§Ù„Ø¢Ù†)ØŸ
                const isSelected = modalSelectedSlots.some(s => s.timeSlotHeader === timeSlotHeader);

                // Ù‡Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ù…Ø­Ø¬ÙˆØ² Ù…Ù† Ù‚Ø¨Ù„ Ø·Ø§Ù„Ø¨ (Ø£Ùˆ Ù†Øµ Ù…Ø®ØµØµ)ØŸ
                const isDisabled = originalSlotData && originalSlotData.isBooked;

                const button = document.createElement('button');
                button.className = `time-slot-chip ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}`;
                button.type = 'button';
                button.onclick = () => toggleSlotSelection(timeSlotHeader);
                button.disabled = isDisabled;
                button.setAttribute('data-time-slot-header', timeSlotHeader);

                let buttonText = formatTime12Hour(timeSlotHeader); // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ø¨ØªÙ†Ø³ÙŠÙ‚ 12 Ø³Ø§Ø¹Ø©
                // Ù„Ø§ Ù†Ø¶ÙŠÙ Ù†Øµ "ØºÙŠØ± Ù…ØªØ§Ø­" Ù‡Ù†Ø§ØŒ Ø§Ù„Ù„ÙˆÙ† Ø³ÙŠØ¹Ø¨Ø± Ø¹Ù† Ø§Ù„Ø­Ø§Ù„Ø©

                if (originalSlotData && originalSlotData.isBooked) {
                    // Ù„Ùˆ Ù…Ø­Ø¬ÙˆØ² Ø¨Ù€ ID Ø·Ø§Ù„Ø¨
                    if (originalSlotData.bookedBy && originalSlotData.bookedBy._id && (originalSlotData.bookedBy._id.startsWith("STD") || originalSlotData.bookedBy._id.startsWith("TRL"))) { // Ø£Ø¶Ù TRL
                        buttonText += ` (${originalSlotData.bookedBy.name || originalSlotData.bookedBy._id})`;
                    }
                    // Ù„Ùˆ Ù…Ø­Ø¬ÙˆØ² Ø¨Ù†Øµ Ù…Ø®ØµØµ
                    else if (originalSlotData.bookedBy && originalSlotData.bookedBy.name) {
                        buttonText += ` (${originalSlotData.bookedBy.name})`;
                    }
                    else { // Ù„Ùˆ Ù…Ø´ Ø¹Ø§Ø±ÙÙŠÙ† Ù…ÙŠÙ† Ø­Ø¬Ø²
                        buttonText += ` (Ù…Ø­Ø¬ÙˆØ²)`;
                    }
                }
                // Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù€ else if (!isSelected) Ù‡Ù†Ø§ Ù„Ø£Ù† Ø§Ù„Ù„ÙˆÙ† Ù‡Ùˆ Ù…Ù† Ø³ÙŠØ¹Ø¨Ø± Ø¹Ù† "ØºÙŠØ± Ù…ØªØ§Ø­"

                button.textContent = buttonText;

                const startMinutes = getTimeInMinutes(timeSlotHeader);

                // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¥Ù„Ù‰ ØµØ¨Ø§Ø­ÙŠØ© ÙˆÙ…Ø³Ø§Ø¦ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ù†ØªØµÙ Ø§Ù„ÙŠÙˆÙ… (3:00 Ù…Ø³Ø§Ø¡Ù‹)
                if (startMinutes >= getTimeInMinutes("09:00 - 00:00") && startMinutes < getTimeInMinutes("15:00 - 00:00")) {
                    morningGrid.appendChild(button);
                    hasMorningSlots = true;
                } else if (startMinutes >= getTimeInMinutes("15:00 - 00:00") && startMinutes <= getTimeInMinutes("23:30 - 00:00")) {
                    eveningGrid.appendChild(button);
                    hasEveningSlots = true;
                }
            });

            if (!hasMorningSlots && morningGrid.innerHTML === '') {
                morningGrid.innerHTML = '<p class="no-slots-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ ØµØ¨Ø§Ø­ÙŠØ© Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ù…ÙƒÙ†Ø©.</p>';
            }
            if (!hasEveningSlots && eveningGrid.innerHTML === '') {
                eveningGrid.innerHTML = '<p class="no-slots-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø³Ø§Ø¦ÙŠØ© Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ù…ÙƒÙ†Ø©.</p>';
            }

            document.getElementById('timeSlotSelectionModal').classList.remove('hidden');
        }



        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ¯/Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
        function updateModalButtons() {
            const allButtons = document.querySelectorAll('#morningSlotsGrid .time-slot-chip, #eveningSlotsGrid .time-slot-chip');
            allButtons.forEach(button => {
                if (button.disabled) return; // Ù„Ø§ Ù†ØºÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¹Ø·Ù„Ø© (Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©)

                const timeSlotHeader = button.getAttribute('data-time-slot-header');
                const isSelected = modalSelectedSlots.some(s => s.timeSlotHeader === timeSlotHeader);

                // ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¥Ø²Ø§Ù„Ø© ÙØ¦Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†
                button.classList.toggle('selected', isSelected);
                button.classList.toggle('disabled', false); // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© disabled Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø­Ø¬ÙˆØ²Ù‹Ø§

                let buttonText = formatTime12Hour(timeSlotHeader);
                const originalSlotData = currentTeacherAllAvailableSlots.find(s => s.dayOfWeek === modalSelectedDay && s.timeSlotHeader === timeSlotHeader);

                if (originalSlotData && originalSlotData.isBooked) {
                    // Ù„Ùˆ Ù…Ø­Ø¬ÙˆØ²ØŒ Ø£Ø¶Ù Ù†Øµ Ø§Ù„Ø­Ø¬Ø²
                    if (originalSlotData.bookedBy && originalSlotData.bookedBy._id && (originalSlotData.bookedBy._id.startsWith("STD") || originalSlotData.bookedBy._id.startsWith("TRL"))) { // Ø£Ø¶Ù TRL
                        buttonText += ` (${originalSlotData.bookedBy.name || originalSlotData.bookedBy._id})`;
                    } else if (originalSlotData.bookedBy && originalSlotData.bookedData.name) { // Ù„Ø§Ø­Ø¸ ØªØºÙŠÙŠØ± bookingData.name Ø¥Ù„Ù‰ bookedBy.name
                        buttonText += ` (${originalSlotData.bookedBy.name})`;
                    } else {
                        buttonText += ` (Ù…Ø­Ø¬ÙˆØ²)`;
                    }
                    button.classList.add('disabled'); // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙØ¦Ø© disabled Ù„Ù„Ù…Ø­Ø¬ÙˆØ²
                }
                // Ù„Ø§ Ù†Ø¶ÙŠÙ Ù†Øµ "ØºÙŠØ± Ù…ØªØ§Ø­" Ù‡Ù†Ø§
                button.textContent = buttonText;
            });
        }






        // ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© toggleSlotSelection Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        function toggleSlotSelection(timeSlotHeader) {
            const originalSlotData = currentTeacherAllAvailableSlots.find(
                s => s.dayOfWeek === modalSelectedDay && s.timeSlotHeader === timeSlotHeader
            );

            if (originalSlotData && originalSlotData.isBooked) {
                showToast('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø­Ø¬ÙˆØ² Ù…Ù† Ù‚Ø¨Ù„ Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ù†Øµ Ù…Ø®ØµØµ.', 'info');
                return;
            }

            const index = modalSelectedSlots.findIndex(s => s.timeSlotHeader === timeSlotHeader);
            if (index > -1) {
                // Ø§Ù„Ù…ÙˆØ¹Ø¯ ÙƒØ§Ù† Ù…Ø®ØªØ§Ø±Ø§Ù‹ Ù„ÙŠØµØ¨Ø­ Ù…ØªØ§Ø­Ø§Ù‹ØŒ Ø³ÙŠØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯Ù‡ (Ø£ÙŠ ÙŠØµØ¨Ø­ ÙØ§Ø±ØºØ§Ù‹ ÙÙŠ Ø§Ù„Ø´ÙŠØª)
                modalSelectedSlots.splice(index, 1);
            } else {
                // Ø§Ù„Ù…ÙˆØ¹Ø¯ Ù„Ù… ÙŠÙƒÙ† Ù…Ø®ØªØ§Ø±Ø§Ù‹ØŒ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ (Ø£ÙŠ Ù†Ø¶Ø¹ Ø±Ø£Ø³ Ø§Ù„Ø¹Ù…ÙˆØ¯ ÙÙŠ Ø§Ù„Ø®Ù„ÙŠØ©)
                modalSelectedSlots.push({
                    dayOfWeek: modalSelectedDay,
                    timeSlotHeader: timeSlotHeader // Ù†Ø±Ø³Ù„ Ø±Ø£Ø³ Ø§Ù„Ø¹Ù…ÙˆØ¯ ÙÙ‚Ø·
                });
            }
            updateModalButtons(); // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        }

        function saveSelectedSlots() {
            const teacherId = currentManageSlotsTeacherId; // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù€ ID Ø§Ù„Ø°ÙŠ Ø¬Ù„Ø¨Ù†Ø§Ù‡ Ø³Ø§Ø¨Ù‚Ù‹Ø§
            const day = modalSelectedDay;

            // Ø£Ø±Ø³Ù„ ÙÙ‚Ø· Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù„Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªÙŠ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡Ø§ (Ù„ØªØµØ¨Ø­ Ù…ØªØ§Ø­Ø©)
            const newSelectedSlotsToSend = modalSelectedSlots.map(slot => ({
                timeSlotHeader: slot.timeSlotHeader
            }));

            if (!teacherId || !day) {
                showToast('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¹Ù„Ù… Ø£Ùˆ Ø§Ù„ÙŠÙˆÙ….', 'error');
                return;
            }

            const saveButton = document.querySelector('#timeSlotSelectionModal .save-button');
            const originalSaveText = saveButton.innerHTML;
            saveButton.disabled = true;
            saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸...';

            google.script.run
                .withSuccessHandler(response => {
                    saveButton.disabled = false;
                    saveButton.innerHTML = originalSaveText;
                    if (response.success) {
                        showToast(response.success, 'success');
                        closeTimeSlotModal();
                        loadTeacherSlotsForManagement(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                    } else {
                        showToast(response.error, 'error');
                    }
                })
                .withFailureHandler(error => {
                    saveButton.disabled = false;
                    saveButton.innerHTML = originalSaveText;
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯: ' + error.message, 'error');
                    console.error("Error saving selected slots:", error);
                })
                .updateTeacherSlots(teacherId, day, newSelectedSlotsToSend); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        }


        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ archive-page     //
        // ************************************ //

        function loadArchivedStudentsDependencies() {
            document.getElementById('archiveSearch').value = '';
            document.getElementById('filterArchiveTeacher').value = '';
            document.getElementById('filterArchivePackage').value = '';
            document.getElementById('filterArchiveStatus').value = ''; // Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø£Ø±Ø´ÙØ©

            loadTeachersOptions('filterArchiveTeacher'); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù„Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
            loadSubscriptionPackagesOptions('filterArchivePackage'); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù„Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
            loadArchivedStudentStatusOptions('filterArchiveStatus'); // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø£Ø±Ø´ÙØ©

            loadArchivedStudentsData(); // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø±Ø´ÙÙŠÙ†
        }

        /**
         * ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ (Ù„Ù„ÙÙ„ØªØ±Ø© ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ).
         * @param {string} selectId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select>.
         */
        function loadArchivedStudentStatusOptions(selectId) {
            const statusSelect = document.getElementById(selectId);
            statusSelect.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>';
            const statuses = ["Ù…Ø´ØªØ±Ùƒ", "ØªØ¬Ø±ÙŠØ¨ÙŠ", "Ù‚ÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„", "Ù…Ø¹Ù„Ù‚", "Ù…Ù†Ø³Ø­Ø¨"]; // Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø·Ø§Ù„Ø¨
            statuses.forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = status;
                statusSelect.appendChild(option);
            });
        }

        /**
  * Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø±Ø´ÙÙŠÙ† ÙˆØ¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø¬Ø¯ÙˆÙ„ ØµÙØ­Ø© Ø§Ù„Ø£Ø±Ø´ÙŠÙ.
  */
        function loadArchivedStudentsData() {
            const tableBody = document.querySelector('#archivedStudentsTable tbody');
            tableBody.innerHTML = '<tr><td colspan="8" class="no-data-message"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø±Ø´ÙÙŠÙ†...</td></tr>';

            const refreshButton = document.querySelector('#archive-page .refresh-button');
            refreshButton.disabled = true;

            google.script.run
                .withSuccessHandler(data => {
                    refreshButton.disabled = false;

                    console.log("ğŸ“¦ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±:", data);

                    if (!Array.isArray(data)) {
                        tableBody.innerHTML = `<tr><td colspan="8" class="no-data-message" style="color: red;">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶.</td></tr>`;
                        showToast(`Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©.`, 'error');
                        console.error("âŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØµÙÙˆÙØ©:", data);
                        return;
                    }

                    archivedStudentsRawData = data;
                    filterAndSortArchivedStudents();
                })
                .withFailureHandler(error => {
                    refreshButton.disabled = false;
                    tableBody.innerHTML = `<tr><td colspan="8" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</td></tr>`;
                    showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø±Ø´ÙŠÙ: ${error.message}`, 'error');
                    console.error("Error loading archived students data:", error);
                })
                .getArchivedStudentsData();
        }




        /**
 * ØªØµÙÙŠØ© ÙˆÙØ±Ø² ÙˆØ¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø±Ø´ÙÙŠÙ† ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„.
 * @param {string} [column=null] - Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø§Ù„ÙØ±Ø² Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³Ù‡.
 */
        function filterAndSortArchivedStudents(column = null) {
            if (!Array.isArray(archivedStudentsRawData)) {
                showError(archivedStudentsRawData?.error || "ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø±Ø´ÙŠÙ.");
                return;
            }

            let filteredData = [...archivedStudentsRawData];

            const searchTerm = document.getElementById('archiveSearch').value.toLowerCase();
            const filterTeacher = document.getElementById('filterArchiveTeacher').value;
            const filterPackage = document.getElementById('filterArchivePackage').value;
            const filterStatus = document.getElementById('filterArchiveStatus').value;

            filteredData = filteredData.filter(student => {
                const matchesSearch = (student.name.toLowerCase().includes(searchTerm) ||
                    student.studentID.toLowerCase().includes(searchTerm) ||
                    (student.phone ? student.phone.toString().includes(searchTerm) : false) ||
                    (student.studentPhone ? student.studentPhone.toString().includes(searchTerm) : false)
                );
                const matchesTeacher = filterTeacher === '' || student.teacherName === filterTeacher;
                const matchesPackage = filterPackage === '' || student.packageName === filterPackage;
                const matchesStatus = filterStatus === '' || student.basicStatus === filterStatus;

                return matchesSearch && matchesTeacher && matchesPackage && matchesStatus;
            });

            if (column) {
                if (archiveSortColumn === column) {
                    archiveSortDirection = (archiveSortDirection === 'asc') ? 'desc' : 'asc';
                } else {
                    archiveSortColumn = column;
                    archiveSortDirection = 'asc';
                }
            }

            if (archiveSortColumn) {
                filteredData.sort((a, b) => {
                    let valA = a[archiveSortColumn];
                    let valB = b[archiveSortColumn];

                    if (valA === null || valA === undefined) valA = '';
                    if (valB === null || valB === undefined) valB = '';

                    if (archiveSortColumn === 'age') {
                        valA = parseFloat(valA) || 0;
                        valB = parseFloat(valB) || 0;
                    } else if (archiveSortColumn === 'archivedDate' || archiveSortColumn === 'registrationDate') {
                        valA = valA ? new Date(valA) : new Date(0);
                        valB = valB ? new Date(valB) : new Date(0);
                    } else {
                        valA = String(valA).toLowerCase();
                        valB = String(valB).toLowerCase();
                    }

                    if (valA < valB) return archiveSortDirection === 'asc' ? -1 : 1;
                    if (valA > valB) return archiveSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            displayArchivedStudentsData(filteredData);
        }


        /**
 * Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ù…ÙØ±Ø²Ø© ÙÙŠ Ø¬Ø¯ÙˆÙ„ ØµÙØ­Ø© Ø§Ù„Ø£Ø±Ø´ÙŠÙ.
 * @param {Array<Object>} students - Ù…ØµÙÙˆÙØ© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¹Ø±Ø¶Ù‡Ø§.
 */
        function displayArchivedStudentsData(students) {
            const tableBody = document.querySelector('#archivedStudentsTable tbody');
            if (!tableBody) {
                console.error("Ø¹Ù†ØµØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ØµÙØ­Ø©.");
                return;
            }

            tableBody.innerHTML = '';

            if (students.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="no-data-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«/Ø§Ù„ØªØµÙÙŠØ© ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ.</td></tr>';
                return;
            }

            students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${student.name || ''}</td>
            <td>${student.studentID || ''}</td>
            <td>${student.phone || ''}</td>
            <td>${student.teacherName || ''}</td> 
            <td>${student.packageName || ''}</td> 
            <td>${student.subscriptionType || ''}</td>
            <td>${student.archivedDate || ''}</td>
            <td>${student.archiveReason || ''}</td>
            <td class="table-action-buttons">
                <button class="button button-primary" onclick="reactivateArchivedStudent('${student.studentID}', '${student.name}')"><i class="fas fa-undo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„</button>
            </td>
        `;
                tableBody.appendChild(row);
            });
        }

        /**
         * Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ.
         * @param {string} studentID - Student ID Ù„Ù„Ø·Ø§Ù„Ø¨.
         * @param {string} studentName - Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨.
         */
        function reactivateArchivedStudent(studentID, studentName) {
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ ${studentName} (ID: ${studentID})ØŸ`)) {
                google.script.run
                    .withSuccessHandler(response => {
                        if (response.success) {
                            showToast(response.success, 'success');
                            loadArchivedStudentsData(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
                        } else {
                            showToast(response.error, 'error');
                        }
                    })
                    .withFailureHandler(error => {
                        showToast(`Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨: ${error.message}`, 'error');
                        console.error("Error reactivating student:", error);
                    })
                    .reactivateStudentFromArchive(studentID); // Ø¯Ø§Ù„Ø© ÙÙŠ Code.gs
            }
        }


        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ trial-form-page (ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ)      //
        // ************************************ //

        function loadTrialFormDependencies() {
            document.getElementById('trialDataForm').reset(); // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            loadTeachersOptions('trialRegTeacher'); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
            updateTrialRegDays(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø£ÙŠØ§Ù… ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
        }

        /**
         * ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØ§Ø± ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ.
         */
        function updateTrialRegDays() {
            const teacher = document.getElementById('trialRegTeacher').value;
            const day1Select = document.getElementById('trialRegDay1');

            day1Select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± ÙŠÙˆÙ…Ù‹Ø§</option>';

            document.getElementById('trialRegTime1').innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§</option>';

            if (!teacher || !teacherData[teacher]) {
                return;
            }

            const daysForTeacher = Object.keys(teacherData[teacher]).sort();

            daysForTeacher.forEach(day => {
                const option1 = document.createElement('option');
                option1.value = day;
                option1.textContent = day;
                day1Select.appendChild(option1);
            });
        }

        /**
         * ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØ§Ø± ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ.
         * @param {string} dayId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ù„ÙŠÙˆÙ….
         * @param {string} timeId - ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ù†ØµØ± Ø§Ù„Ù€ <select> Ù„Ù„Ù…ÙŠØ¹Ø§Ø¯.
         */
        function updateTrialRegTimes(dayId, timeId) {
            const teacher = document.getElementById('trialRegTeacher').value;
            const day = document.getElementById(dayId).value;
            const timeSelect = document.getElementById(timeId);

            timeSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…ÙŠØ¹Ø§Ø¯Ù‹Ø§</option>';

            if (!teacher || !day || !teacherData[teacher][day]) {
                return;
            }

            const availableTimes = teacherData[teacher][day].sort((a, b) => getTimeInMinutes(a) - getTimeInMinutes(b));

            availableTimes.forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = formatTime12Hour(time); // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ø¨ØªÙ†Ø³ÙŠÙ‚ 12 Ø³Ø§Ø¹Ø©
                timeSelect.appendChild(option);
            });
        }

        /**
     * Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¥Ù„Ù‰ Code.gs Ù„Ø­ÙØ¸Ù‡Ø§.
     */
        function submitTrialData() {
            const name = document.getElementById('trialRegName').value.trim();
            const age = document.getElementById('trialRegAge').value.trim();
            const phone = document.getElementById('trialRegPhone').value.trim();
            const teacher = document.getElementById('trialRegTeacher').value;
            const day1 = document.getElementById('trialRegDay1').value;
            const time1 = document.getElementById('trialRegTime1').value;

            if (!name || !age || !phone || !teacher || !day1 || !time1) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.", 'error');
                return;
            }

            // **Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„:** ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø³ÙŠÙ„ÙƒØªÙˆØ± Ø¯Ù‡ Ù…Ø¸Ø¨ÙˆØ·.
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø²Ø± Ù„ÙŠÙ‡ ID Ù…Ø¨Ø§Ø´Ø±ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡ (Ù…Ø«Ù„Ø§Ù‹ 'submitTrialButton')
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„ÙŠÙ‡ class="button primary" Ø§Ø³ØªØ®Ø¯Ù… '.button.primary'
            const submitButton = document.querySelector('#trial-form-page .button.primary'); // <--- Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø³ÙŠÙ„ÙƒØªÙˆØ± Ø¯Ù‡ ÙÙŠ Ù…Ù„Ù HTML
            if (submitButton) { // <--- Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ù‚Ù‚ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø®Ø·Ø£ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø²Ø± null
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±ØŒ Ù…Ù…ÙƒÙ† ØªØ¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø£Ùˆ ØªØ³Ø¬Ù„Ù‡Ø§ ÙÙŠ Logger
                console.error("Submit button not found for trial form!");
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: Ø²Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.", 'error');
                return; // Ø¥ÙŠÙ‚Ø§Ù ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ùˆ Ø§Ù„Ø²Ø± Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯
            }


            const formData = {
                trialRegName: name,
                trialRegAge: age,
                trialRegPhone: phone,
                trialRegTeacher: teacher,
                trialRegDay1: day1,
                trialRegTime1: time1
            };

            google.script.run
                .withSuccessHandler(response => {
                    if (submitButton) {
                        submitButton.disabled = false;
                        submitButton.innerHTML = '<i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ';
                    }

                    if (response.success) {
                        showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        document.getElementById('trialDataForm').reset();
                        loadTrialFormDependencies(); // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                        showPage('main-page'); // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    } else if (response.error) {
                        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ: ' + response.error, 'error');
                    }
                })
                .withFailureHandler(error => {
                    if (submitButton) {
                        submitButton.disabled = false;
                        submitButton.innerHTML = '<i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ';
                    }
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ' + error.message, 'error');
                    console.error("Error submitting trial data:", error);
                })
                .saveTrialData(formData);
        }

        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ convert-trial-page (ØªØ­ÙˆÙŠÙ„ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ) //
        // ************************************ //
        let currentTrialStudentData = null; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø°ÙŠ ØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ù‡

        window.loadConvertTrialDependencies = function () {
            document.getElementById('searchTrialStudentId').value = '';
            document.getElementById('convertTrialStudentForm').classList.add('hidden');
            document.getElementById('convertTrialStatusMessage').classList.add('hidden');
            loadSubscriptionPackagesOptions('convertPackage');
            loadPaymentStatusOptions('convertPaymentStatus');
            loadSubscriptionTypesOptions('convertSubscriptionType');
        };


        /**
         * Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Trial ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.
         */
        window.fetchTrialStudentForConversion = function () {
            let searchInput = document.getElementById('searchTrialStudentId').value.trim();
            if (!searchInput) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Trial ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„Ø¨Ø­Ø«.", 'info');
                return;
            }

            if (typeof google === 'undefined' || typeof google.script === 'undefined' || typeof google.script.run === 'undefined') {
                showToast("Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: google.script.run ØºÙŠØ± Ù…ØªØ§Ø­.", 'error');
                console.error("Google Apps Script client-side API (google.script.run) is not available.");
                return;
            }

            const searchButton = document.getElementById('searchConvertTrialButton');
            const originalSearchText = searchButton.innerHTML;
            searchButton.disabled = true;
            searchButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¨Ø­Ø«';

            document.getElementById('convertTrialStudentForm').classList.add('hidden');
            document.getElementById('convertTrialStatusMessage').classList.add('hidden');

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù€ handlers
            const scriptRun = google.script.run
                .withSuccessHandler(response => {
                    searchButton.disabled = false;
                    searchButton.innerHTML = originalSearchText;

                    if (response && response.error) {
                        showToast(response.error, 'error');
                        document.getElementById('convertTrialStatusMessage').textContent = response.error;
                        document.getElementById('convertTrialStatusMessage').classList.remove('hidden');
                        return;
                    }

                    if (response && response.found === false) {
                        showToast("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù/Ø§Ù„Ø±Ù‚Ù….", 'info');
                        document.getElementById('convertTrialStatusMessage').textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù/Ø§Ù„Ø±Ù‚Ù….";
                        document.getElementById('convertTrialStatusMessage').classList.remove('hidden');
                        return;
                    }

                    if (Array.isArray(response)) {
                        if (response.length === 0) {
                            showToast("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù/Ø§Ù„Ø±Ù‚Ù….", 'info');
                            document.getElementById('convertTrialStatusMessage').textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù/Ø§Ù„Ø±Ù‚Ù….";
                            document.getElementById('convertTrialStatusMessage').classList.remove('hidden');
                            return;
                        }
                        if (response.length > 1) {
                            showToast("ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¯Ø© Ø·Ù„Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠÙŠÙ† Ø¨Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Trial ID Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ§Ø­Ø¯.", 'info');
                            fillConvertTrialForm(response[0]); // Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡Ø§ Ø¨Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø¦Ù…Ø©
                        } else {
                            fillConvertTrialForm(response[0]);
                        }
                    } else {
                        if (!response) {
                            showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙØ§Ø±ØºØ©.", 'error');
                            return;
                        }
                        fillConvertTrialForm(response);
                    }
                })
                .withFailureHandler(error => {
                    searchButton.disabled = false;
                    searchButton.innerHTML = originalSearchText;
                    showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: " + error.message, 'error');
                    document.getElementById('convertTrialStatusMessage').textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: " + error.message;
                    document.getElementById('convertTrialStatusMessage').classList.remove('hidden');
                    console.error("Error fetching trial student data for conversion:", error);
                });

            // ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
            if (searchInput.startsWith('TRL')) {
                scriptRun.getTrialStudentDataByID(searchInput);
            } else {
                if (searchInput.startsWith("0")) {
                    searchInput = searchInput.slice(1);
                }
                scriptRun.getTrialStudentsByPhone(searchInput);
            }
        };



        /**
         * Ù…Ù„Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø§Ù„ØªÙŠ ØªÙ… Ø¬Ù„Ø¨Ù‡Ø§.
         * @param {Object} student - ÙƒØ§Ø¦Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø§Ù„Ù…Ø­Ù…Ù„.
         */
        function fillConvertTrialForm(student) {
            currentTrialStudentData = student; // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
            document.getElementById('convertTrialStudentForm').classList.remove('hidden');
            document.getElementById('convertTrialStatusMessage').classList.add('hidden');

            document.getElementById('trialStudentNameDisplay').textContent = student.name || '';
            document.getElementById('displayTrialStudentId').textContent = student.trialID || '';
            document.getElementById('displayTrialTeacherName').textContent = student.teacherName || '';
            document.getElementById('displayTrialDayTime').textContent = `${student.day || ''} (${formatTime12Hour(student.time || '')})`;

            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹
            document.getElementById('convertPackage').value = '';
            document.getElementById('convertPaymentStatus').value = '';
        }



        /**
     * Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¥Ù„Ù‰ Ù…Ø´ØªØ±Ùƒ.
     */
        window.initiateConversion = function () {
            const selectedPackageName = document.getElementById('convertPackage').value;
            const paymentStatus = document.getElementById('convertPaymentStatus').value;
            const subscriptionType = document.getElementById('convertSubscriptionType').value;

            // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† currentTrialStudentData Ù…Ù„ÙŠØ¦Ø©
            if (!currentTrialStudentData || !currentTrialStudentData.trialID) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø£ÙˆÙ„Ø§Ù‹.", 'error');
                return;
            }

            if (!selectedPackageName || !paymentStatus || !subscriptionType) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.", 'error');
                return;
            }

            // Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù‡ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
            const oldTrialDay = currentTrialStudentData.day;
            const oldTrialTime = currentTrialStudentData.time;

            const confirmationMessage = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ ${currentTrialStudentData.name} (ID: ${currentTrialStudentData.trialID}) Ø¥Ù„Ù‰ Ù…Ø´ØªØ±Ùƒ Ø¨Ø§Ù„Ø¨Ø§Ù‚Ø©: ${selectedPackageName} ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹: ${paymentStatus} ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ: <span class="math-inline">\{subscriptionType\} Ù…Ø¹ Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ\:\\n</span>{oldTrialDay} (${window.formatTime12Hour(oldTrialTime)})ØŸ`;
            if (!confirm(confirmationMessage)) {
                return;
            }

            const convertButton = document.getElementById('convertStudentButton');
            if (!convertButton) {
                console.error("Conversion button not found!");
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: Ø²Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.", 'error');
                return;
            }
            const originalButtonText = convertButton.innerHTML;
            convertButton.disabled = true;
            convertButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­ÙˆÙŠÙ„...';

            google.script.run
                .withSuccessHandler(response => {
                    if (convertButton) {
                        convertButton.disabled = false;
                        convertButton.innerHTML = originalButtonText;
                    }
                    if (response.success) {
                        showToast(response.success, 'success');
                        loadConvertTrialDependencies();
                        showPage('main-page');
                    } else if (response.error) {
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„: ' + response.error, 'error');
                    }
                })
                .withFailureHandler(error => {
                    if (convertButton) {
                        convertButton.disabled = false;
                        convertButton.innerHTML = originalButtonText;
                    }
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­ÙˆÙŠÙ„: ' + error.message, 'error');
                    console.error("Error converting trial student:", error);
                })
                // Ù†Ù…Ø±Ø± Ø§Ù„Ù…ÙŠØ¹Ø§Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ (day1, time1)
                .convertTrialToRegistered(currentTrialStudentData.trialID, selectedPackageName, paymentStatus, subscriptionType, oldTrialDay, oldTrialTime);
        };

        // ************************************ //
        //          Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ© Ø®Ø§ØµØ© Ø¨Ù€ renewal-attendance-page //
        // ************************************ //
        let renewalAttendanceRawData = []; // ØªØ®Ø²ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©
        let renewalAttendanceSortColumn = null;
        let renewalAttendanceSortDirection = 'asc';

        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ renewal-attendance-page //
        // ************************************ //

        window.loadRenewalAttendanceDependencies = function () { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ window.function
            document.getElementById('renewalAttendanceSearch').value = '';
            document.getElementById('filterRenewalStatusRA').value = '';
            // ØªØ­ØªØ§Ø¬ Ù„ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆØ§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ø´ÙƒÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ù„Ù„ÙÙ„Ø§ØªØ±
            loadTeachersOptions('filterTeacherRA'); // Ø¯Ø§Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
            loadSubscriptionPackagesOptions('filterPackageRA'); // Ø¯Ø§Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
            loadRenewalAttendanceData(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        };

        /**
         * Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ (Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©) Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©.
         */
        window.loadRenewalAttendanceData = function () { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ window.function
            const tableBody = document.querySelector('#renewalAttendanceTable tbody');
            tableBody.innerHTML = '<tr><td colspan="12" class="no-data-message"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©...</td></tr>';

            const refreshButton = document.querySelector('#renewal-attendance-page .refresh-button');
            refreshButton.disabled = true;

            google.script.run
                .withSuccessHandler(response => {
                    refreshButton.disabled = false;
                    if (response && response.error) {
                        tableBody.innerHTML = `<tr><td colspan="12" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${response.error}</td></tr>`;
                        showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©: ${response.error}`, 'error');
                        console.error("Error loading renewal attendance data:", response.error);
                        return;
                    }
                    renewalAttendanceRawData = response; // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…
                    filterAndSortRenewalAttendance(); // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„Ù‡Ø§
                })
                .withFailureHandler(error => {
                    refreshButton.disabled = false;
                    tableBody.innerHTML = `<tr><td colspan="12" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</td></tr>`;
                    showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©: ${error.message}`, 'error');
                    console.error("Error loading renewal attendance data:", error);
                })
                .getAllStudentsForRenewalAttendance(); // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Code.gs
        };

        /**
         * ØªØµÙÙŠØ© ÙˆÙØ±Ø² ÙˆØ¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.
         * @param {string} [column=null] - Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø§Ù„ÙØ±Ø² Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³Ù‡.
         */
        window.filterAndSortRenewalAttendance = function (column = null) { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ window.function
            let filteredData = [...renewalAttendanceRawData];

            // 1. ØªØµÙÙŠØ© (Filtering)
            const searchTerm = document.getElementById('renewalAttendanceSearch').value.toLowerCase();
            const filterRenewalStatus = document.getElementById('filterRenewalStatusRA').value;
            const filterTeacher = document.getElementById('filterTeacherRA').value;
            const filterPackage = document.getElementById('filterPackageRA').value;

            filteredData = filteredData.filter(student => {
                const matchesSearch = (student.name.toLowerCase().includes(searchTerm) ||
                    student.studentID.toLowerCase().includes(searchTerm) ||
                    (student.phone ? student.phone.toString().includes(searchTerm) : false) ||
                    (student.trialID ? student.trialID.toLowerCase().includes(searchTerm) : false)
                );
                const matchesRenewalStatus = filterRenewalStatus === '' || student.renewalStatus === filterRenewalStatus;
                const matchesTeacher = filterTeacher === '' || student.teacherName === filterTeacher;
                const matchesPackage = filterPackage === '' || student.packageName === filterPackage;

                return matchesSearch && matchesRenewalStatus && matchesTeacher && matchesPackage;
            });

            // 2. ÙØ±Ø² (Sorting)
            if (column) {
                if (renewalAttendanceSortColumn === column) {
                    renewalAttendanceSortDirection = (renewalAttendanceSortDirection === 'asc') ? 'desc' : 'asc';
                } else {
                    renewalAttendanceSortColumn = column;
                    renewalAttendanceSortDirection = 'asc';
                }
            }

            if (renewalAttendanceSortColumn) {
                filteredData.sort((a, b) => {
                    let valA = a[renewalAttendanceSortColumn];
                    let valB = b[renewalAttendanceSortColumn];

                    if (valA === null || valA === undefined) valA = '';
                    if (valB === null || valB === undefined) valB = '';

                    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù„Ù„ÙØ±Ø²
                    if (renewalAttendanceSortColumn === 'remainingSessions' || renewalAttendanceSortColumn === 'attendedThisMonth' || renewalAttendanceSortColumn === 'absentThisMonth') {
                        valA = parseFloat(valA) || 0;
                        valB = parseFloat(valB) || 0;
                    } else if (renewalAttendanceSortColumn.includes('Date')) { // Ù„Ù„ØªÙˆØ§Ø±ÙŠØ®
                        valA = valA ? new Date(valA) : new Date(0);
                        valB = valB ? new Date(valB) : new Date(0);
                    } else { // Ø§Ù„ÙØ±Ø² Ø§Ù„Ù†ØµÙŠ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                        valA = String(valA).toLowerCase();
                        valB = String(valB).toLowerCase();
                    }

                    if (valA < valB) return renewalAttendanceSortDirection === 'asc' ? -1 : 1;
                    if (valA > valB) return renewalAttendanceSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            displayRenewalAttendanceData(filteredData);
        };

        /**
         * Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ù…ÙØ±Ø²Ø© ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.
         * @param {Array<Object>} students - Ù…ØµÙÙˆÙØ© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¹Ø±Ø¶Ù‡Ø§.
         */
        window.displayRenewalAttendanceData = function (students) { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ window.function
            const tableBody = document.querySelector('#renewalAttendanceTable tbody');
            tableBody.innerHTML = '';

            if (students.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="12" class="no-data-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«/Ø§Ù„ØªØµÙÙŠØ©.</td></tr>';
                return;
            }

            students.forEach(student => {
                const row = document.createElement('tr');
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù€ ID Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø·Ø§Ù„Ø¨ (Ù…Ø´ØªØ±Ùƒ Ø£Ùˆ ØªØ¬Ø±ÙŠØ¨ÙŠ)
                const displayId = student.studentID || student.trialID || 'N/A';
                const idType = student.studentID ? 'studentID' : 'trialID';

                row.innerHTML = `
                <td>${student.name || ''}</td>
                <td>${displayId}</td>
                <td>${student.phone || ''}</td>
                <td>${student.teacherName || ''}</td>
                <td>${student.packageName || ''}</td>
                <td>${student.renewalStatus || ''}</td>
                <td>${student.remainingSessions !== undefined ? student.remainingSessions : 'N/A'}</td>
                <td>${student.subscriptionEndDate || 'N/A'}</td>
                <td>${student.lastRenewalDate || 'N/A'}</td>
                <td>${student.attendedThisMonth || 0}</td>
                <td>${student.absentThisMonth || 0}</td>
                <td class="table-action-buttons">
                    <button class="button button-primary" onclick="initiateRenewal('${displayId}', '${idType}')"><i class="fas fa-redo-alt"></i> ØªØ¬Ø¯ÙŠØ¯</button>
                    <button class="button delete" onclick="markAbsence('${displayId}', '${idType}', '${student.name}')"><i class="fas fa-user-times"></i> ØºÙŠØ§Ø¨</button>
                </td>
            `;
                tableBody.appendChild(row);
            });
        };

        /**
         * Ø¯Ø§Ù„Ø© Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ (ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø£Ùˆ ØªÙˆØ¬Ù‡ Ù„ØµÙØ­Ø©).
         * @param {string} studentId - Student ID Ø£Ùˆ Trial ID Ù„Ù„Ø·Ø§Ù„Ø¨.
         * @param {string} idType - 'studentID' Ø£Ùˆ 'trialID' Ù„ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø±Ù.
         */
        window.initiateRenewal = function (studentId, idType) { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ window.function
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø¯Ø®Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯
            // Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØµÙØ­Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ù…ÙˆØ¬ÙˆØ¯Ø© Ù‡Ù†Ø§Ùƒ
            if (idType === 'studentID') {
                showToast(`ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø´ØªØ±Ùƒ: ${studentId}`, 'info');
                // ÙŠÙ…ÙƒÙ† ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨:
                showPage('edit-student-page', () => {
                    document.getElementById('searchStudentId').value = studentId;
                    fetchStudentData(); // Ø£Ùˆ Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ØªØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø§Ù„Ù€ ID
                });
            } else {
                showToast(`ØªØ¬Ø¯ÙŠØ¯ (ØªØ­ÙˆÙŠÙ„) Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ: ${studentId}`, 'info');
                // ÙŠÙ…ÙƒÙ† ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
                showPage('convert-trial-page', () => {
                    document.getElementById('searchTrialStudentId').value = studentId;
                    fetchTrialStudentForConversion();
                });
            }
        };

        /**
         * Ø¯Ø§Ù„Ø© Ù„ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ§Ø¨ Ø·Ø§Ù„Ø¨.
         * @param {string} studentId - Student ID Ø£Ùˆ Trial ID Ù„Ù„Ø·Ø§Ù„Ø¨.
         * @param {string} idType - 'studentID' Ø£Ùˆ 'trialID' Ù„ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø±Ù.
         * @param {string} studentName - Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨.
         */
        window.markAbsence = function (studentId, idType, studentName) { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ window.function
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ§Ø¨ Ù„Ù„Ø·Ø§Ù„Ø¨ ${studentName} (${studentId}) Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…ØŸ`)) {
                google.script.run
                    .withSuccessHandler(response => {
                        if (response && response.success) {
                            showToast(response.success, 'success');
                            loadRenewalAttendanceData(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
                        } else if (response && response.error) {
                            showToast(response.error, 'error');
                        }
                    })
                    .withFailureHandler(error => {
                        showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨: ${error.message}`, 'error');
                        console.error("Error marking absence:", error);
                    })
                    .markAbsence(studentId, idType); // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Code.gs
            }
        };

        // ************************************ //
        //          ÙƒÙˆØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©          //
        // ************************************ //
        document.addEventListener('DOMContentLoaded', function () {
            // Ø¬Ù„Ø¨ Ø§Ù„Ù€ Base URL (Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚) Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            google.script.run.withSuccessHandler(function (url) {
                // Ù„Ø§ Ù†Ø­ØªØ§Ø¬ Ù„Ù€ baseUrl ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ø£Ù† Ø§Ù„ØªÙ†Ù‚Ù„ ÙŠØªÙ… Ø¯Ø§Ø®Ù„ Ù†ÙØ³ index.html
                // ÙˆÙ„ÙƒÙ† ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù„Ù„ØªØ£ÙƒØ¯ Ø£Ù† Ø§ØªØµØ§Ù„ Apps Script ÙŠØ¹Ù…Ù„
                console.log('Base URL loaded successfully:', url);
            }).getBaseUrl();

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„ØµÙØ­Ø© Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
            const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            const d = new Date();
            currentDay = days[d.getDay()];

            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
            showPage('main-page');
        });

        // ************************************ //
        //          Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ© Ø®Ø§ØµØ© Ø¨Ù€ renewal-needed-students-page //
        // ************************************ //
        let renewalNeededStudentsRawData = [];
        let renewalNeededStudentsSortColumn = null;
        let renewalNeededStudentsSortDirection = 'asc';

        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ renewal-needed-students-page //
        // ************************************ //

        window.loadRenewalNeededStudentsDependencies = function () {
            document.getElementById('renewalNeededSearch').value = '';
            document.getElementById('filterRenewalNeededStatus').value = '';
            loadTeachersOptions('filterRenewalNeededTeacher'); // Ø¯Ø§Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
            window.loadRenewalNeededStudentsData();
        };

        /**
         * Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯.
         */
        window.loadRenewalNeededStudentsData = function () {
            const tableBody = document.querySelector('#renewalNeededStudentsTable tbody');
            tableBody.innerHTML = '<tr><td colspan="10" class="no-data-message"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨...</td></tr>';

            const refreshButton = document.querySelector('#renewal-needed-students-page .refresh-button');
            refreshButton.disabled = true;

            google.script.run
                .withSuccessHandler(response => {
                    refreshButton.disabled = false;
                    if (response && response.error) {
                        tableBody.innerHTML = `<tr><td colspan="10" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${response.error}</td></tr>`;
                        showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨: ${response.error}`, 'error');
                        console.error("Error loading renewal needed students data:", response.error);
                        return;
                    }
                    renewalNeededStudentsRawData = response;
                    window.filterAndSortRenewalNeededStudents();
                })
                .withFailureHandler(error => {
                    refreshButton.disabled = false;
                    tableBody.innerHTML = `<tr><td colspan="10" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</td></tr>`;
                    showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨: ${error.message}`, 'error');
                    console.error("Error loading renewal needed students data:", error);
                })
                .getStudentsWhoNeedRenewal(); // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Code.gs
        };

        /**
         * ØªØµÙÙŠØ© ÙˆÙØ±Ø² ÙˆØ¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯.
         * @param {string} [column=null] - Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø§Ù„ÙØ±Ø² Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³Ù‡.
         */
        window.filterAndSortRenewalNeededStudents = function (column = null) {
            let filteredData = [...renewalNeededStudentsRawData];

            // 1. ØªØµÙÙŠØ© (Filtering)
            const searchTerm = document.getElementById('renewalNeededSearch').value.toLowerCase();
            const filterStatus = document.getElementById('filterRenewalNeededStatus').value;
            const filterTeacher = document.getElementById('filterRenewalNeededTeacher').value;

            filteredData = filteredData.filter(student => {
                const matchesSearch = (student.name.toLowerCase().includes(searchTerm) ||
                    student.studentID.toLowerCase().includes(searchTerm) ||
                    (student.phone ? student.phone.toString().includes(searchTerm) : false)
                );
                const matchesStatus = filterStatus === '' || student.reasonForRenewal === filterStatus;
                const matchesTeacher = filterTeacher === '' || student.teacherName === filterTeacher;

                return matchesSearch && matchesStatus && matchesTeacher;
            });

            // 2. ÙØ±Ø² (Sorting)
            if (column) {
                if (renewalNeededStudentsSortColumn === column) {
                    renewalNeededStudentsSortDirection = (renewalNeededStudentsSortDirection === 'asc') ? 'desc' : 'asc';
                } else {
                    renewalNeededStudentsSortColumn = column;
                    renewalNeededStudentsSortDirection = 'asc';
                }
            }

            if (renewalNeededStudentsSortColumn) {
                filteredData.sort((a, b) => {
                    let valA = a[renewalNeededStudentsSortColumn];
                    let valB = b[renewalNeededStudentsSortColumn];

                    if (valA === null || valA === undefined) valA = '';
                    if (valB === null || valB === undefined) valB = '';

                    if (renewalNeededStudentsSortColumn === 'remainingSessions') {
                        valA = parseFloat(valA) || 0;
                        valB = parseFloat(valB) || 0;
                    } else if (renewalNeededStudentsSortColumn.includes('Date')) {
                        valA = valA ? new Date(valA) : new Date(0);
                        valB = valB ? new Date(valB) : new Date(0);
                    } else {
                        valA = String(valA).toLowerCase();
                        valB = String(valB).toLowerCase();
                    }

                    if (valA < valB) return renewalNeededStudentsSortDirection === 'asc' ? -1 : 1;
                    if (valA > valB) return renewalNeededStudentsSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            window.displayRenewalNeededStudentsData(filteredData);
        };

        /**
         * Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ù…ÙØ±Ø²Ø© ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯.
         * @param {Array<Object>} students - Ù…ØµÙÙˆÙØ© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¹Ø±Ø¶Ù‡Ø§.
         */
        window.displayRenewalNeededStudentsData = function (students) {
            const tableBody = document.querySelector('#renewalNeededStudentsTable tbody');
            tableBody.innerHTML = '';

            if (students.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="10" class="no-data-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯ Ø­Ø§Ù„ÙŠØ§Ù‹.</td></tr>';
                return;
            }

            students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${student.name || ''}</td>
                <td>${student.studentID || ''}</td>
                <td>${student.phone || ''}</td>
                <td>${student.teacherName || ''}</td>
                <td>${student.packageName || ''}</td>
                <td>${student.renewalStatus || ''}</td>
                <td>${student.reasonForRenewal || ''}</td>
                <td>${student.remainingSessions !== undefined ? student.remainingSessions : 'N/A'}</td>
                <td>${student.lastRenewalDate || ''}</td>
                <td class="table-action-buttons">
                    <button class="button button-primary" onclick="window.initiateRenewalFromNeeded('${student.studentID}')"><i class="fas fa-redo-alt"></i> ØªØ¬Ø¯ÙŠØ¯</button>
                </td>
            `;
                tableBody.appendChild(row);
            });
        };

        /**
         * Ø¯Ø§Ù„Ø© Ù„Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ù…Ù† ØµÙØ­Ø© "Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„ØªØ¬Ø¯ÙŠØ¯".
         * @param {string} studentID - Student ID Ù„Ù„Ø·Ø§Ù„Ø¨.
         */
        window.initiateRenewalFromNeeded = function (studentID) {
            showToast(`Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: ${studentID}`, 'info');
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆÙ…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
            showPage('renewal-subscription-page', () => {
                window.loadRenewalSubscriptionDependencies();
                document.getElementById('searchStudentIdRenewal').value = studentID;
                fetchStudentForRenewal();
            });
        };


        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ payment-records-page //
        // ************************************ //

        window.loadPaymentRecordsDependencies = function () {
            document.getElementById('paymentStudentId').value = '';
            document.getElementById('paymentDate').value = formatDateForInput(new Date()); // ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
            document.getElementById('paymentAmount').value = '';
            document.getElementById('paymentMethod').value = '';
            document.getElementById('paymentNotes').value = '';
            document.getElementById('paymentStatusMessage').classList.add('hidden');
            document.getElementById('paymentRecordStudentId').value = '';
            window.loadPaymentRecords();
        };

        /**
         * ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„ÙŠÙƒÙˆÙ† Ù…ØªÙˆØ§ÙÙ‚Ù‹Ø§ Ù…Ø¹ Ø­Ù‚Ù„ <input type="date">
         * @param {Date} date - ÙƒØ§Ø¦Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®.
         * @returns {string} Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØªÙ†Ø³ÙŠÙ‚ yyyy-MM-dd.
         */
        window.formatDateForInput = function (date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        /**
         * ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø© Ù…Ø§Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©.
         */
        window.submitPaymentRecord = function () {
            const studentId = document.getElementById('paymentStudentId').value.trim();
            const paymentDate = document.getElementById('paymentDate').value;
            const paymentAmount = document.getElementById('paymentAmount').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const paymentNotes = document.getElementById('paymentNotes').value.trim();

            if (!studentId || !paymentDate || !paymentAmount || !paymentMethod) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.", 'error');
                return;
            }

            if (isNaN(paymentAmount) || parseFloat(paymentAmount) <= 0) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº Ø¯ÙØ¹ ØµØ­ÙŠØ­.", 'error');
                return;
            }

            const paymentData = {
                studentID: studentId,
                paymentDate: paymentDate,
                paymentAmount: parseFloat(paymentAmount),
                paymentMethod: paymentMethod,
                paymentNotes: paymentNotes
            };

            const submitButton = document.querySelector('#payment-records-page button[onclick="submitPaymentRecord()"]');
            const originalButtonText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ØªØ³Ø¬ÙŠÙ„...';
            document.getElementById('paymentStatusMessage').classList.add('hidden');

            google.script.run
                .withSuccessHandler(response => {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    if (response && response.success) {
                        showToast(response.success, 'success');
                        document.getElementById('paymentStudentId').value = '';
                        document.getElementById('paymentDate').value = formatDateForInput(new Date());
                        document.getElementById('paymentAmount').value = '';
                        document.getElementById('paymentMethod').value = '';
                        document.getElementById('paymentNotes').value = '';
                        window.loadPaymentRecords(); // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª
                    } else if (response && response.error) {
                        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©: ' + response.error, 'error');
                        document.getElementById('paymentStatusMessage').textContent = response.error;
                        document.getElementById('paymentStatusMessage').classList.remove('hidden');
                    }
                })
                .withFailureHandler(error => {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ' + error.message, 'error');
                    document.getElementById('paymentStatusMessage').textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©.";
                    document.getElementById('paymentStatusMessage').classList.remove('hidden');
                    console.error("Error submitting payment record:", error);
                })
                .recordPayment(paymentData); // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Code.gs
        };

        /**
         * ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯.
         */
        window.loadPaymentRecords = function () {
            const studentId = document.getElementById('paymentRecordStudentId').value.trim();
            const tableBody = document.querySelector('#paymentRecordsTable tbody');
            tableBody.innerHTML = '<tr><td colspan="4" class="no-data-message"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª...</td></tr>';

            if (!studentId) {
                tableBody.innerHTML = '<tr><td colspan="4" class="no-data-message">Ø£Ø¯Ø®Ù„ Student ID Ù„Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª.</td></tr>';
                return;
            }

            google.script.run
                .withSuccessHandler(response => {
                    if (response && response.error) {
                        tableBody.innerHTML = `<tr><td colspan="4" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${response.error}</td></tr>`;
                        showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª: ${response.error}`, 'error');
                        console.error("Error loading payment records:", response.error);
                        return;
                    }
                    window.displayPaymentRecords(response);
                })
                .withFailureHandler(error => {
                    tableBody.innerHTML = `<tr><td colspan="4" class="no-data-message" style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</td></tr>`;
                    showToast(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª: ${error.message}`, 'error');
                    console.error("Error loading payment records:", error);
                })
                .getPaymentRecords(studentId); // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Code.gs
        };

        /**
         * Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„.
         * @param {Array<Object>} records - Ù…ØµÙÙˆÙØ© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹.
         */
        window.displayPaymentRecords = function (records) {
            const tableBody = document.querySelector('#paymentRecordsTable tbody');
            tableBody.innerHTML = '';

            if (!records || records.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="no-data-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨.</td></tr>'; // <--- ØªØ¹Ø¯ÙŠÙ„ colspan
                return;
            }

            records.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${record.paymentId || ''}</td>      <td>${record.subscriptionId || ''}</td> <td>${record.paymentDate || ''}</td>
                <td>${record.paymentAmount || ''}</td>
                <td>${record.paymentMethod || ''}</td>
                <td>${record.paymentNotes || ''}</td>
            `;
                tableBody.appendChild(row);
            });
        };




        // ************************************ //
        //          Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ© Ø®Ø§ØµØ© Ø¨Ù€ renewal-subscription-page //
        // ************************************ //
        let currentRenewalStudentData = null; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø°ÙŠ ÙŠØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§ÙƒÙ‡


        // ************************************ //
        //          Ø¯ÙˆØ§Ù„ Ø®Ø§ØµØ© Ø¨Ù€ renewal-subscription-page (ÙŠØ¬Ø¨ ÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù…Ù† Ø§Ù„Ù€ script) //
        // ************************************ //

        window.loadRenewalSubscriptionDependencies = function () { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ window.function
            document.getElementById('searchStudentIdRenewal').value = '';
            document.getElementById('renewalStudentForm').classList.add('hidden');
            document.getElementById('renewalStatusMessage').classList.add('hidden');
            // loadSubscriptionPackagesOptions Ùˆ loadPaymentStatusOptions ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ†Ø§ Ù…Ø¹Ø±ÙØªÙŠÙ† Ø¹Ù„Ù‰ window Ø£ÙŠØ¶Ø§Ù‹
            // ÙˆØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ù… ÙÙŠ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø£Ùˆ Ù…Ø¹Ø±ÙÙŠÙ† ÙƒÙ€ window.function
            window.loadSubscriptionPackagesOptions('renewalNewPackage');
            window.loadPaymentStatusOptions('renewalPaymentStatus');
        };

        /**
         * Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.
         * @param {string} searchInput - Student ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.
         */
        window.fetchStudentForRenewal = function () { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ window.function
            let searchInput = document.getElementById('searchStudentIdRenewal').value.trim();
            if (!searchInput) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Student ID Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„Ø¨Ø­Ø«.", 'info');
                return;
            }

            const searchButton = document.getElementById('searchRenewalButton');
            const originalSearchText = searchButton.innerHTML;
            searchButton.disabled = true;
            searchButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¨Ø­Ø«';

            document.getElementById('renewalStudentForm').classList.add('hidden');
            document.getElementById('renewalStatusMessage').classList.add('hidden');

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„Ù†Ù…Ø· Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù€ google.script.run
            const scriptRunExecutor = google.script.run
                .withSuccessHandler(response => {
                    searchButton.disabled = false;
                    searchButton.innerHTML = originalSearchText;

                    if (response && response.error) {
                        showToast(response.error, 'error');
                        document.getElementById('renewalStatusMessage').textContent = response.error;
                        document.getElementById('renewalStatusMessage').classList.remove('hidden');
                        return;
                    }

                    if (!response || (Array.isArray(response) && response.length === 0)) {
                        showToast("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø·Ø§Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù/Ø§Ù„Ø±Ù‚Ù….", 'info');
                        document.getElementById('renewalStatusMessage').textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø·Ø§Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù/Ø§Ù„Ø±Ù‚Ù….";
                        document.getElementById('renewalStatusMessage').classList.remove('hidden');
                        return;
                    }

                    if (Array.isArray(response)) {
                        if (response.length > 1) {
                            showToast("ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¯Ø© Ø·Ù„Ø§Ø¨ Ø¨Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Student ID Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ§Ø­Ø¯.", 'info');
                            window.fillRenewalForm(response[0]); // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† window.fillRenewalForm
                        } else {
                            window.fillRenewalForm(response[0]); // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† window.fillRenewalForm
                        }
                    } else {
                        window.fillRenewalForm(response); // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† window.fillRenewalForm
                    }
                })
                .withFailureHandler(error => {
                    searchButton.disabled = false;
                    searchButton.innerHTML = originalSearchText;
                    showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«: " + error.message, 'error');
                    document.getElementById('renewalStatusMessage').textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«: " + error.message;
                    document.getElementById('renewalStatusMessage').classList.remove('hidden');
                    console.error("Error fetching student data for renewal:", error);
                });

            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø­Ø«
            if (searchInput.startsWith('STD')) {
                scriptRunExecutor.getStudentDataByID(searchInput);
            } else {
                if (searchInput.startsWith("0")) {
                    searchInput = searchInput.slice(1);
                }
                scriptRunExecutor.getStudentsByPhone(searchInput);
            }
        };

        /**
         * Ù…Ù„Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨.
         * @param {Object} student - ÙƒØ§Ø¦Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø­Ù…Ù„.
         */
        window.fillRenewalForm = function (student) { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ window.function
            currentRenewalStudentData = student; // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
            document.getElementById('renewalStudentForm').classList.remove('hidden');
            document.getElementById('renewalStatusMessage').classList.add('hidden');

            document.getElementById('renewalStudentNameDisplay').textContent = student.name || '';
            document.getElementById('displayRenewalStudentId').textContent = student.studentID || '';
            document.getElementById('displayRenewalTeacherName').textContent = student.teacherName || '';
            document.getElementById('displayRenewalCurrentPackage').textContent = student.packageName || '';
            document.getElementById('displayRenewalCurrentStatus').textContent = student.renewalStatus || '';
            document.getElementById('displayRenewalAttendedSessions').textContent = student.attendedSessions || 0;
            document.getElementById('displayRenewalLastRenewalDate').textContent = student.lastRenewalDate || '';
            document.getElementById('displayRenewalEndDate').textContent = student.subscriptionEndDate || '';

            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯
            document.getElementById('renewalNewPackage').value = student.packageName || ''; // Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
            document.getElementById('renewalPaymentStatus').value = 'ØªÙ… Ø§Ù„Ø¯ÙØ¹'; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ "ØªÙ… Ø§Ù„Ø¯ÙØ¹"
            document.getElementById('renewalNotes').value = '';
        };

        /**
         * Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©.
         */
        window.submitRenewalData = function () { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ window.function
            if (!currentRenewalStudentData || !currentRenewalStudentData.studentID) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹.", 'error');
                return;
            }
            if (!currentRenewalStudentData.subscriptionId) {
                showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§Ùƒ Ø­Ø§Ù„ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙŠÙ…ÙƒÙ† ØªØ¬Ø¯ÙŠØ¯Ù‡.", 'error');
                return;
            }

            const studentId = currentRenewalStudentData.studentID;
            const subscriptionId = currentRenewalStudentData.subscriptionId;
            const newPackageName = document.getElementById('renewalNewPackage').value;
            const paymentStatus = document.getElementById('renewalPaymentStatus').value;
            const renewalNotes = document.getElementById('renewalNotes').value.trim();

            if (!newPackageName || !paymentStatus) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹.", 'error');
                return;
            }

            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø·Ø§Ù„Ø¨ ${currentRenewalStudentData.name} (ID: ${studentId})ØŸ\nØ§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${newPackageName}\nØ­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹: ${paymentStatus}`)) {
                return;
            }

            const submitButton = document.querySelector('#renewalStudentForm button[onclick="submitRenewalData()"]');
            const originalButtonText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯...';

            const renewalData = {
                studentID: studentId,
                subscriptionId: subscriptionId,
                packageName: newPackageName,
                paymentStatus: paymentStatus,
                renewalNotes: renewalNotes
            };

            google.script.run
                .withSuccessHandler(response => {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;

                    if (response && response.success) {
                        showToast(response.success, 'success');
                        window.loadRenewalSubscriptionDependencies(); // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
                        showPage('main-page');
                    } else if (response && response.error) {
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯: ' + response.error, 'error');
                    }
                })
                .withFailureHandler(error => {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ' + error.message, 'error');
                    console.error("Error submitting renewal data:", error);
                })
                .processStudentSubscriptionRenewal(renewalData);
        };


        function exportToExcel() {
            alert("ğŸ“¥ Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ° ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… SheetJS Ø£Ùˆ Ù…Ù„Ù CSV.");
        }

        function exportToPDF() {
            alert("ğŸ“„ Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ° ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… jsPDF Ø£Ùˆ html2pdf.");
        }


    </script>
</body>

</html>
